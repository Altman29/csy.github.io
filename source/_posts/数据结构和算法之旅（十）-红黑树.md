---
title: æ•°æ®ç»“æ„å’Œç®—æ³•ä¹‹æ—…ï¼ˆåï¼‰- çº¢é»‘æ ‘
excerpt: çº¢é»‘æ ‘ï¼Œå®ƒæ˜¯å¹³è¡¡äºŒå‰æ ‘çš„ä¸€ç§å“¦~ã€‚é€šè¿‡èŠ‚ç‚¹çš„é¢œè‰²æ ‡è®°å’Œæ—‹è½¬æ“ä½œæ¥ç»´æŒæ ‘çš„å¹³è¡¡ï¼Œé€‚ç”¨äºé«˜æ•ˆçš„æ’å…¥ã€åˆ é™¤å’ŒæŸ¥æ‰¾æ“ä½œï¼Œå…¶é«˜åº¦ä¿æŒåœ¨è¾ƒå°çš„èŒƒå›´å†…ï¼Œä¿è¯äº†æ—¶é—´å¤æ‚åº¦ä¸ºO(log n)ã€‚
abbrlink: c47e1f8e
date: 2018-12-27 23:52:42
tags:
  - çº¢é»‘æ ‘
categories:
  - data&algorithm
keywords: çº¢é»‘æ ‘;
index_img: /img/data_math/index.png
---
> çº¢é»‘æ ‘ä¹Ÿæ˜¯ä¸€ç§è‡ªå¹³è¡¡çš„äºŒå‰æœç´¢æ ‘ï¼Œè¾ƒä¹‹AVLï¼Œæ’å…¥å’Œåˆ é™¤æ—‹è½¬æ¬¡æ•°æ›´å°‘ã€‚æ€§èƒ½ä¸Šè¦ç¨å¾®é«˜ä¸€äº›ã€‚å› ä¸ºåˆ¤æ–­å¹³è¡¡çš„ä¾æ®æ˜¯ä¸åŒçš„ï¼Œä¹‹å‰AVLæ ‘æ˜¯åˆ¤æ–­å·¦å³å­æ ‘é«˜åº¦å·®æ˜¯ä¸æ˜¯è¶…è¿‡äº†1ï¼Œè¶…è¿‡1è¡¨ç¤ºä¸å¹³è¡¡ã€‚è€Œçº¢é»‘æ ‘åˆ¤æ–­å¹³è¡¡æ˜¯å¦ä¸€ç§è§„åˆ™ã€‚

## å®šä¹‰


> çº¢é»‘æ ‘ç‰¹æ€§ï¼š
> - 1.æ‰€æœ‰èŠ‚ç‚¹éƒ½æœ‰ä¿©ç§é¢œè‰²ï¼šçº¢ä¸é»‘
> - 2.æ‰€æœ‰nullè§†ä¸ºé»‘è‰²
> - 3.çº¢è‰²èŠ‚ç‚¹ä¸èƒ½ç›¸é‚»ï¼Œ(åˆ¤æ–­å¹³è¡¡çš„ä¸»è¦ä¾æ®)
> - 4.æ ¹èŠ‚ç‚¹æ—¶é»‘è‰²
> - 5.ä»æ ¹åˆ°ä»»æ„ä¸€ä¸ªå¶å­èŠ‚ç‚¹ï¼Œè·¯å¾„ä¸­çš„é»‘è‰²èŠ‚ç‚¹æ•°ä¸€æ ·(åˆ¤æ–­å¹³è¡¡çš„ä¸»è¦ä¾æ®)
> 
> ä¸æ»¡è¶³è¿™äº›ç‰¹æ€§çš„éƒ½æ˜¯ä¸å¹³è¡¡çš„çº¢é»‘æ ‘ã€‚

![](https://hexo-img-bucket-1306020160.cos.ap-beijing.myqcloud.com/pic/202309220920490.png)


## æ˜¯å¦æ˜¯çº¢é»‘æ ‘ï¼Ÿ

### æ ‘1

![](https://hexo-img-bucket-1306020160.cos.ap-beijing.myqcloud.com/pic/202309221519546.png)

<p class="note note-danger">
ä¸æ˜¯çº¢é»‘æ ‘ã€‚
å› ä¸ºè¿åäº†ç¬¬3æ¡ï¼šçº¢è‰²èŠ‚ç‚¹ä¸èƒ½ç›¸é‚»ã€‚
</p>

### æ ‘2

![](https://hexo-img-bucket-1306020160.cos.ap-beijing.myqcloud.com/pic/202309221521761.png)

<p class="note note-danger">
ä¸æ˜¯çº¢é»‘æ ‘ã€‚
å› ä¸ºè¿åäº†ç¬¬5æ¡ï¼šä»æ ¹åˆ°ä»»æ„ä¸€ä¸ªå¶å­èŠ‚ç‚¹ï¼Œè·¯å¾„ä¸­é»‘è‰²èŠ‚ç‚¹æ•°ä¸€æ ·ã€‚
å³è¾¹é‡ï¼Œå·¦è¾¹è½»ï¼Œæ˜¯ä¸å¹³è¡¡çš„ã€‚
</p>

### æ ‘3 

![](https://hexo-img-bucket-1306020160.cos.ap-beijing.myqcloud.com/pic/202309221522358.png)


<p class="note note-success">
æ˜¯çº¢é»‘æ ‘ã€‚
å…³é”®çš„3,4,5æ¡ç‰¹æ€§éƒ½æ»¡è¶³ã€‚
</p>

### æ ‘4

![](https://hexo-img-bucket-1306020160.cos.ap-beijing.myqcloud.com/pic/202309221524531.png)

<p class="note note-danger">
è¿™ä¸ªå’Œä¸Šä¸€ä¸ªç±»ä¼¼ï¼Œä½†æ˜¯å®ƒå¹¶ä¸æ˜¯å¹³è¡¡çš„ã€‚<br>
å› ä¸ºæ²¡æœ‰è€ƒè™‘nullå€¼ã€‚<br>
é‚£ä»€ä¹ˆæ—¶å€™éœ€è¦è€ƒè™‘nullå‘¢ï¼Œå°±æ˜¯å½“å¶å­èŠ‚ç‚¹æ²¡æœ‰è‡ªå·±çš„å…„å¼Ÿçš„æ—¶å€™ï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦æŠŠnullåŠ è¿›æ¥è€ƒè™‘ã€‚
</p>

å¦‚æœåŠ å…¥nullå€¼ï¼Œå¦‚ä¸‹å›¾ï¼Œ 6åˆ°2çš„å³å­©å­åªæœ‰ä¿©ä¸ªé»‘è‰²ï¼Œè€Œ6åˆ°1æˆ–è€…8çš„å­©å­éƒ½æ˜¯3ä¸ªé»‘è‰²ï¼Œæ‰€ä»¥æ˜¯ä¸å¹³è¡¡çš„ã€‚

![](https://hexo-img-bucket-1306020160.cos.ap-beijing.myqcloud.com/pic/202309221526990.png)

<p class="note note-warning">
é‚£ä¸ºä»€ä¹ˆæ ‘3æ˜¯å¹³è¡¡çš„çº¢é»‘æ ‘å‘¢ï¼Ÿå¯ä»¥æŠŠnullè€ƒè™‘è¿›æ¥ï¼Œå¯ä»¥çœ‹å‡ºæ ¹åˆ°ä»»æ„å¶å­èŠ‚ç‚¹çš„é»‘è‰²æ•°éƒ½æ˜¯3ï¼Œæ‰€ä»¥æ˜¯å¹³è¡¡çš„ã€‚
</p>

![](https://hexo-img-bucket-1306020160.cos.ap-beijing.myqcloud.com/pic/202309221531405.png)


<p class="note note-primary">
åˆ¤æ–­æ˜¯å¦å¹³è¡¡æœ‰ä¸€ç‚¹ç»éªŒæ€»ç»“ã€‚<br>
å¦‚æœå¶å­èŠ‚ç‚¹æ˜¯çº¢è‰²ï¼Œå¯ä»¥ä¸ç”¨ä¸ç”¨careã€‚<br>
å¦‚æœå¶å­èŠ‚ç‚¹å°±ä¸€ä¸ªé»‘è‰²ï¼Œæ²¡æœ‰å…„å¼ŸèŠ‚ç‚¹ï¼Œé‚£è‚¯å®šæ˜¯ä¸å¹³è¡¡çš„ã€‚<br>
çº¢è‰²èŠ‚ç‚¹æ— æ‰€è°“ï¼Œé»‘è‰²èŠ‚ç‚¹è‚¯å®šè¦æˆå¯¹å‡ºç°çš„ã€‚
</p>

## code

![](https://hexo-img-bucket-1306020160.cos.ap-beijing.myqcloud.com/pic/202309221539104.png)


```java
package redblack;  
  
import com.sun.org.apache.regexp.internal.RE;  
  
public class RedBlackTree {  
    enum Color {  
        RED, BLACK;  
    }  
  
    private Node root;  
  
    private static class Node {  
        int key;  
        Object value;  
        Node left;  
        Node right;  
        Node parent;//çˆ¶èŠ‚ç‚¹ å› ä¸ºçº¢é»‘æ ‘çš„åˆ é™¤å’Œæ–°å¢ç»å¸¸ç”¨åˆ°çˆ¶èŠ‚ç‚¹  
        Color color = Color.RED;//é»˜è®¤åˆšåˆ›å»ºå‡ºæ¥æ–°èŠ‚ç‚¹æ˜¯ä¸ºçº¢è‰²  
  
        public Node(int key, Object value) {  
            this.key = key;  
            this.value = value;  
        }  
  
        //æ˜¯å¦æ˜¯å·¦å­©å­ å¸¸ç”¨å·¥å…·æ–¹æ³•  
        boolean isLeftChild() {  
            //å¦‚æœçˆ¶èŠ‚ç‚¹ä¸ä¸ºç©ºä¸”çˆ¶èŠ‚ç‚¹çš„leftæ˜¯è‡ªèº«åˆ™æ˜¯å·¦å­©å­  
            return parent != null && parent.left == this;  
        }  
  
        //å”å” å¸¸ç”¨å·¥å…·æ–¹æ³•  
        Node uncle() {  
            if (parent == null || parent.parent == null) {  
                return null;//æ²¡æœ‰çˆ·çˆ·å°±æ²¡æœ‰å”å”  
            }  
            if (parent.isLeftChild()) {  
                return parent.parent.right;  
            } else {  
                return parent.parent.left;  
            }  
        }  
  
        //å…„å¼Ÿ å¸¸ç”¨å·¥å…·æ–¹æ³•  
        Node sibling() {  
            if (parent == null) {  
                return null;//æ²¡çˆ¶äº²å°±æ²¡å…„å¼Ÿ  
            }  
            if (this.isLeftChild()) {  
                return parent.right;  
            } else {  
                return parent.left;  
            }  
        }  
    }  
  
    //åˆ¤æ–­çº¢ã€é»‘  
    boolean isRed(Node node) {  
        return node != null && node.color == Color.RED;  
    }  
  
    boolean isBlack(Node node) {  
        return node == null || node.color == Color.BLACK;  
    }  
  
    //å³é€‰ 1.parentçš„å¤„ç† 2.æ—‹è½¬åæ–°æ ¹çš„çˆ¶å­å…³ç³»  
    private void rightRotate(Node pink) {  
        Node parent = pink.parent;//pinkä¸å¹³è¡¡çš„èŠ‚ç‚¹  
        Node yellow = pink.left;//yellowæ–°æ ¹  
        Node green = yellow.right;//greenè¦æ¢çˆ¹çš„  
        if (green != null) {  
            green.parent = pink;  
        }  
        yellow.right = pink;//é¡¶ä¸Šå»  
        yellow.parent = parent;  
        pink.left = green;  
        pink.parent = yellow;  
        if (parent == null) {  
            root = yellow;  
        } else if (parent.left == pink) {  
            parent.left = yellow;  
        } else {  
            parent.right = yellow;  
        }  
    }  
  
    //å·¦æ—‹  
    private void leftRotate(Node pink) {  
        Node parent = pink.parent;//pinkä¸å¹³è¡¡çš„èŠ‚ç‚¹  
        Node yellow = pink.right;//yellowæ–°æ ¹  
        Node green = yellow.left;//greenè¦æ¢çˆ¹çš„  
        if (green != null) {  
            green.parent = pink;  
        }  
        yellow.left = pink;//é¡¶ä¸Šå»  
        yellow.parent = parent;  
        pink.right = green;  
        pink.parent = yellow;  
        if (parent == null) {  
            root = yellow;  
        } else if (parent.right == pink) {  
            parent.right = yellow;  
        } else {  
            parent.left = yellow;  
        }  
    }  
  
    /**  
     * æ–°å¢æˆ–æ›´æ–°  
     * æ‰¾ç©ºä½ï¼Œæ‰¾åˆ°ä¹‹åæ ¹æ®k-våˆ›å»ºæ–°çš„èŠ‚ç‚¹å¯¹è±¡ï¼Œç„¶åæ ¹çˆ¶èŠ‚ç‚¹å»ºç«‹å¥½çˆ¶å­å…³ç³»ï¼Œæ–°å¢æ“ä½œå°±ç®—å®Œæˆäº†ã€‚  
     * å¦‚æœæ²¡æœ‰æ‰¾åˆ°ç©ºä½ï¼Œå°±æ ¹æ®keyçš„å¤§å°ä¸æ–­çš„å‘å·¦æ‰¾å‘å³æ‰¾ã€‚  
     * å¦‚æœæ‰¾ç›¸åŒçš„keyï¼Œå°±æ˜¯æ›´æ–°ã€‚  
     * <p>  
     * æ­£å¸¸å¢ï¼Œé‡åˆ°çº¢çº¢ä¸å¹³è¡¡è¿›è¡Œè°ƒæ•´  
     * çº¢çº¢ä¸å¹³è¡¡ç»†åˆ†æœ‰å››ç§caseã€‚  
     */  
    public void put(int key, Object value) {  
        Node p = root;  
        Node parent = null;//è®°å½•æ–°å¢èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹  
        while (p != null) {  
            parent = p;  
            if (key < p.key) {  
                p = p.left;  
            } else if (p.key < key) {  
                p = p.right;  
            } else {  
                p.value = value;//æ›´æ–°  
                return;  
            }  
        }  
        Node inserted = new Node(key, value);  
        if (parent == null) root = inserted;  
        else if (key < parent.key) {  
            parent.left = inserted;  
            inserted.parent = parent;//1.ç»´æŠ¤parentå±æ€§  
        } else {  
            parent.right = inserted;  
            inserted.parent = parent;//1.ç»´æŠ¤parentå±æ€§  
        }  
        fixRedRed(inserted);  
    }  
  
    //ä¿®å¤çº¢çº¢  
    void fixRedRed(Node x) {  
        //case 1.æ’å…¥èŠ‚ç‚¹æ˜¯æ ¹èŠ‚ç‚¹ï¼Œå˜é»‘é›†åˆ  
        if (x == root) {  
            x.color = Color.BLACK;  
            return;  
        }  
        //case 2.æ’å…¥èŠ‚ç‚¹çˆ¶äº²æ˜¯é»‘è‰²ï¼Œæ— éœ€è°ƒæ•´  
        if (isBlack(x.parent)) {  
            return;  
        }  
        /*  
        case 3.å½“çº¢çº¢ç›¸é‚»ï¼Œå”å”ä¸ºçº¢è‰²æ—¶  
        éœ€è¦å°†çˆ¶äº²ã€å”å”å˜é»‘ã€ç¥–çˆ¶å˜çº¢ï¼Œç„¶åå¯¹ç¥–çˆ¶åšé€’å½’å¤„ç†  
         */        Node parent = x.parent;  
        Node uncle = x.uncle();  
        Node grandparent = parent.parent;  
        if (isRed(uncle)) {  
            parent.color = Color.BLACK;  
            uncle.color = Color.BLACK;  
            grandparent.color = Color.RED;  
            fixRedRed(grandparent);  
        }  
  
        //case 4.  
        if (parent.isLeftChild() && x.isLeftChild()) {//LL  
            parent.color = Color.BLACK;  
            grandparent.color = Color.RED;  
            rightRotate(grandparent);  
        } else if (parent.isLeftChild() && !x.isLeftChild()) {//RL  
            leftRotate(parent);//ä½¿ä¹‹å˜æˆLL case  
            x.color = Color.BLACK;  
            grandparent.color = Color.RED;  
            rightRotate(grandparent);  
        } else if (!parent.isLeftChild() && !x.isLeftChild()) {//RR  
            parent.color = Color.BLACK;  
            grandparent.color = Color.RED;  
            leftRotate(grandparent);  
        } else {//LR  
            rightRotate(parent);////ä½¿ä¹‹å˜æˆRR case  
            x.color = Color.BLACK;  
            grandparent.color = Color.RED;  
            leftRotate(grandparent);  
        }  
    }  
  
    /**  
     * æŸ¥æ‰¾åˆ é™¤èŠ‚ç‚¹  
     */  
    private Node find(int key) {  
        Node p = root;  
        while (p != null) {  
            if (key < p.key) {  
                p = p.left;  
            } else if (p.key < key) {  
                p = p.right;  
            } else {  
                return p;  
            }  
        }  
        return null;  
    }  
  
    /**  
     * æŸ¥æ‰¾å‰©ä½™èŠ‚ç‚¹  
     */  
    private Node findReplaced(Node deleted) {  
        if (deleted.left == null && deleted.right == null) {  
            return null;  
        }  
        if (deleted.left == null) {  
            return deleted.right;  
        }  
        if (deleted.right == null) {  
            return deleted.left;  
        }  
        //æœ‰ä¿©ä¸ªå­©å­ï¼Œè¦æ‰¾åç»§èŠ‚ç‚¹(å³å­æ ‘çš„æœ€å·¦)  
        Node s = deleted.right;  
        while (s.left != null) {  
            s = s.left;  
        }  
        return s;  
    }  
  
    /**  
     * åˆ é™¤  
     * æ­£å¸¸åˆ ã€ä¼šç”¨åˆ°æä»£æ¡ƒåƒµçš„æŠ€å·§ï¼Œé‡åˆ°é»‘é»‘ä¸å¹³è¡¡è¿›è¡Œè°ƒæ•´  
     * é»‘é»‘ä¸å¹³è¡¡ç»†åˆ†æœ‰6ç§caseã€‚  
     */  
    public void remove(int key) {  
        Node deleted = find(key);  
        if (deleted == null) return;  
        doRemove(deleted);  
    }  
  
    private void doRemove(Node deleted) {  
        Node replaced = findReplaced(deleted);  
        Node parent = deleted.parent;  
        if (replaced == null) {//æ²¡æœ‰å­©å­  
            //case 1.åˆ çš„æ ¹èŠ‚ç‚¹  
            if (deleted == root) {  
                root = null;  
            } else {  
                if (isBlack(deleted)) {//åˆ é™¤åˆ°èŠ‚ç‚¹æ—¶é»‘ï¼Œå‰©ä½™çš„ä¹Ÿæ˜¯é»‘ï¼ŒåŒé»‘(nullä¹Ÿæ˜¯é»‘)  
                    //å¤æ‚è°ƒæ•´  
                    fixDoubleBlack(deleted);//å…ˆè°ƒæ•´å¹³è¡¡ï¼Œä¸‹é¢åœ¨åˆ é™¤  
                } else {  
                    //çº¢è‰²å¶å­ï¼Œæ— éœ€ä»»ä½•å¤„ç†  
                }  
                //case 2.ä¸æ˜¯æ ¹èŠ‚ç‚¹ å¹¶æ²¡æœ‰å­©å­  
                if (deleted.isLeftChild()) {  
                    parent.left = null;  
                } else {  
                    parent.right = null;  
                }  
                deleted.parent = null;//help GC  
            }  
            return;  
        }  
        if (deleted.left == null || deleted.right == null) {//æœ‰ä¸€ä¸ªå­©å­  
            if (deleted == root) {  
                //case 1.åˆ çš„æ ¹èŠ‚ç‚¹  
                root.key = replaced.key;  
                root.value = replaced.value;  
                root.left = root.right = null;  
            } else {  
                //case 2.ä¸æ˜¯æ ¹èŠ‚ç‚¹ å¹¶æœ‰ä¸€ä¸ªå­©å­  
                if (deleted.isLeftChild()) {  
                    parent.left = replaced;  
                } else {  
                    parent.right = replaced;  
                }  
                replaced.parent = parent;  
                deleted.left = deleted.right = deleted.parent = null;//help GC  
                if (isBlack(deleted) && isBlack(replaced)) {//åˆ é™¤åˆ°èŠ‚ç‚¹æ—¶é»‘ï¼Œå‰©ä½™çš„ä¹Ÿæ˜¯é»‘ï¼ŒåŒé»‘  
                    //å¤æ‚è°ƒæ•´  
                    fixDoubleBlack(replaced);//ä¸Šé¢å…ˆåˆ é™¤äº†ï¼Œå†è°ƒæ•´  
                } else {  
                    //case 2  
                    replaced.color = Color.BLACK;  
                }  
            }  
            return;  
        }  
        //æœ‰ä¿©ä¸ªå­©å­ï¼Œæ‰¾åˆ°åç»§ï¼Œæ›¿æ¢ï¼Œåˆ é™¤åç»§èŠ‚ç‚¹  
        int t = deleted.key;  
        deleted.key = replaced.key;  
        replaced.key = t;  
  
        Object v = deleted.value;  
        deleted.value = replaced.value;  
        replaced.value = v;  
        doRemove(replaced);  
    }  
  
    /**  
     * å¤„ç†åŒé»‘  
     * åˆ é™¤åˆ°èŠ‚ç‚¹å’Œå‰©ä¸‹çš„èŠ‚ç‚¹éƒ½æ˜¯é»‘ï¼Œè§¦å‘åŒé»‘ï¼ŒåŒé»‘çš„æ„æ€æ˜¯ï¼Œæ•´ä¸ªè·¯å¾„ä¸Šå°‘ä¸€ä¸ªé»‘ï¼éœ€è¦è°ƒæ•´  
     * case 3ï¼šè¢«è°ƒæ•´èŠ‚ç‚¹çš„å…„å¼Ÿä¸ºçº¢ï¼Œæ­¤æ—¶ä¿©ä¸ªä¾„å­å®šä¸ºé»‘ï¼ˆè¿‡åº¦æƒ…å†µï¼Œéœ€è¦è½¬æ¢æˆ4æˆ–5ï¼Œé€šè¿‡æ—‹è½¬ï¼‰  
     * case 4ï¼šè¢«è°ƒæ•´èŠ‚ç‚¹çš„å…„å¼Ÿä¸ºé»‘ï¼Œä¿©ä¸ªä¾„å­éƒ½ä¸ºé»‘  
     * case 5ï¼šè¢«è°ƒæ•´èŠ‚ç‚¹çš„å…„å¼Ÿä¸ºé»‘ï¼Œè‡³å°‘ä¸€ä¸ªçº¢ä¾„å­  
     */  
    private void fixDoubleBlack(Node x) {  
        if (x == root) {//é€’å½’ç»“æŸæ¡ä»¶  
            return;  
        }  
        Node parent = x.parent;//çˆ¶  
        Node sibling = x.sibling();//å…„å¼Ÿ  
        //case 3:å…„å¼ŸèŠ‚ç‚¹æ˜¯çº¢è‰²  
        if (isRed(sibling)) {  
            if (x.isLeftChild()) {//æ—‹è½¬  
                leftRotate(parent);  
            } else {  
                rightRotate(parent);  
            }  
            parent.color = Color.RED;//æ¢è‰²  
            sibling.color = Color.BLACK;  
            fixDoubleBlack(x);  
            return;  
        }  
        //case 4:å…„å¼ŸèŠ‚ç‚¹æ˜¯é»‘è‰²ï¼Œä¿©ä¸ªä¾„å­éƒ½æ˜¯é»‘  
        if (sibling != null) {  
            if (isBlack(sibling.left) && isBlack(sibling.right)) {  
                sibling.color = Color.RED;  
                if (isRed(parent)) {  
                    parent.color = Color.BLACK;  
                } else {  
                    fixDoubleBlack(parent);  
                }  
            } else {  
                //case 5:å…„å¼Ÿæ˜¯é»‘è‰²ï¼Œä½†æ˜¯ä¾„å­æœ‰çº¢è‰²  
                //LL å…„å¼Ÿæ˜¯å·¦å­©å­ï¼Œå·¦ä¾„å­æ˜¯çº¢  
                if (sibling.isLeftChild() && isRed(sibling.left)) {  
                    rightRotate(parent);  
                    sibling.left.color = Color.BLACK;  
                    sibling.color = parent.color;  
                }  
                //LR å…„å¼Ÿæ˜¯å·¦å­©å­ï¼Œå³ä¾„å­æ˜¯çº¢  
                else if (sibling.isLeftChild() && isRed(sibling.right)) {  
                    sibling.right.color = parent.color;  
                    leftRotate(sibling);  
                    rightRotate(parent);  
                }  
                //RR å…„å¼Ÿæ˜¯å³å­©å­ï¼Œå³ä¾„å­æ˜¯çº¢  
                else if (!sibling.isLeftChild() && isRed(sibling.left)) {  
                    sibling.left.color = parent.color;  
                    rightRotate(sibling);  
                    leftRotate(parent);  
                }  
                //RL å…„å¼Ÿæ˜¯å³å­©å­ï¼Œå·¦ä¾„å­æ˜¯çº¢  
                else {  
                    leftRotate(parent);  
                    sibling.right.color = Color.BLACK;  
                    sibling.color = parent.color;  
                }  
                parent.color = Color.BLACK;  
            }  
        } else {  
            fixDoubleBlack(parent);  
        }  
    }  
}
```

### å³æ—‹

**æ—‹è½¬å‰**

![](https://hexo-img-bucket-1306020160.cos.ap-beijing.myqcloud.com/pic/202309221548839.png)

**æ—‹è½¬å**

![](https://hexo-img-bucket-1306020160.cos.ap-beijing.myqcloud.com/pic/202309221550900.png)

ç†è§£æ—‹è½¬ï¼Œå¯¹ç…§å›¾ï¼Œæ ‡è®°é¢œè‰²æœ‰åŠ©äºå¸®åŠ©ç†è§£ï¼Œå’Œä»£ç å®ç°ã€‚

ğŸ“Œ*æ—‹è½¬å‰*ï¼š
yellowæ˜¯pinkçš„å·¦å­©å­ï¼›`Node yellow = pink.left`
greenæ˜¯yellowçš„å³å­©å­ï¼›`Node green = yellow.right`
ğŸ“Œ*æ—‹è½¬å*ï¼š
yellowè¦é¡¶ä¸Šå»ï¼Œæˆä¸ºæ–°æ ¹ï¼›
pinkè¦ä¸‹å»ï¼Œæˆä¸ºyellowçš„å³å­©å­ï¼›`yellow.right = pink`
è€Œä¸”pinkçš„å·¦å­©å­å˜æˆäº†greenï¼› `pink.left = green`

åˆ°è¿™ä¸€æ­¥ï¼Œå¦‚æœæ˜¯AVLæ ‘å°±å®Œäº‹äº†ï¼Œä¸è¿‡çº¢é»‘æ ‘è¿˜è¦ç»´æŠ¤ä¸€ä¸ªparentï¼ŒğŸ™ƒ è¿˜éœ€è¦ç»§ç»­å¤„ç†ï¼Œå¹¶ä¸”è¦æŠŠæ–°æ ¹yellowçš„çˆ¶å­å…³ç³»ç›´æ¥åœ¨æ—‹è½¬è¿™ä¸ªæ–¹æ³•é‡Œç»™æ­å»ºå¥½ï¼›

æ¥ä¸‹æ¥å°±æŠŠpinkã€yellowã€greençš„parentå±æ€§å¤„ç†å¥½ã€‚

1ï¸âƒ£ å¤„ç†greençš„parentï¼š
æ—‹è½¬å‰ï¼Œgreençš„parentæ˜¯yellowï¼›
æ—‹è½¬åï¼Œgreençš„parentæ˜¯pinkï¼›
æ‰€ä»¥greençš„parentè¦é‡æ–°èµ‹å€¼ï¼Œå½“ç„¶greenå¹¶ä¸ä¸€å®šå­˜åœ¨ï¼Œæ‰€ä»¥éœ€è¦ä¸€ä¸ªåˆ¤æ–­ï¼š
`if(green != null) green.parent = pink;`

2ï¸âƒ£ å¤„ç†yellowçš„parentï¼š
æ—‹è½¬å‰ï¼Œyellowçš„parentæ˜¯pinkï¼›
æ—‹è½¬åï¼Œyellowæˆäº†pinkçš„parentï¼›
è¯¥å›¾åˆ—ä¸å­˜åœ¨5,8çš„parentï¼Œä½†æ˜¯å¯èƒ½å­˜åœ¨ï¼Œæ‰€ä»¥ï¼Œ
`yellow.parent = pink.parent` ç­‰ä»·äº `yellow.parent = parent`ï¼Œ
å› ä¸ºè¿™ä¸ªparentå°±æ˜¯é€šè¿‡`Node parent = pink.parent`æ‹¿åˆ°çš„ã€‚

3ï¸âƒ£ å¤„ç†pinkçš„parentï¼š
æ—‹è½¬åï¼Œpinkçš„parentå˜æˆäº†yellowï¼›
æ‰€ä»¥`pink.parent = yellow`

**è¿˜æœ‰ä¸€ä»¶äº‹**ï¼Œå°±æ˜¯å¤„ç†å¥½æ–°æ ¹çš„çˆ¶å­å…³ç³»ï¼Œè¯¥å›¾ä¾‹æœ‰äº›ç‰¹æ®Šï¼Œç›´æ¥å°±æ˜¯æ ¹äº†ï¼Œçœ‹ä¸€ä¸‹ä¸‹é¢å›¾ä¾‹ï¼š

**æ—‹è½¬å‰**

![](https://hexo-img-bucket-1306020160.cos.ap-beijing.myqcloud.com/pic/202309221605459.png)

**æ—‹è½¬å**

![](https://hexo-img-bucket-1306020160.cos.ap-beijing.myqcloud.com/pic/202309221606180.png)

è¦ç»´æŠ¤yellowé¡¶ä¸Šå»ä¹‹åçš„parentçˆ¶å­å…³ç³»ã€‚
æ—‹è½¬å‰ï¼Œé€šè¿‡`Node parent = pink.parent;` æ‹¿åˆ°ä¹‹å‰çš„æ ¹ã€‚
æ—‹è½¬åï¼Œéœ€è¦åˆ¤æ–­ä¹‹å‰pinkæ˜¯å®ƒçš„çˆ¶çš„å·¦è¿˜æ˜¯å³å­©å­ï¼Œå°±å¯ä»¥åˆ¤æ–­ä¹‹åï¼Œå†³å®šyellowæ˜¯ä¹‹å‰æ ¹åˆ°å·¦è¿˜æ˜¯å³ï¼Œæ‰€ä»¥ï¼š
```java
if(parent.left == pink){
	parent.left = yellow;
}else{
	parent.right = yellow;
}
```

æœ€åå†è€ƒè™‘ä¹‹å‰çš„ç‰¹æ®Šæƒ…å†µï¼Œ
![](https://hexo-img-bucket-1306020160.cos.ap-beijing.myqcloud.com/pic/202309221548839.png)

pinkæ˜¯ä¹‹å‰çš„æ ¹ï¼Œå®ƒçš„parentæ˜¯nullï¼Œé‚£å»ç»™å®ƒçš„leftã€rightèµ‹å€¼è‚¯å®šæ˜¯æœ‰é—®é¢˜çš„ï¼Œæ‰€ä»¥åº”è¯¥æ’é™¤è¿™ç§æƒ…å†µï¼Œç›´æ¥æŠŠyellowä½œä¸ºrootå³å¯ï¼š
```java
if(parent == null) root = yellow;
else if(parent.left == pink){//æŠŠä¸Šé¢çš„éæ ¹æƒ…å†µé€»è¾‘è¡¥å……ä¸Š
	parent.left = yellow;
}else{
	parent.right = yellow;
}
```
### å·¦æ—‹

å…¶å®å·¦æ—‹ç±»ä¼¼å³æ—‹ï¼Œåªä¸è¿‡åè¿‡æ¥ã€‚å¯ä»¥é€šè¿‡ç€è‰²æ³•æä¸€ä¸‹ï¼Œæ¯”å¯¹å³æ—‹åŠ æ·±ç†è§£ã€‚


### æ–°å¢æˆ–æ›´æ–°

æ–°å¢çš„æ—¶å€™ï¼Œè·ŸåŸºæœ¬çš„äºŒå‰æœç´¢æ ‘ä¸€è‡´ï¼Œåªä¸è¿‡å¤šä¸¤ä»¶äº‹
- 1.è¦ç»´æŠ¤æ–°å¢èŠ‚ç‚¹çš„parentå±æ€§
- 2.è¦ç»´æŠ¤çº¢çº¢çš„ä¸å¹³è¡¡ï¼Œå› ä¸ºæ–°å¢çš„æ˜¯é»˜è®¤çº¢è‰²

çº¢çº¢ä¸å¹³è¡¡ï¼Œç»†åˆ†æœ‰å››ç§caseï¼š
å› ä¸ºæ’å…¥èŠ‚ç‚¹å‡è§†ä¸ºçº¢è‰²ğŸ”´
- case 1.æ’å…¥èŠ‚ç‚¹ä¸ºæ ¹èŠ‚ç‚¹ï¼Œå°†æ ¹èŠ‚ç‚¹å˜é»‘âš«ï¸
- case 2.æ’å…¥èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹è‹¥ä¸ºé»‘è‰²âš«ï¸ï¼Œæ ‘çš„çº¢é»‘æ€§è´¨ä¸å˜ï¼Œæ— åºè°ƒæ•´
æ’å…¥èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹ä¸ºçº¢è‰²ğŸ”´ï¼Œè§¦å‘çº¢çº¢ç›¸é‚»
- case 3.å”å”ä¸ºçº¢è‰²ğŸ”´
	- 1.çˆ¶äº²å˜ä¸ºé»‘è‰²âš«ï¸ï¼Œä¸ºäº†ä¿è¯é»‘è‰²å¹³è¡¡ï¼Œè¿å¸¦å”å”ä¹Ÿå˜æˆé»‘è‰²âš«ï¸
	- 2.ç¥–çˆ¶å¦‚æœæ˜¯é»‘è‰²ä¸å˜ï¼Œä¼šé€ æˆè¿™ä¸ªå­æ ‘é»‘è‰²è¿‡å¤šï¼Œå› æ­¤ç¥–çˆ¶ä¹Ÿå˜ä¸ºçº¢è‰²ğŸ”´
	- 3.ç¥–çˆ¶å¦‚æœå˜æˆçº¢è‰²ï¼Œå¯èƒ½ä¼šæ¥ç€è§¦å‘çº¢çº¢ç›¸é‚»ï¼Œå› æ­¤ç»§ç»­å¯¹ç¥–çˆ¶è¿›è¡Œé€’å½’è°ƒæ•´
	- 4.ç›´åˆ°æ ¹èŠ‚ç‚¹ï¼Œå¦‚æœrootå˜ä¸ºçº¢è‰²ï¼Œæ”¹ä¸ºçº¢è‰²å°±å®Œæˆäº†
- case 4.å”å”ä¸ºé»‘è‰²âš«ï¸
	- 1.çˆ¶äº²ä¸ºå·¦å­©å­ï¼Œæ’å…¥èŠ‚ç‚¹ä¹Ÿæ˜¯å·¦å­©å­ï¼Œæ­¤æ—¶å³LLä¸å¹³è¡¡
	- 2.çˆ¶äº²ä¸ºå·¦å­©å­ï¼Œæ’å…¥èŠ‚ç‚¹æ˜¯å³å­©å­ï¼Œæ­¤æ—¶å³LRä¸å¹³è¡¡
	- 3.çˆ¶äº²ä¸ºå³å­©å­ï¼Œæ’å…¥èŠ‚ç‚¹ä¹Ÿæ˜¯å³å­©å­ï¼Œæ­¤æ—¶å³RRä¸å¹³è¡¡
	- 4.çˆ¶äº²ä¸ºå³å­©å­ï¼Œæ’å…¥èŠ‚ç‚¹æ˜¯å·¦å­©å­ï¼Œæ­¤æ—¶å³RLä¸å¹³è¡¡
 
## åˆ é™¤

åˆ é™¤å¯èƒ½è§¦å‘åŒé»‘çš„æƒ…å†µï¼Œè§¦å‘åŒé»‘ï¼ŒåŒé»‘çš„æ„æ€æ˜¯ï¼Œæ•´ä¸ªè·¯å¾„ä¸Šå°‘ä¸€ä¸ªé»‘ï¼éœ€è¦è°ƒæ•´ä¹Ÿæœ‰å¾ˆå¤šcaseå¦‚ä¸‹ï¼š

- case 0ï¼šå¦‚æœåˆ é™¤èŠ‚ç‚¹æœ‰ä¿©ä¸ªå­©å­ï¼ŒåŒ–ç®€æˆåªæœ‰ä¸€ä¸ªå­©å­æˆ–æ²¡æœ‰å­©å­ï¼ˆæ›¿æ¢åˆ é™¤ï¼‰
- csae 1ï¼šåˆ é™¤åˆ°æ˜¯æ ¹èŠ‚ç‚¹
- case 2ï¼šåˆ é™¤çš„æ˜¯é»‘âš«ï¸ï¼Œå‰©ä¸‹çš„çº¢ğŸ”´ï¼Œå‰©ä¸‹è¿™ä¸ªçº¢èŠ‚ç‚¹å˜é»‘âš«ï¸
- case 3ï¼šè¢«è°ƒæ•´èŠ‚ç‚¹çš„å…„å¼Ÿä¸ºçº¢ğŸ”´ï¼Œæ­¤æ—¶ä¿©ä¸ªä¾„å­å®šä¸ºé»‘âš«ï¸
- case 4ï¼šè¢«è°ƒæ•´èŠ‚ç‚¹çš„å…„å¼Ÿæ˜¯é»‘âš«ï¸ï¼Œä¿©ä¸ªä¾„å­éƒ½ä¸ºé»‘âš«ï¸
- case 5ï¼šè¢«è°ƒæ•´èŠ‚ç‚¹çš„å…„å¼Ÿæ˜¯é»‘âš«ï¸ï¼Œè‡³å°‘ä¸€ä¸ªçº¢ğŸ”´ä¾„å­
	- å¦‚æœå…„å¼Ÿæ˜¯å·¦å­©å­ï¼Œå·¦ä¾„å­æ˜¯çº¢ğŸ”´ï¼ŒLLä¸å¹³è¡¡
	- å¦‚æœå…„å¼Ÿæ˜¯å·¦å­©å­ï¼Œå³ä¾„å­æ˜¯çº¢ğŸ”´ï¼ŒLRä¸å¹³è¡¡
	- å¦‚æœå…„å¼Ÿæ˜¯å³å­©å­ï¼Œå³ä¾„å­æ˜¯çº¢ğŸ”´ï¼ŒRRä¸å¹³è¡¡
	- å¦‚æœå…„å¼Ÿæ˜¯å³å­©å­ï¼Œå·¦ä¾„å­æ˜¯çº¢ğŸ”´ï¼ŒRLä¸å¹³è¡¡

