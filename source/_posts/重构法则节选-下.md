---
title: é‡æ„æ³•åˆ™èŠ‚é€‰(ä¸‹)
tags:
  - é‡æ„
  - æ¶æ„
  - è®¾è®¡
categories:
  - é‡æ„
keywords: é‡æ„
index_img: /img/reactor/reactor.jpg
excerpt: ğŸ¤“çœ‹åˆ°shiå±±ä»£ç è¿˜å¤´ç–¼å‘¢ï¼Ÿé‡æ„äº†è§£ä¸€ä¸‹ï¼Ÿ
abbrlink: 915cdc75
date: 2020-07-15 19:16:53
---
> é‡æ„ï¼Œå¹¶ä¸æ˜¯é¢å¤–åŠ¨ä½œï¼Œç†åº”ä¼´éšå¼€å‘æµç¨‹ã€‚å¹¶ä¸æ˜¯æ— æ„ä¹‰ï¼Œå¦‚æœåªæ˜¯å †ç§¯åƒåœ¾ä»£ç ï¼Œè¿­ä»£å¤šæ¬¡ä¹‹åï¼Œå¯èƒ½åŸå¼€å‘äººå‘˜ä¹Ÿä¼šå¤±å»æœ¬æ¥çš„æ–¹å‘ã€‚ä½œä¸ºå¼€å‘äººå‘˜ç†åº”é‡è§†è¿™æ ·çš„ä»½å†…ä¹‹äº‹ã€‚æœ€è¿‘é‡è¯»ã€Šé‡æ„-æ”¹å–„æ—¢æœ‰ä»£ç çš„è®¾è®¡ã€‹ã€‚è¿˜æ˜¯è§‰å¾—éœ€è¦è½åˆ°ç¬”ç«¯ï¼Œåƒä¹¦ä¹Ÿæ˜¯ä¸€ç§å­¦ä¹ æ–¹å¼å§ï¼Œè¿™é‡ŒèŠ‚é€‰è®¤ä¸ºå¿…è¦çš„å†…å®¹ï¼Œè¿˜æ˜¯éœ€è¦åå¤é˜…è¯»æ‰èƒ½ç†è§£å…¶çœŸæ„ã€‚å­¦ä¹ é‡æ„ï¼Œæ˜¯ä¸ºäº†å‡å°‘é‡æ„ã€‚

---

# 10.ç®€åŒ–æ¡ä»¶é€»è¾‘

ç¨‹åºçš„å¤§éƒ¨åˆ†å¨åŠ›æ¥è‡ªæ¡ä»¶é€»è¾‘ï¼Œä½†å¾ˆä¸å¹¸ï¼Œç¨‹åºçš„å¤æ‚åº¦ä¹Ÿå¤§å¤šæ¥è‡ªæ¡ä»¶é€»è¾‘ã€‚æˆ‘ç»å¸¸å€ŸåŠ©é‡æ„æŠŠæ¡ä»¶é€»è¾‘å˜å¾—æ›´å®¹æ˜“ç†è§£ã€‚æˆ‘å¸¸ç”¨åˆ†è§£æ¡ä»¶è¡¨è¾¾å¼ï¼ˆ260ï¼‰å¤„ç†å¤æ‚çš„æ¡ä»¶è¡¨è¾¾å¼ï¼Œç”¨åˆå¹¶æ¡ä»¶è¡¨è¾¾å¼ï¼ˆ263ï¼‰å˜æ¸…é€»è¾‘ç»„åˆã€‚æˆ‘ä¼šç”¨ä»¥å«è¯­å¥å–ä»£åµŒå¥—æ¡ä»¶è¡¨è¾¾å¼ï¼ˆ266ï¼‰æ¸…æ™°è¡¨è¾¾â€œåœ¨ä¸»è¦å¤„ç†é€»è¾‘ä¹‹å‰å…ˆåšæ£€æŸ¥â€çš„æ„å›¾ã€‚å¦‚æœæˆ‘å‘ç°ä¸€å¤„ switch é€»è¾‘å¤„ç†äº†å‡ ç§æƒ…å†µï¼Œå¯ä»¥è€ƒè™‘æ‹¿å‡ºä»¥å¤šæ€å–ä»£æ¡ä»¶è¡¨è¾¾å¼ï¼ˆ272ï¼‰é‡æ„æ‰‹æ³•ã€‚

å¾ˆå¤šæ¡ä»¶é€»è¾‘æ˜¯ç”¨äºå¤„ç†ç‰¹æ®Šæƒ…å†µçš„ï¼Œä¾‹å¦‚å¤„ç† null å€¼ã€‚å¦‚æœå¯¹æŸç§ç‰¹æ®Šæƒ…å†µçš„å¤„ç†é€»è¾‘å¤§å¤šç›¸åŒï¼Œé‚£ä¹ˆå¯ä»¥ç”¨å¼•å…¥ç‰¹ä¾‹ï¼ˆ289ï¼‰ï¼ˆå¸¸è¢«ç§°ä½œå¼•å…¥ç©ºå¯¹è±¡ï¼‰æ¶ˆé™¤é‡å¤ä»£ç ã€‚å¦å¤–ï¼Œè™½ç„¶æˆ‘å¾ˆå–œæ¬¢å»é™¤æ¡ä»¶é€»è¾‘ï¼Œä½†å¦‚æœæˆ‘æƒ³æ˜ç¡®åœ°è¡¨è¿°ï¼ˆä»¥åŠæ£€æŸ¥ï¼‰ç¨‹åºçš„çŠ¶æ€ï¼Œå¼•å…¥æ–­è¨€ï¼ˆ302ï¼‰æ˜¯ä¸€ä¸ªä¸é”™çš„è¡¥å……ã€‚

## 10.1 åˆ†è§£æ¡ä»¶è¡¨è¾¾å¼ï¼ˆDecompose Conditionalï¼‰

```
if (!aDate.isBefore(plan.summerStart) &amp;&amp; !aDate.isAfter(plan.summerEnd))
 charge = quantity * plan.summerRate;
else
 charge = quantity * plan.regularRate + plan.regularServiceCharge;


if (summer())
 charge = summerCharge();
else
 charge = regularCharge();
```

### åŠ¨æœº

ç¨‹åºä¹‹ä¸­ï¼Œå¤æ‚çš„æ¡ä»¶é€»è¾‘æ˜¯æœ€å¸¸å¯¼è‡´å¤æ‚åº¦ä¸Šå‡çš„åœ°ç‚¹ä¹‹ä¸€ã€‚æˆ‘å¿…é¡»ç¼–å†™ä»£ç æ¥æ£€æŸ¥ä¸åŒçš„æ¡ä»¶åˆ†æ”¯ï¼Œæ ¹æ®ä¸åŒçš„æ¡ä»¶åšä¸åŒçš„äº‹ï¼Œç„¶åï¼Œæˆ‘å¾ˆå¿«å°±ä¼šå¾—åˆ°ä¸€ä¸ªç›¸å½“é•¿çš„å‡½æ•°ã€‚å¤§å‹å‡½æ•°æœ¬èº«å°±ä¼šä½¿ä»£ç çš„å¯è¯»æ€§ä¸‹é™ï¼Œè€Œæ¡ä»¶é€»è¾‘åˆ™ä¼šä½¿ä»£ç æ›´éš¾é˜…è¯»ã€‚åœ¨å¸¦æœ‰å¤æ‚æ¡ä»¶é€»è¾‘çš„å‡½æ•°ä¸­ï¼Œä»£ç ï¼ˆåŒ…æ‹¬æ£€æŸ¥æ¡ä»¶åˆ†æ”¯çš„ä»£ç å’ŒçœŸæ­£å®ç°åŠŸèƒ½çš„ä»£ç ï¼‰ä¼šå‘Šè¯‰æˆ‘å‘ç”Ÿçš„äº‹ï¼Œä½†å¸¸å¸¸è®©æˆ‘å¼„ä¸æ¸…æ¥šä¸ºä»€ä¹ˆä¼šå‘ç”Ÿè¿™æ ·çš„äº‹ï¼Œè¿™å°±è¯´æ˜ä»£ç çš„å¯è¯»æ€§çš„ç¡®å¤§å¤§é™ä½äº†ã€‚

å’Œä»»ä½•å¤§å—å¤´ä»£ç ä¸€æ ·ï¼Œæˆ‘å¯ä»¥å°†å®ƒåˆ†è§£ä¸ºå¤šä¸ªç‹¬ç«‹çš„å‡½æ•°ï¼Œæ ¹æ®æ¯ä¸ªå°å—ä»£ç çš„ç”¨é€”ï¼Œä¸ºåˆ†è§£è€Œå¾—çš„æ–°å‡½æ•°å‘½åï¼Œå¹¶å°†åŸå‡½æ•°ä¸­å¯¹åº”çš„ä»£ç æ”¹ä¸ºè°ƒç”¨æ–°å‡½æ•°ï¼Œä»è€Œæ›´æ¸…æ¥šåœ°è¡¨è¾¾è‡ªå·±çš„æ„å›¾ã€‚å¯¹äºæ¡ä»¶é€»è¾‘ï¼Œå°†æ¯ä¸ªåˆ†æ”¯æ¡ä»¶åˆ†è§£æˆæ–°å‡½æ•°è¿˜å¯ä»¥å¸¦æ¥æ›´å¤šå¥½å¤„ï¼šå¯ä»¥çªå‡ºæ¡ä»¶é€»è¾‘ï¼Œæ›´æ¸…æ¥šåœ°è¡¨æ˜æ¯ä¸ªåˆ†æ”¯çš„ä½œç”¨ï¼Œå¹¶ä¸”çªå‡ºæ¯ä¸ªåˆ†æ”¯çš„åŸå› ã€‚

æœ¬é‡æ„æ‰‹æ³•å…¶å®åªæ˜¯æç‚¼å‡½æ•°ï¼ˆ106ï¼‰çš„ä¸€ä¸ªåº”ç”¨åœºæ™¯ã€‚ä½†æˆ‘è¦ç‰¹åˆ«å¼ºè°ƒè¿™ä¸ªåœºæ™¯ï¼Œå› ä¸ºæˆ‘å‘ç°å®ƒç»å¸¸ä¼šå¸¦æ¥å¾ˆå¤§çš„ä»·å€¼ã€‚

### åšæ³•

å¯¹æ¡ä»¶åˆ¤æ–­å’Œæ¯ä¸ªæ¡ä»¶åˆ†æ”¯åˆ†åˆ«è¿ç”¨æç‚¼å‡½æ•°ï¼ˆ106ï¼‰æ‰‹æ³•ã€‚

### èŒƒä¾‹

å‡è®¾æˆ‘è¦è®¡ç®—è´­ä¹°æŸæ ·å•†å“çš„æ€»ä»·ï¼ˆæ€»ä»·=æ•°é‡ Ã— å•ä»·ï¼‰ï¼Œè€Œè¿™ä¸ªå•†å“åœ¨å†¬å­£å’Œå¤å­£çš„å•ä»·æ˜¯ä¸åŒçš„ï¼š

```
if (!aDate.isBefore(plan.summerStart) &amp;&amp; !aDate.isAfter(plan.summerEnd))
 charge = quantity * plan.summerRate;
else
 charge = quantity * plan.regularRate + plan.regularServiceCharge;
```

æˆ‘æŠŠæ¡ä»¶åˆ¤æ–­æç‚¼åˆ°ä¸€ä¸ªç‹¬ç«‹çš„å‡½æ•°ä¸­ï¼š

```
if (summer())
 charge = quantity * plan.summerRate;
else
 charge = quantity * plan.regularRate + plan.regularServiceCharge;

function summer() {
 return !aDate.isBefore(plan.summerStart) &amp;&amp; !aDate.isAfter(plan.summerEnd);
}
```

ç„¶åæç‚¼æ¡ä»¶åˆ¤æ–­ä¸ºçœŸçš„åˆ†æ”¯ï¼š

```
if (summer())
 charge = summerCharge();
else
 charge = quantity * plan.regularRate + plan.regularServiceCharge;

function summer() {
 return !aDate.isBefore(plan.summerStart) &amp;&amp; !aDate.isAfter(plan.summerEnd);
}
function summerCharge() {
 return quantity * plan.summerRate;
}
```

æœ€åæç‚¼æ¡ä»¶åˆ¤æ–­ä¸ºå‡çš„åˆ†æ”¯ï¼š

```
if (summer())
 charge = summerCharge();
else
 charge = regularCharge();

function summer() {
 return !aDate.isBefore(plan.summerStart) &amp;&amp; !aDate.isAfter(plan.summerEnd);
}
function summerCharge() {
 return quantity * plan.summerRate;
}
function regularCharge() {
 return quantity * plan.regularRate + plan.regularServiceCharge;
}
```

æç‚¼å®Œæˆåï¼Œæˆ‘å–œæ¬¢ç”¨ä¸‰å…ƒè¿ç®—ç¬¦é‡æ–°å®‰æ’æ¡ä»¶è¯­å¥ã€‚

```
  charge = summer() ? summerCharge() : regularCharge();

function summer() {
 return !aDate.isBefore(plan.summerStart) &amp;&amp; !aDate.isAfter(plan.summerEnd);
}
function summerCharge() {
 return quantity * plan.summerRate;
}
function regularCharge() {
 return quantity * plan.regularRate + plan.regularServiceCharge;
}
```

## 10.2 åˆå¹¶æ¡ä»¶è¡¨è¾¾å¼ï¼ˆConsolidate Conditional Expressionï¼‰

```
if (anEmployee.seniority < 2) return 0;
if (anEmployee.monthsDisabled > 12) return 0;
if (anEmployee.isPartTime) return 0;


if (isNotEligibleForDisability()) return 0;

function isNotEligibleForDisability() {
 return ((anEmployee.seniority < 2)
     || (anEmployee.monthsDisabled > 12)
     || (anEmployee.isPartTime));
}
```

### åŠ¨æœº

æœ‰æ—¶æˆ‘ä¼šå‘ç°è¿™æ ·ä¸€ä¸²æ¡ä»¶æ£€æŸ¥ï¼šæ£€æŸ¥æ¡ä»¶å„ä¸ç›¸åŒï¼Œæœ€ç»ˆè¡Œä¸ºå´ä¸€è‡´ã€‚å¦‚æœå‘ç°è¿™ç§æƒ…å†µï¼Œå°±åº”è¯¥ä½¿ç”¨â€œé€»è¾‘æˆ–â€å’Œâ€œé€»è¾‘ä¸â€å°†å®ƒä»¬åˆå¹¶ä¸ºä¸€ä¸ªæ¡ä»¶è¡¨è¾¾å¼ã€‚

ä¹‹æ‰€ä»¥è¦åˆå¹¶æ¡ä»¶ä»£ç ï¼Œæœ‰ä¸¤ä¸ªé‡è¦åŸå› ã€‚é¦–å…ˆï¼Œåˆå¹¶åçš„æ¡ä»¶ä»£ç ä¼šè¡¨è¿°â€œå®é™…ä¸Šåªæœ‰ä¸€æ¬¡æ¡ä»¶æ£€æŸ¥ï¼Œåªä¸è¿‡æœ‰å¤šä¸ªå¹¶åˆ—æ¡ä»¶éœ€è¦æ£€æŸ¥è€Œå·²â€ï¼Œä»è€Œä½¿è¿™ä¸€æ¬¡æ£€æŸ¥çš„ç”¨æ„æ›´æ¸…æ™°ã€‚å½“ç„¶ï¼Œåˆå¹¶å‰å’Œåˆå¹¶åçš„ä»£ç æœ‰ç€ç›¸åŒçš„æ•ˆæœï¼Œä½†åŸå…ˆä»£ç ä¼ è¾¾å‡ºçš„ä¿¡æ¯å´æ˜¯â€œè¿™é‡Œæœ‰ä¸€äº›å„è‡ªç‹¬ç«‹çš„æ¡ä»¶æµ‹è¯•ï¼Œå®ƒä»¬åªæ˜¯æ°å¥½åŒæ—¶å‘ç”Ÿâ€ã€‚å…¶æ¬¡ï¼Œè¿™é¡¹é‡æ„å¾€å¾€å¯ä»¥ä¸ºä½¿ç”¨æç‚¼å‡½æ•°ï¼ˆ106ï¼‰åšå¥½å‡†å¤‡ã€‚å°†æ£€æŸ¥æ¡ä»¶æç‚¼æˆä¸€ä¸ªç‹¬ç«‹çš„å‡½æ•°å¯¹äºå˜æ¸…ä»£ç æ„ä¹‰éå¸¸æœ‰ç”¨ï¼Œå› ä¸ºå®ƒæŠŠæè¿°â€œåšä»€ä¹ˆâ€çš„è¯­å¥æ¢æˆäº†â€œä¸ºä»€ä¹ˆè¿™æ ·åšâ€ã€‚

æ¡ä»¶è¯­å¥çš„åˆå¹¶ç†ç”±ä¹ŸåŒæ—¶æŒ‡å‡ºäº†ä¸è¦åˆå¹¶çš„ç†ç”±ï¼šå¦‚æœæˆ‘è®¤ä¸ºè¿™äº›æ£€æŸ¥çš„ç¡®å½¼æ­¤ç‹¬ç«‹ï¼Œçš„ç¡®ä¸åº”è¯¥è¢«è§†ä¸ºåŒä¸€æ¬¡æ£€æŸ¥ï¼Œæˆ‘å°±ä¸ä¼šä½¿ç”¨æœ¬é¡¹é‡æ„ã€‚

### åšæ³•

ç¡®å®šè¿™äº›æ¡ä»¶è¡¨è¾¾å¼éƒ½æ²¡æœ‰å‰¯ä½œç”¨ã€‚

å¦‚æœæŸä¸ªæ¡ä»¶è¡¨è¾¾å¼æœ‰å‰¯ä½œç”¨ï¼Œå¯ä»¥å…ˆç”¨å°†æŸ¥è¯¢å‡½æ•°å’Œä¿®æ”¹å‡½æ•°åˆ†ç¦»ï¼ˆ306ï¼‰å¤„ç†ã€‚

ä½¿ç”¨é€‚å½“çš„é€»è¾‘è¿ç®—ç¬¦ï¼Œå°†ä¸¤ä¸ªç›¸å…³æ¡ä»¶è¡¨è¾¾å¼åˆå¹¶ä¸ºä¸€ä¸ªã€‚

é¡ºåºæ‰§è¡Œçš„æ¡ä»¶è¡¨è¾¾å¼ç”¨é€»è¾‘æˆ–æ¥åˆå¹¶ï¼ŒåµŒå¥—çš„ if è¯­å¥ç”¨é€»è¾‘ä¸æ¥åˆå¹¶ã€‚

æµ‹è¯•ã€‚

é‡å¤å‰é¢çš„åˆå¹¶è¿‡ç¨‹ï¼Œç›´åˆ°æ‰€æœ‰ç›¸å…³çš„æ¡ä»¶è¡¨è¾¾å¼éƒ½åˆå¹¶åˆ°ä¸€èµ·ã€‚

å¯ä»¥è€ƒè™‘å¯¹åˆå¹¶åçš„æ¡ä»¶è¡¨è¾¾å¼å®æ–½æç‚¼å‡½æ•°ï¼ˆ106ï¼‰ã€‚

### èŒƒä¾‹

åœ¨èµ°è¯»ä»£ç çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘çœ‹åˆ°äº†ä¸‹é¢çš„ä»£ç ç‰‡æ®µï¼š

```
function disabilityAmount(anEmployee) {
 if (anEmployee.seniority < 2) return 0;
 if (anEmployee.monthsDisabled > 12) return 0;
 if (anEmployee.isPartTime) return 0;
 // compute the disability amount
```

è¿™é‡Œæœ‰ä¸€è¿ä¸²çš„æ¡ä»¶æ£€æŸ¥ï¼Œéƒ½æŒ‡å‘åŒæ ·çš„ç»“æœã€‚æ—¢ç„¶ç»“æœæ˜¯ç›¸åŒçš„ï¼Œå°±åº”è¯¥æŠŠè¿™äº›æ¡ä»¶æ£€æŸ¥åˆå¹¶æˆä¸€æ¡è¡¨è¾¾å¼ã€‚å¯¹äºè¿™æ ·é¡ºåºæ‰§è¡Œçš„æ¡ä»¶æ£€æŸ¥ï¼Œå¯ä»¥ç”¨é€»è¾‘æˆ–è¿ç®—ç¬¦æ¥åˆå¹¶ã€‚

```
function disabilityAmount(anEmployee) {
 if ((anEmployee.seniority < 2)
   || (anEmployee.monthsDisabled > 12)) return 0;
 if (anEmployee.isPartTime) return 0;
 // compute the disability amount
```

æµ‹è¯•ï¼Œç„¶åæŠŠä¸‹ä¸€ä¸ªæ¡ä»¶æ£€æŸ¥ä¹Ÿåˆå¹¶è¿›æ¥ï¼š

```
function disabilityAmount(anEmployee) {
 if ((anEmployee.seniority < 2)
   || (anEmployee.monthsDisabled > 12)
   || (anEmployee.isPartTime)) return 0;
 // compute the disability amount
```

åˆå¹¶å®Œæˆåï¼Œå†å¯¹è¿™å¥æ¡ä»¶è¡¨è¾¾å¼ä½¿ç”¨æç‚¼å‡½æ•°ï¼ˆ106ï¼‰ã€‚

```
function disabilityAmount(anEmployee) {
 if (isNotEligableForDisability()) return 0;
 // compute the disability amount

function isNotEligableForDisability() {
 return ((anEmployee.seniority < 2)
     || (anEmployee.monthsDisabled > 12)
     || (anEmployee.isPartTime));
}
```

### èŒƒä¾‹ï¼šä½¿ç”¨é€»è¾‘ä¸

ä¸Šé¢çš„ä¾‹å­å±•ç¤ºäº†ç”¨é€»è¾‘æˆ–åˆå¹¶æ¡ä»¶è¡¨è¾¾å¼çš„åšæ³•ã€‚ä¸è¿‡ï¼Œæˆ‘æœ‰å¯èƒ½é‡åˆ°éœ€è¦é€»è¾‘ä¸çš„æƒ…å†µã€‚ä¾‹å¦‚ï¼ŒåµŒå¥— if è¯­å¥çš„æƒ…å†µï¼š

```
if (anEmployee.onVacation)
 if (anEmployee.seniority > 10)
  return 1;
return 0.5;
```

å¯ä»¥ç”¨é€»è¾‘ä¸è¿ç®—ç¬¦å°†å…¶åˆå¹¶ã€‚

```
if ((anEmployee.onVacation)
  &amp;&amp; (anEmployee.seniority > 10)) return 1;
return 0.5;
```

å¦‚æœåŸæ¥çš„æ¡ä»¶é€»è¾‘æ··æ‚äº†è¿™ä¸¤ç§æƒ…å†µï¼Œæˆ‘ä¹Ÿä¼šæ ¹æ®éœ€è¦ç»„åˆä½¿ç”¨é€»è¾‘ä¸å’Œé€»è¾‘æˆ–è¿ç®—ç¬¦ã€‚åœ¨è¿™ç§æ—¶å€™ï¼Œä»£ç å¾ˆå¯èƒ½å˜å¾—æ··ä¹±ï¼Œæ‰€ä»¥æˆ‘ä¼šé¢‘ç¹ä½¿ç”¨æç‚¼å‡½æ•°ï¼ˆ106ï¼‰ï¼ŒæŠŠä»£ç å˜å¾—å¯è¯»ã€‚

## 10.3 ä»¥å«è¯­å¥å–ä»£åµŒå¥—æ¡ä»¶è¡¨è¾¾å¼ï¼ˆReplace Nested Conditional with Guard Clausesï¼‰

```
function getPayAmount() {
  let result;
  if (isDead) result = deadAmount();
  else {
    if (isSeparated) result = separatedAmount();
    else {
      if (isRetired) result = retiredAmount();
      else result = normalPayAmount();
    }
  }
  return result;
}

function getPayAmount() {
  if (isDead) return deadAmount();
  if (isSeparated) return separatedAmount();
  if (isRetired) return retiredAmount();
  return normalPayAmount();
}
```

### åŠ¨æœº

æ ¹æ®æˆ‘çš„ç»éªŒï¼Œæ¡ä»¶è¡¨è¾¾å¼é€šå¸¸æœ‰ä¸¤ç§é£æ ¼ã€‚ç¬¬ä¸€ç§é£æ ¼æ˜¯ï¼šä¸¤ä¸ªæ¡ä»¶åˆ†æ”¯éƒ½å±äºæ­£å¸¸è¡Œä¸ºã€‚ç¬¬äºŒç§é£æ ¼åˆ™æ˜¯ï¼šåªæœ‰ä¸€ä¸ªæ¡ä»¶åˆ†æ”¯æ˜¯æ­£å¸¸è¡Œä¸ºï¼Œå¦ä¸€ä¸ªåˆ†æ”¯åˆ™æ˜¯å¼‚å¸¸çš„æƒ…å†µã€‚

è¿™ä¸¤ç±»æ¡ä»¶è¡¨è¾¾å¼æœ‰ä¸åŒçš„ç”¨é€”ï¼Œè¿™ä¸€ç‚¹åº”è¯¥é€šè¿‡ä»£ç è¡¨ç°å‡ºæ¥ã€‚å¦‚æœä¸¤æ¡åˆ†æ”¯éƒ½æ˜¯æ­£å¸¸è¡Œä¸ºï¼Œå°±åº”è¯¥ä½¿ç”¨å½¢å¦‚ if...else...çš„æ¡ä»¶è¡¨è¾¾å¼ï¼›å¦‚æœæŸä¸ªæ¡ä»¶æå…¶ç½•è§ï¼Œå°±åº”è¯¥å•ç‹¬æ£€æŸ¥è¯¥æ¡ä»¶ï¼Œå¹¶åœ¨è¯¥æ¡ä»¶ä¸ºçœŸæ—¶ç«‹åˆ»ä»å‡½æ•°ä¸­è¿”å›ã€‚è¿™æ ·çš„å•ç‹¬æ£€æŸ¥å¸¸å¸¸è¢«ç§°ä¸ºâ€œå«è¯­å¥â€ï¼ˆguard clausesï¼‰ã€‚

ä»¥å«è¯­å¥å–ä»£åµŒå¥—æ¡ä»¶è¡¨è¾¾å¼çš„ç²¾é«“å°±æ˜¯ï¼šç»™æŸä¸€æ¡åˆ†æ”¯ä»¥ç‰¹åˆ«çš„é‡è§†ã€‚å¦‚æœä½¿ç”¨ if-then-else ç»“æ„ï¼Œä½ å¯¹ if åˆ†æ”¯å’Œ else åˆ†æ”¯çš„é‡è§†æ˜¯åŒç­‰çš„ã€‚è¿™æ ·çš„ä»£ç ç»“æ„ä¼ é€’ç»™é˜…è¯»è€…çš„æ¶ˆæ¯å°±æ˜¯ï¼šå„ä¸ªåˆ†æ”¯æœ‰åŒæ ·çš„é‡è¦æ€§ã€‚å«è¯­å¥å°±ä¸åŒäº†ï¼Œå®ƒå‘Šè¯‰é˜…è¯»è€…ï¼šâ€œè¿™ç§æƒ…å†µä¸æ˜¯æœ¬å‡½æ•°çš„æ ¸å¿ƒé€»è¾‘æ‰€å…³å¿ƒçš„ï¼Œå¦‚æœå®ƒçœŸå‘ç”Ÿäº†ï¼Œè¯·åšä¸€äº›å¿…è¦çš„æ•´ç†å·¥ä½œï¼Œç„¶åé€€å‡ºã€‚â€

â€œæ¯ä¸ªå‡½æ•°åªèƒ½æœ‰ä¸€ä¸ªå…¥å£å’Œä¸€ä¸ªå‡ºå£â€çš„è§‚å¿µï¼Œæ ¹æ·±è’‚å›ºäºæŸäº›ç¨‹åºå‘˜çš„è„‘æµ·é‡Œã€‚æˆ‘å‘ç°ï¼Œå½“æˆ‘å¤„ç†ä»–ä»¬ç¼–å†™çš„ä»£ç æ—¶ï¼Œç»å¸¸éœ€è¦ä½¿ç”¨ä»¥å«è¯­å¥å–ä»£åµŒå¥—æ¡ä»¶è¡¨è¾¾å¼ã€‚ç°ä»Šçš„ç¼–ç¨‹è¯­è¨€éƒ½ä¼šå¼ºåˆ¶ä¿è¯æ¯ä¸ªå‡½æ•°åªæœ‰ä¸€ä¸ªå…¥å£ï¼Œè‡³äºâ€œå•ä¸€å‡ºå£â€è§„åˆ™ï¼Œå…¶å®ä¸æ˜¯é‚£ä¹ˆæœ‰ç”¨ã€‚åœ¨æˆ‘çœ‹æ¥ï¼Œä¿æŒä»£ç æ¸…æ™°æ‰æ˜¯æœ€å…³é”®çš„ï¼šå¦‚æœå•ä¸€å‡ºå£èƒ½ä½¿è¿™ä¸ªå‡½æ•°æ›´æ¸…æ¥šæ˜“è¯»ï¼Œé‚£ä¹ˆå°±ä½¿ç”¨å•ä¸€å‡ºå£ï¼›å¦åˆ™å°±ä¸å¿…è¿™ä¹ˆåšã€‚

### åšæ³•

é€‰ä¸­æœ€å¤–å±‚éœ€è¦è¢«æ›¿æ¢çš„æ¡ä»¶é€»è¾‘ï¼Œå°†å…¶æ›¿æ¢ä¸ºå«è¯­å¥ã€‚

æµ‹è¯•ã€‚

æœ‰éœ€è¦çš„è¯ï¼Œé‡å¤ä¸Šè¿°æ­¥éª¤ã€‚

å¦‚æœæ‰€æœ‰å«è¯­å¥éƒ½å¼•å‘åŒæ ·çš„ç»“æœï¼Œå¯ä»¥ä½¿ç”¨åˆå¹¶æ¡ä»¶è¡¨è¾¾å¼ï¼ˆ263ï¼‰åˆå¹¶ä¹‹ã€‚

### èŒƒä¾‹

ä¸‹é¢çš„ä»£ç ç”¨äºè®¡ç®—è¦æ”¯ä»˜ç»™å‘˜å·¥ï¼ˆemployeeï¼‰çš„å·¥èµ„ã€‚åªæœ‰è¿˜åœ¨å…¬å¸ä¸Šç­çš„å‘˜å·¥æ‰éœ€è¦æ”¯ä»˜å·¥èµ„ï¼Œæ‰€ä»¥è¿™ä¸ªå‡½æ•°éœ€è¦æ£€æŸ¥ä¸¤ç§â€œå‘˜å·¥å·²ç»ä¸åœ¨å…¬å¸ä¸Šç­â€çš„æƒ…å†µã€‚

```
function payAmount(employee) {
 let result;
 if(employee.isSeparated) {
  result = {amount: 0, reasonCode:"SEP"};
 }
 else {
  if (employee.isRetired) {
   result = {amount: 0, reasonCode: "RET"};
  }
  else {
   // logic to compute amount
   lorem.ipsum(dolor.sitAmet);1
   consectetur(adipiscing).elit();
   sed.do.eiusmod = tempor.incididunt.ut(labore) &amp;&amp; dolore(magna.aliqua);
   ut.enim.ad(minim.veniam);
   result = someFinalComputation();
  }
 }
 return result;
}
```

åµŒå¥—çš„æ¡ä»¶é€»è¾‘è®©æˆ‘ä»¬çœ‹ä¸æ¸…ä»£ç çœŸå®çš„å«ä¹‰ã€‚åªæœ‰å½“å‰ä¸¤ä¸ªæ¡ä»¶è¡¨è¾¾å¼éƒ½ä¸ä¸ºçœŸçš„æ—¶å€™ï¼Œè¿™æ®µä»£ç æ‰çœŸæ­£å¼€å§‹å®ƒçš„ä¸»è¦å·¥ä½œã€‚æ‰€ä»¥ï¼Œå«è¯­å¥èƒ½è®©ä»£ç æ›´æ¸…æ™°åœ°é˜è¿°è‡ªå·±çš„æ„å›¾ã€‚

ä¸€å¦‚æ—¢å¾€åœ°ï¼Œæˆ‘å–œæ¬¢å°æ­¥å‰è¿›ï¼Œæ‰€ä»¥æˆ‘å…ˆå¤„ç†æœ€é¡¶ä¸Šçš„æ¡ä»¶é€»è¾‘ã€‚

```
function payAmount(employee) {
 let result;
 if (employee.isSeparated) return {amount: 0, reasonCode: "SEP"};
 if (employee.isRetired) {
  result = {amount: 0, reasonCode: "RET"};
 }
 else {
  // logic to compute amount
  lorem.ipsum(dolor.sitAmet);
  consectetur(adipiscing).elit();
  sed.do.eiusmod = tempor.incididunt.ut(labore) &amp;&amp; dolore(magna.aliqua);
  ut.enim.ad(minim.veniam);
  result = someFinalComputation();
 }
 return result;
}
```

åšå®Œè¿™æ­¥ä¿®æ”¹ï¼Œæˆ‘æ‰§è¡Œæµ‹è¯•ï¼Œç„¶åç»§ç»­ä¸‹ä¸€æ­¥ã€‚

```
function payAmount(employee) {
 let result;
 if (employee.isSeparated) return {amount: 0, reasonCode: "SEP"};
 if (employee.isRetired)   return {amount: 0, reasonCode: "RET"};
 // logic to compute amount
 lorem.ipsum(dolor.sitAmet);
 consectetur(adipiscing).elit();
 sed.do.eiusmod = tempor.incididunt.ut(labore) &amp;&amp; dolore(magna.aliqua);
 ut.enim.ad(minim.veniam);
 result = someFinalComputation();
 return result;
}
```

æ­¤æ—¶ï¼Œresult å˜é‡å·²ç»æ²¡æœ‰ç”¨å¤„äº†ï¼Œæ‰€ä»¥æˆ‘æŠŠå®ƒåˆ æ‰ï¼š

```
function payAmount(employee) {
 let result;
 if (employee.isSeparated) return {amount: 0, reasonCode: "SEP"};
 if (employee.isRetired)   return {amount: 0, reasonCode: "RET"};
 // logic to compute amount
 lorem.ipsum(dolor.sitAmet);
 consectetur(adipiscing).elit();
 sed.do.eiusmod = tempor.incididunt.ut(labore) &amp;&amp; dolore(magna.aliqua);
 ut.enim.ad(minim.veniam);
 return someFinalComputation();
}
```

èƒ½å‡å°‘ä¸€ä¸ªå¯å˜å˜é‡æ€»æ˜¯å¥½çš„ã€‚

### èŒƒä¾‹ï¼šå°†æ¡ä»¶åè½¬

å®¡é˜…æœ¬ä¹¦ç¬¬ 1 ç‰ˆçš„åˆç¨¿æ—¶ï¼ŒJoshua Kerievsky æŒ‡å‡ºï¼šæˆ‘ä»¬å¸¸å¸¸å¯ä»¥å°†æ¡ä»¶è¡¨è¾¾å¼åè½¬ï¼Œä»è€Œå®ç°ä»¥å«è¯­å¥å–ä»£åµŒå¥—æ¡ä»¶è¡¨è¾¾å¼ã€‚ä¸ºäº†æ‹¯æ•‘æˆ‘å¯æ€œçš„æƒ³è±¡åŠ›ï¼Œä»–è¿˜å¥½å¿ƒå¸®æˆ‘æƒ³äº†ä¸€ä¸ªä¾‹å­ï¼š

```
function adjustedCapital(anInstrument) {
 let result = 0;
 if (anInstrument.capital > 0) {
  if (anInstrument.interestRate > 0 &amp;&amp; anInstrument.duration > 0) {
   result = (anInstrument.income / anInstrument.duration) * anInstrument.adjustmentFactor;
  }
 }
 return result;
}
```

åŒæ ·åœ°ï¼Œæˆ‘é€ä¸€è¿›è¡Œæ›¿æ¢ã€‚ä¸è¿‡è¿™æ¬¡åœ¨æ’å…¥å«è¯­å¥æ—¶ï¼Œæˆ‘éœ€è¦å°†ç›¸åº”çš„æ¡ä»¶åè½¬è¿‡æ¥ï¼š

```
function adjustedCapital(anInstrument) {
 let result = 0;
 if (anInstrument.capital <= 0) return result;
 if (anInstrument.interestRate > 0 &amp;&amp; anInstrument.duration > 0) {
  result = (anInstrument.income / anInstrument.duration) * anInstrument.adjustmentFactor;
 }
 return result;
}
```

ä¸‹ä¸€ä¸ªæ¡ä»¶ç¨å¾®å¤æ‚ä¸€ç‚¹ï¼Œæ‰€ä»¥æˆ‘åˆ†ä¸¤æ­¥è¿›è¡Œåè½¬ã€‚é¦–å…ˆåŠ å…¥ä¸€ä¸ªé€»è¾‘éæ“ä½œï¼š

```
function adjustedCapital(anInstrument) {
 let result = 0;
 if (anInstrument.capital <= 0) return result;
 if (!(anInstrument.interestRate > 0 &amp;&amp; anInstrument.duration > 0)) return result;
 result = (anInstrument.income / anInstrument.duration) * anInstrument.adjustmentFactor;
 return result;
}
```

ä½†æ˜¯åœ¨è¿™æ ·çš„æ¡ä»¶è¡¨è¾¾å¼ä¸­ç•™ä¸‹ä¸€ä¸ªé€»è¾‘éï¼Œä¼šæŠŠæˆ‘çš„è„‘è¢‹æ‹§æˆä¸€å›¢ä¹±éº»ï¼Œæ‰€ä»¥æˆ‘æŠŠå®ƒç®€åŒ–æˆä¸‹é¢è¿™æ ·ï¼š

```
  function adjustedCapital(anInstrument) {
 let result = 0;
 if (anInstrument.capital <= 0) return result;
 if (anInstrument.interestRate <= 0 || anInstrument.duration <= 0) return result;
 result = (anInstrument.income / anInstrument.duration) * anInstrument.adjustmentFactor;
 return result;
}
```

è¿™ä¸¤è¡Œé€»è¾‘è¯­å¥å¼•å‘çš„ç»“æœä¸€æ ·ï¼Œæ‰€ä»¥æˆ‘å¯ä»¥ç”¨åˆå¹¶æ¡ä»¶è¡¨è¾¾å¼ï¼ˆ263ï¼‰å°†å…¶åˆå¹¶ã€‚

```
function adjustedCapital(anInstrument) {
 let result = 0;
 if (   anInstrument.capital      <= 0
   || anInstrument.interestRate <= 0
   || anInstrument.duration     <= 0) return result;
 result = (anInstrument.income / anInstrument.duration) * anInstrument.adjustmentFactor;
 return result;
}
```

æ­¤æ—¶ result å˜é‡åšäº†ä¸¤ä»¶äº‹ï¼šä¸€å¼€å§‹æˆ‘æŠŠå®ƒè®¾ä¸º 0ï¼Œä»£è¡¨å«è¯­å¥è¢«è§¦å‘æ—¶çš„è¿”å›å€¼ï¼›ç„¶ååˆç”¨æœ€ç»ˆè®¡ç®—çš„ç»“æœç»™å®ƒèµ‹å€¼ã€‚æˆ‘å¯ä»¥å½»åº•ç§»é™¤è¿™ä¸ªå˜é‡ï¼Œé¿å…ç”¨ä¸€ä¸ªå˜é‡æ‰¿æ‹…ä¸¤é‡è´£ä»»ï¼Œè€Œä¸”åˆå‡å°‘äº†ä¸€ä¸ªå¯å˜å˜é‡ã€‚

```
function adjustedCapital(anInstrument) {
 if (   anInstrument.capital     <= 0
   || anInstrument.interestRate <= 0
   || anInstrument.duration   <= 0) return 0;
 return (anInstrument.income / anInstrument.duration) * anInstrument.adjustmentFactor;
}
```

1 â€œlorem.ipsumâ€¦â€¦â€æ˜¯ä¸€ç¯‡å¸¸è§äºæ’ç‰ˆè®¾è®¡é¢†åŸŸçš„æ–‡ç« ï¼Œå…¶å†…å®¹ä¸ºä¸å…·å¯è¯»æ€§çš„å­—ç¬¦ç»„åˆï¼Œç›®çš„æ˜¯ä½¿é˜…è¯»è€…åªä¸“æ³¨äºè§‚å¯Ÿæ®µè½çš„å­—å‹å’Œç‰ˆå‹ã€‚â€”â€”è¯‘è€…æ³¨

## 10.4 ä»¥å¤šæ€å–ä»£æ¡ä»¶è¡¨è¾¾å¼ï¼ˆReplace Conditional with Polymorphismï¼‰

```
switch (bird.type) {
 case 'EuropeanSwallow':
  return "average";
 case 'AfricanSwallow':
  return (bird.numberOfCoconuts > 2) ? "tired" : "average";
 case 'NorwegianBlueParrot':
  return (bird.voltage > 100) ? "scorched" : "beautiful";
 default:
  return "unknown";


class EuropeanSwallow {
 get plumage() {
  return "average";
 }
class AfricanSwallow {
 get plumage() {
   return (this.numberOfCoconuts > 2) ? "tired" : "average";
 }
class NorwegianBlueParrot {
 get plumage() {
   return (this.voltage > 100) ? "scorched" : "beautiful";
}
```

### åŠ¨æœº

å¤æ‚çš„æ¡ä»¶é€»è¾‘æ˜¯ç¼–ç¨‹ä¸­æœ€éš¾ç†è§£çš„ä¸œè¥¿ä¹‹ä¸€ï¼Œå› æ­¤æˆ‘ä¸€ç›´åœ¨å¯»æ±‚ç»™æ¡ä»¶é€»è¾‘æ·»åŠ ç»“æ„ã€‚å¾ˆå¤šæ—¶å€™ï¼Œæˆ‘å‘ç°å¯ä»¥å°†æ¡ä»¶é€»è¾‘æ‹†åˆ†åˆ°ä¸åŒçš„åœºæ™¯ï¼ˆæˆ–è€…å«é«˜é˜¶ç”¨ä¾‹ï¼‰ï¼Œä»è€Œæ‹†è§£å¤æ‚çš„æ¡ä»¶é€»è¾‘ã€‚è¿™ç§æ‹†åˆ†æœ‰æ—¶ç”¨æ¡ä»¶é€»è¾‘æœ¬èº«çš„ç»“æ„å°±è¶³ä»¥è¡¨è¾¾ï¼Œä½†ä½¿ç”¨ç±»å’Œå¤šæ€èƒ½æŠŠé€»è¾‘çš„æ‹†åˆ†è¡¨è¿°å¾—æ›´æ¸…æ™°ã€‚

ä¸€ä¸ªå¸¸è§çš„åœºæ™¯æ˜¯ï¼šæˆ‘å¯ä»¥æ„é€ ä¸€ç»„ç±»å‹ï¼Œæ¯ä¸ªç±»å‹å¤„ç†å„è‡ªçš„ä¸€ç§æ¡ä»¶é€»è¾‘ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä¼šæ³¨æ„åˆ°ï¼Œå›¾ä¹¦ã€éŸ³ä¹ã€é£Ÿå“çš„å¤„ç†æ–¹å¼ä¸åŒï¼Œè¿™æ˜¯å› ä¸ºå®ƒä»¬åˆ†å±ä¸åŒç±»å‹çš„å•†å“ã€‚æœ€æ˜æ˜¾çš„å¾å…†å°±æ˜¯æœ‰å¥½å‡ ä¸ªå‡½æ•°éƒ½æœ‰åŸºäºç±»å‹ä»£ç çš„ switch è¯­å¥ã€‚è‹¥æœçœŸå¦‚æ­¤ï¼Œæˆ‘å°±å¯ä»¥é’ˆå¯¹ switch è¯­å¥ä¸­çš„æ¯ç§åˆ†æ”¯é€»è¾‘åˆ›å»ºä¸€ä¸ªç±»ï¼Œç”¨å¤šæ€æ¥æ‰¿è½½å„ä¸ªç±»å‹ç‰¹æœ‰çš„è¡Œä¸ºï¼Œä»è€Œå»é™¤é‡å¤çš„åˆ†æ”¯é€»è¾‘ã€‚

å¦ä¸€ç§æƒ…å†µæ˜¯ï¼šæœ‰ä¸€ä¸ªåŸºç¡€é€»è¾‘ï¼Œåœ¨å…¶ä¸Šåˆæœ‰ä¸€äº›å˜ä½“ã€‚åŸºç¡€é€»è¾‘å¯èƒ½æ˜¯æœ€å¸¸ç”¨çš„ï¼Œä¹Ÿå¯èƒ½æ˜¯æœ€ç®€å•çš„ã€‚æˆ‘å¯ä»¥æŠŠåŸºç¡€é€»è¾‘æ”¾è¿›è¶…ç±»ï¼Œè¿™æ ·æˆ‘å¯ä»¥é¦–å…ˆç†è§£è¿™éƒ¨åˆ†é€»è¾‘ï¼Œæš‚æ—¶ä¸ç®¡å„ç§å˜ä½“ï¼Œç„¶åæˆ‘å¯ä»¥æŠŠæ¯ç§å˜ä½“é€»è¾‘å•ç‹¬æ”¾è¿›ä¸€ä¸ªå­ç±»ï¼Œå…¶ä¸­çš„ä»£ç ç€é‡å¼ºè°ƒä¸åŸºç¡€é€»è¾‘çš„å·®å¼‚ã€‚

å¤šæ€æ˜¯é¢å‘å¯¹è±¡ç¼–ç¨‹çš„å…³é”®ç‰¹æ€§ä¹‹ä¸€ã€‚è·Ÿå…¶ä»–ä¸€åˆ‡æœ‰ç”¨çš„ç‰¹æ€§ä¸€æ ·ï¼Œå®ƒä¹Ÿå¾ˆå®¹æ˜“è¢«æ»¥ç”¨ã€‚æˆ‘æ›¾ç»é‡åˆ°æœ‰äººäº‰è®ºè¯´æ‰€æœ‰æ¡ä»¶é€»è¾‘éƒ½åº”è¯¥ç”¨å¤šæ€å–ä»£ã€‚æˆ‘ä¸èµåŒè¿™ç§è§‚ç‚¹ã€‚æˆ‘çš„å¤§éƒ¨åˆ†æ¡ä»¶é€»è¾‘åªç”¨åˆ°äº†åŸºæœ¬çš„æ¡ä»¶è¯­å¥â€”â€”if/else å’Œ switch/caseï¼Œå¹¶ä¸éœ€è¦åŠ³å¸ˆåŠ¨ä¼—åœ°å¼•å…¥å¤šæ€ã€‚ä½†å¦‚æœå‘ç°å¦‚å‰æ‰€è¿°çš„å¤æ‚æ¡ä»¶é€»è¾‘ï¼Œå¤šæ€æ˜¯æ”¹å–„è¿™ç§æƒ…å†µçš„æœ‰åŠ›å·¥å…·ã€‚

### åšæ³•

å¦‚æœç°æœ‰çš„ç±»å°šä¸å…·å¤‡å¤šæ€è¡Œä¸ºï¼Œå°±ç”¨å·¥å‚å‡½æ•°åˆ›å»ºä¹‹ï¼Œä»¤å·¥å‚å‡½æ•°è¿”å›æ°å½“çš„å¯¹è±¡å®ä¾‹ã€‚

åœ¨è°ƒç”¨æ–¹ä»£ç ä¸­ä½¿ç”¨å·¥å‚å‡½æ•°è·å¾—å¯¹è±¡å®ä¾‹ã€‚

å°†å¸¦æœ‰æ¡ä»¶é€»è¾‘çš„å‡½æ•°ç§»åˆ°è¶…ç±»ä¸­ã€‚

å¦‚æœæ¡ä»¶é€»è¾‘è¿˜æœªæç‚¼è‡³ç‹¬ç«‹çš„å‡½æ•°ï¼Œé¦–å…ˆå¯¹å…¶ä½¿ç”¨æç‚¼å‡½æ•°ï¼ˆ106ï¼‰ã€‚

ä»»é€‰ä¸€ä¸ªå­ç±»ï¼Œåœ¨å…¶ä¸­å»ºç«‹ä¸€ä¸ªå‡½æ•°ï¼Œä½¿ä¹‹è¦†å†™è¶…ç±»ä¸­å®¹çº³æ¡ä»¶è¡¨è¾¾å¼çš„é‚£ä¸ªå‡½æ•°ã€‚å°†ä¸è¯¥å­ç±»ç›¸å…³çš„æ¡ä»¶è¡¨è¾¾å¼åˆ†æ”¯å¤åˆ¶åˆ°æ–°å‡½æ•°ä¸­ï¼Œå¹¶å¯¹å®ƒè¿›è¡Œé€‚å½“è°ƒæ•´ã€‚

é‡å¤ä¸Šè¿°è¿‡ç¨‹ï¼Œå¤„ç†å…¶ä»–æ¡ä»¶åˆ†æ”¯ã€‚

åœ¨è¶…ç±»å‡½æ•°ä¸­ä¿ç•™é»˜è®¤æƒ…å†µçš„é€»è¾‘ã€‚æˆ–è€…ï¼Œå¦‚æœè¶…ç±»åº”è¯¥æ˜¯æŠ½è±¡çš„ï¼Œå°±æŠŠè¯¥å‡½æ•°å£°æ˜ä¸º abstractï¼Œæˆ–åœ¨å…¶ä¸­ç›´æ¥æŠ›å‡ºå¼‚å¸¸ï¼Œè¡¨æ˜è®¡ç®—è´£ä»»éƒ½åœ¨å­ç±»ä¸­ã€‚

### èŒƒä¾‹

æˆ‘çš„æœ‹å‹æœ‰ä¸€ç¾¤é¸Ÿå„¿ï¼Œä»–æƒ³çŸ¥é“è¿™äº›é¸Ÿé£å¾—æœ‰å¤šå¿«ï¼Œä»¥åŠå®ƒä»¬çš„ç¾½æ¯›æ˜¯ä»€ä¹ˆæ ·çš„ã€‚æ‰€ä»¥æˆ‘ä»¬å†™äº†ä¸€å°æ®µç¨‹åºæ¥åˆ¤æ–­è¿™äº›ä¿¡æ¯ã€‚

```
function plumages(birds) {
 return new Map(birds.map(b => [b.name, plumage(b)]));
}
function speeds(birds) {
 return new Map(birds.map(b => [b.name, airSpeedVelocity(b)]));
}

function plumage(bird) {
 switch (bird.type) {
 case 'EuropeanSwallow':
  return "average";
 case 'AfricanSwallow':
  return (bird.numberOfCoconuts > 2) ? "tired" : "average";
 case 'NorwegianBlueParrot':
  return (bird.voltage > 100) ? "scorched" : "beautiful";
 default:
  return "unknown";
 }
}

function airSpeedVelocity(bird) {
 switch (bird.type) {
 case 'EuropeanSwallow':
  return 35;
 case 'AfricanSwallow':
  return 40 - 2 * bird.numberOfCoconuts;
 case 'NorwegianBlueParrot':
  return (bird.isNailed) ? 0 : 10 + bird.voltage / 10;
 default:
  return null;
 }
}
```

æœ‰ä¸¤ä¸ªä¸åŒçš„æ“ä½œï¼Œå…¶è¡Œä¸ºéƒ½éšç€â€œé¸Ÿçš„ç±»å‹â€å‘ç”Ÿå˜åŒ–ï¼Œå› æ­¤å¯ä»¥åˆ›å»ºå‡ºå¯¹åº”çš„ç±»ï¼Œç”¨å¤šæ€æ¥å¤„ç†å„ç±»å‹ç‰¹æœ‰çš„è¡Œä¸ºã€‚

æˆ‘å…ˆå¯¹ airSpeedVelocity å’Œ plumage ä¸¤ä¸ªå‡½æ•°ä½¿ç”¨å‡½æ•°ç»„åˆæˆç±»ï¼ˆ144ï¼‰ã€‚

```
function plumage(bird) {
 return new Bird(bird).plumage;
}

function airSpeedVelocity(bird) {
 return new Bird(bird).airSpeedVelocity;
}
class Bird {
 constructor(birdObject) {
  Object.assign(this, birdObject);
 }
 get plumage() {
  switch (this.type) {
  case 'EuropeanSwallow':
   return "average";
  case 'AfricanSwallow':
   return (this.numberOfCoconuts > 2) ? "tired" : "average";
  case 'NorwegianBlueParrot':
   return (this.voltage > 100) ? "scorched" : "beautiful";
  default:
   return "unknown";
  }
 }
 get airSpeedVelocity() {
  switch (this.type) {
  case 'EuropeanSwallow':
   return 35;
  case 'AfricanSwallow':
   return 40 - 2 * this.numberOfCoconuts;
  case 'NorwegianBlueParrot':
   return (this.isNailed) ? 0 : 10 + this.voltage / 10;
  default:
   return null;
  }
 }
}
```

ç„¶åé’ˆå¯¹æ¯ç§é¸Ÿåˆ›å»ºä¸€ä¸ªå­ç±»ï¼Œç”¨ä¸€ä¸ªå·¥å‚å‡½æ•°æ¥å®ä¾‹åŒ–åˆé€‚çš„å­ç±»å¯¹è±¡ã€‚

```
function plumage(bird) {
  return createBird(bird).plumage;
}

function airSpeedVelocity(bird) {
  return createBird(bird).airSpeedVelocity;
}

function createBird(bird) {
  switch (bird.type) {
    case "EuropeanSwallow":
      return new EuropeanSwallow(bird);
    case "AfricanSwallow":
      return new AfricanSwallow(bird);
    case "NorweigianBlueParrot":
      return new NorwegianBlueParrot(bird);
    default:
      return new Bird(bird);
  }
}
class EuropeanSwallow extends Bird {}

class AfricanSwallow extends Bird {}

class NorwegianBlueParrot extends Bird {}
```

ç°åœ¨æˆ‘å·²ç»æœ‰äº†éœ€è¦çš„ç±»ç»“æ„ï¼Œå¯ä»¥å¤„ç†ä¸¤ä¸ªæ¡ä»¶é€»è¾‘äº†ã€‚å…ˆä» plumage å‡½æ•°å¼€å§‹ï¼Œæˆ‘ä» switch è¯­å¥ä¸­é€‰ä¸€ä¸ªåˆ†æ”¯ï¼Œåœ¨é€‚å½“çš„å­ç±»ä¸­è¦†å†™è¿™ä¸ªé€»è¾‘ã€‚

**class EuropeanSwallow...**

```
get plumage() {
  return "average";
}
```

**class Bird...**

```
get plumage() {
 switch (this.type) {
 case 'EuropeanSwallow':
  throw "oops";
 case 'AfricanSwallow':
  return (this.numberOfCoconuts > 2) ? "tired" : "average";
 case 'NorwegianBlueParrot':
  return (this.voltage > 100) ? "scorched" : "beautiful";
 default:
  return "unknown";
 }
}
```

åœ¨è¶…ç±»ä¸­ï¼Œæˆ‘æŠŠå¯¹åº”çš„é€»è¾‘åˆ†æ”¯æ”¹ä¸ºæŠ›å‡ºå¼‚å¸¸ï¼Œå› ä¸ºæˆ‘æ€»æ˜¯åæ‰§åœ°æ‹…å¿ƒå‡ºé”™ã€‚

æ­¤æ—¶æˆ‘å°±å¯ä»¥ç¼–è¯‘å¹¶æµ‹è¯•ã€‚å¦‚æœä¸€åˆ‡é¡ºåˆ©çš„è¯ï¼Œæˆ‘å¯ä»¥æ¥ç€å¤„ç†ä¸‹ä¸€ä¸ªåˆ†æ”¯ã€‚

**class AfricanSwallow...**

```
get plumage() {
   return (this.numberOfCoconuts > 2) ? "tired" : "average";
}
```

ç„¶åæ˜¯æŒªå¨è“é¹¦é¹‰ï¼ˆNorwegian Blueï¼‰çš„åˆ†æ”¯ã€‚

**class NorwegianBlueParrot...**

```
get plumage() {
   return (this.voltage >100) ? "scorched" : "beautiful";
}
```

è¶…ç±»å‡½æ•°ä¿ç•™ä¸‹æ¥å¤„ç†é»˜è®¤æƒ…å†µã€‚

**class Bird...**

```
get plumage() {
  return "unknown";
}
```

airSpeedVelocity ä¹Ÿå¦‚æ³•ç‚®åˆ¶ã€‚å®Œæˆä»¥åï¼Œä»£ç å¤§è‡´å¦‚ä¸‹ï¼ˆæˆ‘è¿˜å¯¹é¡¶å±‚çš„ airSpeedVelocity å’Œ plumage å‡½æ•°åšäº†å†…è”å¤„ç†ï¼‰ï¼š

```
function plumages(birds) {
 return new Map(birds
         .map(b => createBird(b))
         .map(bird => [bird.name, bird.plumage]));
}
function speeds(birds) {
 return new Map(birds
         .map(b => createBird(b))
         .map(bird => [bird.name, bird.airSpeedVelocity]));
}

function createBird(bird) {
 switch (bird.type) {
 case 'EuropeanSwallow':
  return new EuropeanSwallow(bird);
 case 'AfricanSwallow':
  return new AfricanSwallow(bird);
 case 'NorwegianBlueParrot':
  return new NorwegianBlueParrot(bird);
 default:
  return new Bird(bird);
 }
}

class Bird {
 constructor(birdObject) {
  Object.assign(this, birdObject);
 }
 get plumage() {
  return "unknown";
 }
 get airSpeedVelocity() {
  return null;
 }
}
class EuropeanSwallow extends Bird {
 get plumage() {
  return "average";
 }
 get airSpeedVelocity() {
  return 35;
 }
}
class AfricanSwallow extends Bird {
 get plumage() {
  return (this.numberOfCoconuts > 2) ? "tired" : "average";
 }
 get airSpeedVelocity() {
  return 40 - 2 * this.numberOfCoconuts;
 }
}
class NorwegianBlueParrot extends Bird {
 get plumage() {
  return (this.voltage > 100) ? "scorched" : "beautiful";
 }
 get airSpeedVelocity() {
  return (this.isNailed) ? 0 : 10 + this.voltage / 10;
 }
}
```

çœ‹ç€æœ€ç»ˆçš„ä»£ç ï¼Œå¯ä»¥çœ‹å‡º Bird è¶…ç±»å¹¶ä¸æ˜¯å¿…éœ€çš„ã€‚åœ¨ JavaScript ä¸­ï¼Œå¤šæ€ä¸ä¸€å®šéœ€è¦ç±»å‹å±‚çº§ï¼Œåªè¦å¯¹è±¡å®ç°äº†é€‚å½“çš„å‡½æ•°å°±è¡Œã€‚ä½†åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘æ„¿æ„ä¿ç•™è¿™ä¸ªä¸å¿…è¦çš„è¶…ç±»ï¼Œå› ä¸ºå®ƒèƒ½å¸®åŠ©é˜é‡Šå„ä¸ªå­ç±»ä¸é—®é¢˜åŸŸä¹‹é—´çš„å…³ç³»ã€‚

### èŒƒä¾‹ï¼šç”¨å¤šæ€å¤„ç†å˜ä½“é€»è¾‘

åœ¨å‰é¢çš„ä¾‹å­ä¸­ï¼Œâ€œé¸Ÿâ€çš„ç±»å‹ä½“ç³»æ˜¯ä¸€ä¸ªæ¸…æ™°çš„æ³›åŒ–ä½“ç³»ï¼šè¶…ç±»æ˜¯æŠ½è±¡çš„â€œé¸Ÿâ€ï¼Œå­ç±»æ˜¯å„ç§å…·ä½“çš„é¸Ÿã€‚è¿™æ˜¯æ•™ç§‘ä¹¦ï¼ˆåŒ…æ‹¬æˆ‘å†™çš„ä¹¦ï¼‰ä¸­ç»å¸¸è®¨è®ºçš„ç»§æ‰¿å’Œå¤šæ€ï¼Œä½†å¹¶ä¸æ˜¯å®è·µä¸­ä½¿ç”¨ç»§æ‰¿çš„å”¯ä¸€æ–¹å¼ã€‚å®é™…ä¸Šï¼Œè¿™ç§æ–¹å¼å¾ˆå¯èƒ½ä¸æ˜¯æœ€å¸¸ç”¨æˆ–æœ€å¥½çš„æ–¹å¼ã€‚å¦ä¸€ç§ä½¿ç”¨ç»§æ‰¿çš„æƒ…å†µæ˜¯ï¼šæˆ‘æƒ³è¡¨è¾¾æŸä¸ªå¯¹è±¡ä¸å¦ä¸€ä¸ªå¯¹è±¡å¤§ä½“ç±»ä¼¼ï¼Œä½†åˆæœ‰ä¸€äº›ä¸åŒä¹‹å¤„ã€‚

ä¸‹é¢æœ‰ä¸€ä¸ªè¿™æ ·çš„ä¾‹å­ï¼šæœ‰ä¸€å®¶è¯„çº§æœºæ„ï¼Œè¦å¯¹è¿œæ´‹èˆªèˆ¹çš„èˆªè¡Œè¿›è¡ŒæŠ•èµ„è¯„çº§ã€‚è¿™å®¶è¯„çº§æœºæ„ä¼šç»™å‡ºâ€œAâ€æˆ–è€…â€œBâ€ä¸¤ç§è¯„çº§ï¼Œå–å†³äºå¤šç§é£é™©å’Œç›ˆåˆ©æ½œåŠ›çš„å› ç´ ã€‚åœ¨è¯„ä¼°é£é™©æ—¶ï¼Œæ—¢è¦è€ƒè™‘èˆªç¨‹æœ¬èº«çš„ç‰¹å¾ï¼Œä¹Ÿè¦è€ƒè™‘èˆ¹é•¿è¿‡å¾€èˆªè¡Œçš„å†å²ã€‚

```
function rating(voyage, history) {
 const vpf = voyageProfitFactor(voyage, history);
 const vr = voyageRisk(voyage);
 const chr = captainHistoryRisk(voyage, history);
 if (vpf * 3 > (vr + chr * 2)) return "A";
 else return "B";
}
function voyageRisk(voyage) {
 let result = 1;
 if (voyage.length > 4) result += 2;
 if (voyage.length > 8) result += voyage.length - 8;
 if (["china", "east-indies"].includes(voyage.zone)) result += 4;
 return Math.max(result, 0);
}
function captainHistoryRisk(voyage, history) {
 let result = 1;
 if (history.length < 5) result += 4;
 result += history.filter(v => v.profit < 0).length;
 if (voyage.zone === "china" &amp;&amp; hasChina(history)) result -= 2;
 return Math.max(result, 0);
}
function hasChina(history) {
 return history.some(v => "china" === v.zone);
}
function voyageProfitFactor(voyage, history) {
 let result = 2;
 if (voyage.zone === "china") result += 1;
 if (voyage.zone === "east-indies") result += 1;
 if (voyage.zone === "china" &amp;&amp; hasChina(history)) {
  result += 3;
  if (history.length > 10) result += 1;
  if (voyage.length > 12) result += 1;
  if (voyage.length > 18) result -= 1;
 }
 else {
  if (history.length > 8) result += 1;
  if (voyage.length > 14) result -= 1;
 }
 return result;
}
```

voyageRisk å’Œ captainHistoryRisk ä¸¤ä¸ªå‡½æ•°è´Ÿè´£æ‰“å‡ºé£é™©åˆ†æ•°ï¼ŒvoyageProfitFactor è´Ÿè´£æ‰“å‡ºç›ˆåˆ©æ½œåŠ›åˆ†æ•°ï¼Œrating å‡½æ•°å°† 3 ä¸ªåˆ†æ•°ç»„åˆåˆ°ä¸€èµ·ï¼Œç»™å‡ºä¸€æ¬¡èˆªè¡Œçš„ç»¼åˆè¯„çº§ã€‚

è°ƒç”¨æ–¹çš„ä»£ç å¤§æ¦‚æ˜¯è¿™æ ·ï¼š

```
const voyage = { zone: "west-indies", length: 10 };
const history = [
  { zone: "east-indies", profit: 5 },
  { zone: "west-indies", profit: 15 },
  { zone: "china", profit: -2 },
  { zone: "west-africa", profit: 7 },
];

const myRating = rating(voyage, history);
```

ä»£ç ä¸­æœ‰ä¸¤å¤„åŒæ ·çš„æ¡ä»¶é€»è¾‘ï¼Œéƒ½åœ¨è¯¢é—®â€œæ˜¯å¦æœ‰åˆ°ä¸­å›½çš„èˆªç¨‹â€ä»¥åŠâ€œèˆ¹é•¿æ˜¯å¦æ›¾å»è¿‡ä¸­å›½â€ã€‚

```
function rating(voyage, history) {
 const vpf = voyageProfitFactor(voyage, history);
 const vr = voyageRisk(voyage);
 const chr = captainHistoryRisk(voyage, history);
 if (vpf * 3 > (vr + chr * 2)) return "A";
 else return "B";
}
function voyageRisk(voyage) {
 let result = 1;
 if (voyage.length > 4) result += 2;
 if (voyage.length > 8) result += voyage.length - 8;
 if (["china", "east-indies"].includes(voyage.zone)) result += 4;
 return Math.max(result, 0);
}
function captainHistoryRisk(voyage, history) {
 let result = 1;
 if (history.length < 5) result += 4;
 result += history.filter(v => v.profit < 0).length;
 if (voyage.zone === "china" &amp;&amp; hasChina(history)) result -= 2;
 return Math.max(result, 0);
}
function hasChina(history) {
 return history.some(v => "china" === v.zone);
}
function voyageProfitFactor(voyage, history) {
 let result = 2;
 if (voyage.zone === "china") result += 1;
 if (voyage.zone === "east-indies") result += 1;
 if (voyage.zone === "china" &amp;&amp; hasChina(history)) {
  result += 3;
  if (history.length > 10) result += 1;
  if (voyage.length > 12) result += 1;
  if (voyage.length > 18) result -= 1;
 }
 else {
  if (history.length > 8) result += 1;
  if (voyage.length > 14) result -= 1;
 }
 return result;
}
```

æˆ‘ä¼šç”¨ç»§æ‰¿å’Œå¤šæ€å°†å¤„ç†â€œä¸­å›½å› ç´ â€çš„é€»è¾‘ä»åŸºç¡€é€»è¾‘ä¸­åˆ†ç¦»å‡ºæ¥ã€‚å¦‚æœè¿˜è¦å¼•å…¥æ›´å¤šçš„ç‰¹æ®Šé€»è¾‘ï¼Œè¿™ä¸ªé‡æ„å°±å¾ˆæœ‰ç”¨â€”â€”è¿™äº›é‡å¤çš„â€œä¸­å›½å› ç´ â€ä¼šæ··æ·†è§†å¬ï¼Œè®©åŸºç¡€é€»è¾‘éš¾ä»¥ç†è§£ã€‚

èµ·åˆä»£ç é‡Œåªæœ‰ä¸€å †å‡½æ•°ï¼Œå¦‚æœè¦å¼•å…¥å¤šæ€çš„è¯ï¼Œæˆ‘éœ€è¦å…ˆå»ºç«‹ä¸€ä¸ªç±»ç»“æ„ï¼Œå› æ­¤æˆ‘é¦–å…ˆä½¿ç”¨å‡½æ•°ç»„åˆæˆç±»ï¼ˆ144ï¼‰ã€‚è¿™ä¸€æ­¥é‡æ„çš„ç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼š

```
function rating(voyage, history) {
 return new Rating(voyage, history).value;
}

class Rating {
 constructor(voyage, history) {
  this.voyage = voyage;
  this.history = history;
 }
 get value() {
  const vpf = this.voyageProfitFactor;
  const vr = this.voyageRisk;
  const chr = this.captainHistoryRisk;
  if (vpf * 3 > (vr + chr * 2)) return "A";
  else return "B";
 }
 get voyageRisk() {
  let result = 1;
  if (this.voyage.length > 4) result += 2;
  if (this.voyage.length > 8) result += this.voyage.length - 8;
  if (["china", "east-indies"].includes(this.voyage.zone)) result += 4;
  return Math.max(result, 0);
 }
 get captainHistoryRisk() {
  let result = 1;
  if (this.history.length < 5) result += 4;
  result += this.history.filter(v => v.profit < 0).length;
  if (this.voyage.zone === "china" &amp;&amp; this.hasChinaHistory) result -= 2;
  return Math.max(result, 0);
 }
 get voyageProfitFactor() {
  let result = 2;

  if (this.voyage.zone === "china") result += 1;
  if (this.voyage.zone === "east-indies") result += 1;
  if (this.voyage.zone === "china" &amp;&amp; this.hasChinaHistory) {
   result += 3;
   if (this.history.length > 10) result += 1;
   if (this.voyage.length > 12) result += 1;
   if (this.voyage.length > 18) result -= 1;
  }
  else {
   if (this.history.length > 8) result += 1;
   if (this.voyage.length > 14) result -= 1;
  }
  return result;
 }
 get hasChinaHistory() {
  return this.history.some(v => "china" === v.zone);
 }
}
```

äºæ˜¯æˆ‘å°±æœ‰äº†ä¸€ä¸ªç±»ï¼Œç”¨æ¥å®‰æ”¾åŸºç¡€é€»è¾‘ã€‚ç°åœ¨æˆ‘éœ€è¦å¦å»ºä¸€ä¸ªç©ºçš„å­ç±»ï¼Œç”¨æ¥å®‰æ”¾ä¸è¶…ç±»ä¸åŒçš„è¡Œä¸ºã€‚

```
class ExperiencedChinaRating extends Rating {}
```

ç„¶åï¼Œå»ºç«‹ä¸€ä¸ªå·¥å‚å‡½æ•°ï¼Œç”¨äºåœ¨éœ€è¦æ—¶è¿”å›å˜ä½“ç±»ã€‚

```
function createRating(voyage, history) {
 if (voyage.zone === "china" &amp;&amp; history.some(v => "china" === v.zone))
  return new ExperiencedChinaRating(voyage, history);
 else return new Rating(voyage, history);
}
```

æˆ‘éœ€è¦ä¿®æ”¹æ‰€æœ‰è°ƒç”¨æ–¹ä»£ç ï¼Œè®©å®ƒä»¬ä½¿ç”¨è¯¥å·¥å‚å‡½æ•°ï¼Œè€Œä¸è¦ç›´æ¥è°ƒç”¨æ„é€ å‡½æ•°ã€‚è¿˜å¥½ç°åœ¨è°ƒç”¨æ„é€ å‡½æ•°çš„åªæœ‰ rating å‡½æ•°ä¸€å¤„ã€‚

```
function rating(voyage, history) {
  return createRating(voyage, history).value;
}
```

æœ‰ä¸¤å¤„è¡Œä¸ºéœ€è¦ç§»å…¥å­ç±»ä¸­ã€‚æˆ‘å…ˆå¤„ç† captainHistoryRisk ä¸­çš„é€»è¾‘ã€‚

**class Rating...**

```
get captainHistoryRisk() {
 let result = 1;
 if (this.history.length < 5) result += 4;
 result += this.history.filter(v => v.profit < 0).length;
 if (this.voyage.zone === "china" &amp;&amp; this.hasChinaHistory) result -= 2;
 return Math.max(result, 0);
}
```

åœ¨å­ç±»ä¸­è¦†å†™è¿™ä¸ªå‡½æ•°ã€‚

class ExperiencedChinaRating

```
get captainHistoryRisk() {
  const result = super.captainHistoryRisk - 2;
  return Math.max(result, 0);
}
```

**class Rating...**

```
get captainHistoryRisk() {
 let result = 1;
 if (this.history.length < 5) result += 4;
 result += this.history.filter(v => v.profit < 0).length;
 if (this.voyage.zone === "china" &amp;&amp; this.hasChinaHistory) result -= 2;
 return Math.max(result, 0);
}
```

åˆ†ç¦» voyageProfitFactor å‡½æ•°ä¸­çš„å˜ä½“è¡Œä¸ºè¦æ›´éº»çƒ¦ä¸€äº›ã€‚æˆ‘ä¸èƒ½ç›´æ¥ä»è¶…ç±»ä¸­åˆ æ‰å˜ä½“è¡Œä¸ºï¼Œå› ä¸ºåœ¨è¶…ç±»ä¸­è¿˜æœ‰å¦ä¸€æ¡æ‰§è¡Œè·¯å¾„ã€‚æˆ‘åˆä¸æƒ³æŠŠæ•´ä¸ªè¶…ç±»ä¸­çš„å‡½æ•°å¤åˆ¶åˆ°å­ç±»ä¸­ã€‚

**class Rating...**

```
get voyageProfitFactor() {
 let result = 2;

 if (this.voyage.zone === "china") result += 1;
 if (this.voyage.zone === "east-indies") result += 1;
 if (this.voyage.zone === "china" &amp;&amp; this.hasChinaHistory) {
  result += 3;
  if (this.history.length > 10) result += 1;
  if (this.voyage.length > 12) result += 1;
  if (this.voyage.length > 18) result -= 1;
 }
 else {
  if (this.history.length > 8) result += 1;
  if (this.voyage.length > 14) result -= 1;
 }
 return result;
}
```

æ‰€ä»¥æˆ‘å…ˆç”¨æç‚¼å‡½æ•°ï¼ˆ106ï¼‰å°†æ•´ä¸ªæ¡ä»¶é€»è¾‘å—æç‚¼å‡ºæ¥ã€‚

**class Rating...**

```
get voyageProfitFactor() {
 let result = 2;

 if (this.voyage.zone === "china") result += 1;
 if (this.voyage.zone === "east-indies") result += 1;
 result += this.voyageAndHistoryLengthFactor;
 return result;
}
get voyageAndHistoryLengthFactor() {
 let result = 0;
 if (this.voyage.zone === "china" &amp;&amp; this.hasChinaHistory) {
  result += 3;
  if (this.history.length > 10) result += 1;
  if (this.voyage.length > 12) result += 1;
  if (this.voyage.length > 18) result -= 1;
 }
 else {
  if (this.history.length > 8) result += 1;
  if (this.voyage.length > 14) result -= 1;
 }
 return result;
}
```

å‡½æ•°åä¸­å‡ºç°â€œAndâ€å­—æ ·æ˜¯ä¸€ä¸ªå¾ˆä¸å¥½çš„å‘³é“ï¼Œä¸è¿‡æˆ‘ä¼šæš‚æ—¶å®¹å¿å®ƒï¼Œå…ˆèšç„¦å­ç±»åŒ–æ“ä½œã€‚

**class Rating...**

```
get voyageAndHistoryLengthFactor() {
 let result = 0;
 if (this.history.length > 8) result += 1;
 if (this.voyage.length > 14) result -= 1;
 return result;
}
```

**class ExperiencedChinaRating...**

```
get voyageAndHistoryLengthFactor() {
 let result = 0;
 result += 3;
 if (this.history.length > 10) result += 1;
 if (this.voyage.length > 12) result += 1;
 if (this.voyage.length > 18) result -= 1;
 return result;
}
```

ä¸¥æ ¼è¯´æ¥ï¼Œé‡æ„åˆ°è¿™å„¿å°±ç»“æŸäº†â€”â€”æˆ‘å·²ç»æŠŠå˜ä½“è¡Œä¸ºåˆ†ç¦»åˆ°äº†å­ç±»ä¸­ï¼Œè¶…ç±»çš„é€»è¾‘ç†è§£å’Œç»´æŠ¤èµ·æ¥æ›´ç®€å•äº†ï¼Œåªæœ‰åœ¨è¿›å…¥å­ç±»ä»£ç æ—¶æˆ‘æ‰éœ€è¦æ“å¿ƒå˜ä½“é€»è¾‘ã€‚å­ç±»çš„ä»£ç è¡¨è¿°äº†å®ƒä¸è¶…ç±»çš„å·®å¼‚ã€‚

ä½†æˆ‘è§‰å¾—è‡³å°‘åº”è¯¥è°ˆè°ˆå¦‚ä½•å¤„ç†è¿™ä¸ªä¸‘é™‹çš„æ–°å‡½æ•°ã€‚å¼•å…¥ä¸€ä¸ªå‡½æ•°ä»¥ä¾¿å­ç±»è¦†å†™ï¼Œè¿™åœ¨å¤„ç†è¿™ç§â€œåŸºç¡€å’Œå˜ä½“â€çš„ç»§æ‰¿å…³ç³»æ—¶æ˜¯å¸¸è§æ“ä½œã€‚ä½†è¿™æ ·ä¸€ä¸ªéš¾çœ‹çš„å‡½æ•°åªä¼šå¦¨ç¢â€”â€”è€Œä¸æ˜¯å¸®åŠ©â€”â€”åˆ«äººç†è§£å…¶ä¸­çš„é€»è¾‘ã€‚

å‡½æ•°åä¸­çš„â€œAndâ€å­—æ ·è¯´æ˜å…¶ä¸­åŒ…å«äº†ä¸¤ä»¶äº‹ï¼Œæ‰€ä»¥æˆ‘è§‰å¾—åº”è¯¥å°†å®ƒä»¬åˆ†å¼€ã€‚æˆ‘ä¼šç”¨æç‚¼å‡½æ•°ï¼ˆ106ï¼‰æŠŠâ€œå†å²èˆªè¡Œæ•°â€ï¼ˆhistory lengthï¼‰çš„ç›¸å…³é€»è¾‘æç‚¼å‡ºæ¥ã€‚è¿™ä¸€æ­¥æç‚¼åœ¨è¶…ç±»å’Œå­ç±»ä¸­éƒ½è¦å‘ç”Ÿï¼Œæˆ‘é¦–å…ˆä»è¶…ç±»å¼€å§‹ã€‚

**class Rating...**

```
get voyageAndHistoryLengthFactor() {
 let result = 0;
 result += this.historyLengthFactor;
 if (this.voyage.length > 14) result -= 1;
 return result;
}
get historyLengthFactor() {
 return (this.history.length > 8) ? 1 : 0;
}
```

ç„¶ååœ¨å­ç±»ä¸­ä¹Ÿå¦‚æ³•ç‚®åˆ¶ã€‚

**class ExperiencedChinaRating...**

```
get voyageAndHistoryLengthFactor() {
 let result = 0;
 result += 3;
 result += this.historyLengthFactor;
 if (this.voyage.length > 12) result += 1;
 if (this.voyage.length > 18) result -= 1;
 return result;
}
get historyLengthFactor() {
 return (this.history.length > 10) ? 1 : 0;
}
```

ç„¶ååœ¨è¶…ç±»ä¸­ä½¿ç”¨æ¬ç§»è¯­å¥åˆ°è°ƒç”¨è€…ï¼ˆ217ï¼‰ã€‚

**class Rating...**

```
get voyageProfitFactor() {
 let result = 2;
 if (this.voyage.zone === "china") result += 1;
 if (this.voyage.zone === "east-indies") result += 1;
 result += this.historyLengthFactor;
 result += this.voyageAndHistoryLengthFactor;
 return result;
}

get voyageAndHistoryLengthFactor() {
 let result = 0;
 result += this.historyLengthFactor;
 if (this.voyage.length > 14) result -= 1;
 return result;
}
```

**class ExperiencedChinaRating...**

```
get voyageAndHistoryLengthFactor() {
 let result = 0;
 result += 3;
 result += this.historyLengthFactor;
 if (this.voyage.length > 12) result += 1;
 if (this.voyage.length > 18) result -= 1;
 return result;
}
```

å†ç”¨å‡½æ•°æ”¹åï¼ˆ124ï¼‰æ”¹æ‰è¿™ä¸ªéš¾å¬çš„åå­—ã€‚

**class Rating...**

```
get voyageProfitFactor() {
 let result = 2;
 if (this.voyage.zone === "china") result += 1;
 if (this.voyage.zone === "east-indies") result += 1;
 result += this.historyLengthFactor;
 result += this.voyageLengthFactor;
 return result;
}

get voyageLengthFactor() {
 return (this.voyage.length > 14) ? - 1: 0;
}
```

æ”¹ä¸ºä¸‰å…ƒè¡¨è¾¾å¼ï¼Œä»¥ç®€åŒ– voyageLengthFactor å‡½æ•°ã€‚

**class ExperiencedChinaRating...**

```
get voyageLengthFactor() {
 let result = 0;
 result += 3;
 if (this.voyage.length > 12) result += 1;
 if (this.voyage.length > 18) result -= 1;
 return result;
}
```

æœ€åä¸€ä»¶äº‹ï¼šåœ¨â€œèˆªç¨‹æ•°â€ï¼ˆvoyage lengthï¼‰å› ç´ ä¸ŠåŠ ä¸Š 3 åˆ†ï¼Œæˆ‘è®¤ä¸ºè¿™ä¸ªé€»è¾‘ä¸åˆç†ï¼Œåº”è¯¥æŠŠè¿™ 3 åˆ†åŠ åœ¨æœ€ç»ˆçš„ç»“æœä¸Šã€‚

**class ExperiencedChinaRating...**

```
get voyageProfitFactor() {
  return super.voyageProfitFactor + 3;
}

get voyageLengthFactor() {
  let result = 0;
  result += 3;
  if (this.voyage.length > 12) result += 1;
  if (this.voyage.length > 18) result -= 1;
  return result;
}
```

é‡æ„ç»“æŸï¼Œæˆ‘å¾—åˆ°äº†å¦‚ä¸‹ä»£ç ã€‚é¦–å…ˆï¼Œæˆ‘æœ‰ä¸€ä¸ªåŸºæœ¬çš„ Rating ç±»ï¼Œå…¶ä¸­ä¸è€ƒè™‘ä¸â€œä¸­å›½ç»éªŒâ€ç›¸å…³çš„å¤æ‚æ€§ï¼š

```
class Rating {
 constructor(voyage, history) {
  this.voyage = voyage;
  this.history = history;
 }
 get value() {
  const vpf = this.voyageProfitFactor;
  const vr = this.voyageRisk;
  const chr = this.captainHistoryRisk;
  if (vpf * 3 > (vr + chr * 2)) return "A";
  else return "B";
 }
 get voyageRisk() {
  let result = 1;
  if (this.voyage.length > 4) result += 2;
  if (this.voyage.length > 8) result += this.voyage.length - 8;
  if (["china", "east-indies"].includes(this.voyage.zone)) result += 4;
  return Math.max(result, 0);
 }
 get captainHistoryRisk() {
  let result = 1;
  if (this.history.length < 5) result += 4;
  result += this.history.filter(v => v.profit < 0).length;
  return Math.max(result, 0);
 }
 get voyageProfitFactor() {
  let result = 2;
  if (this.voyage.zone === "china") result += 1;
  if (this.voyage.zone === "east-indies") result += 1;
  result += this.historyLengthFactor;
  result += this.voyageLengthFactor;
  return result;
 }
 get voyageLengthFactor() {
  return (this.voyage.length > 14) ? - 1: 0;
 }
 get historyLengthFactor() {
  return (this.history.length > 8) ? 1 : 0;
 }
}
```

ä¸â€œä¸­å›½ç»éªŒâ€ç›¸å…³çš„ä»£ç åˆ™æ¸…æ™°è¡¨è¿°å‡ºåœ¨åŸºæœ¬é€»è¾‘ä¹‹ä¸Šçš„ä¸€ç³»åˆ—å˜ä½“é€»è¾‘ï¼š

```
class ExperiencedChinaRating extends Rating {
 get captainHistoryRisk() {
  const result = super.captainHistoryRisk - 2;
  return Math.max(result, 0);
 }
 get voyageLengthFactor() {
  let result = 0;
  if (this.voyage.length > 12) result += 1;
  if (this.voyage.length > 18) result -= 1;
  return result;
 }
 get historyLengthFactor() {
  return (this.history.length > 10) ? 1 : 0;
 }
 get voyageProfitFactor() {
  return super.voyageProfitFactor + 3;
 }
}
```

## 10.5 å¼•å…¥ç‰¹ä¾‹ï¼ˆIntroduce Special Caseï¼‰

æ›¾ç”¨åï¼šå¼•å…¥ Null å¯¹è±¡ï¼ˆIntroduce Null Objectï¼‰

```
if (aCustomer === "unknown") customerName = "occupant";


class UnknownCustomer {
  get name() {return "occupant";}
```

### åŠ¨æœº

ä¸€ç§å¸¸è§çš„é‡å¤ä»£ç æ˜¯è¿™ç§æƒ…å†µï¼šä¸€ä¸ªæ•°æ®ç»“æ„çš„ä½¿ç”¨è€…éƒ½åœ¨æ£€æŸ¥æŸä¸ªç‰¹æ®Šçš„å€¼ï¼Œå¹¶ä¸”å½“è¿™ä¸ªç‰¹æ®Šå€¼å‡ºç°æ—¶æ‰€åšçš„å¤„ç†ä¹Ÿéƒ½ç›¸åŒã€‚å¦‚æœæˆ‘å‘ç°ä»£ç åº“ä¸­æœ‰å¤šå¤„ä»¥åŒæ ·æ–¹å¼åº”å¯¹åŒä¸€ä¸ªç‰¹æ®Šå€¼ï¼Œæˆ‘å°±ä¼šæƒ³è¦æŠŠè¿™ä¸ªå¤„ç†é€»è¾‘æ”¶æ‹¢åˆ°ä¸€å¤„ã€‚

å¤„ç†è¿™ç§æƒ…å†µçš„ä¸€ä¸ªå¥½åŠæ³•æ˜¯ä½¿ç”¨â€œç‰¹ä¾‹â€ï¼ˆSpecial Caseï¼‰æ¨¡å¼ï¼šåˆ›å»ºä¸€ä¸ªç‰¹ä¾‹å…ƒç´ ï¼Œç”¨ä»¥è¡¨è¾¾å¯¹è¿™ç§ç‰¹ä¾‹çš„å…±ç”¨è¡Œä¸ºçš„å¤„ç†ã€‚è¿™æ ·æˆ‘å°±å¯ä»¥ç”¨ä¸€ä¸ªå‡½æ•°è°ƒç”¨å–ä»£å¤§éƒ¨åˆ†ç‰¹ä¾‹æ£€æŸ¥é€»è¾‘ã€‚

ç‰¹ä¾‹æœ‰å‡ ç§è¡¨ç°å½¢å¼ã€‚å¦‚æœæˆ‘åªéœ€è¦ä»è¿™ä¸ªå¯¹è±¡è¯»å–æ•°æ®ï¼Œå¯ä»¥æä¾›ä¸€ä¸ªå­—é¢é‡å¯¹è±¡ï¼ˆliteral objectï¼‰ï¼Œå…¶ä¸­æ‰€æœ‰çš„å€¼éƒ½æ˜¯é¢„å…ˆå¡«å……å¥½çš„ã€‚å¦‚æœé™¤ç®€å•çš„æ•°å€¼ä¹‹å¤–è¿˜éœ€è¦æ›´å¤šçš„è¡Œä¸ºï¼Œå°±éœ€è¦åˆ›å»ºä¸€ä¸ªç‰¹æ®Šå¯¹è±¡ï¼Œå…¶ä¸­åŒ…å«æ‰€æœ‰å…±ç”¨è¡Œä¸ºæ‰€å¯¹åº”çš„å‡½æ•°ã€‚ç‰¹ä¾‹å¯¹è±¡å¯ä»¥ç”±ä¸€ä¸ªå°è£…ç±»æ¥è¿”å›ï¼Œä¹Ÿå¯ä»¥é€šè¿‡å˜æ¢æ’å…¥ä¸€ä¸ªæ•°æ®ç»“æ„ã€‚

ä¸€ä¸ªé€šå¸¸éœ€è¦ç‰¹ä¾‹å¤„ç†çš„å€¼å°±æ˜¯ nullï¼Œè¿™ä¹Ÿæ˜¯è¿™ä¸ªæ¨¡å¼å¸¸è¢«å«ä½œâ€œNull å¯¹è±¡â€ï¼ˆNull Objectï¼‰æ¨¡å¼çš„åŸå› â€”â€”æˆ‘å–œæ¬¢è¯´ï¼šNull å¯¹è±¡æ˜¯ç‰¹ä¾‹çš„ä¸€ç§ç‰¹ä¾‹ã€‚

### åšæ³•

æˆ‘ä»¬ä»ä¸€ä¸ªä½œä¸ºå®¹å™¨çš„æ•°æ®ç»“æ„ï¼ˆæˆ–è€…ç±»ï¼‰å¼€å§‹ï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ªå±æ€§ï¼Œè¯¥å±æ€§å°±æ˜¯æˆ‘ä»¬è¦é‡æ„çš„ç›®æ ‡ã€‚å®¹å™¨çš„å®¢æˆ·ç«¯æ¯æ¬¡ä½¿ç”¨è¿™ä¸ªå±æ€§æ—¶ï¼Œéƒ½éœ€è¦å°†å…¶ä¸æŸä¸ªç‰¹ä¾‹å€¼åšæ¯”å¯¹ã€‚æˆ‘ä»¬å¸Œæœ›æŠŠè¿™ä¸ªç‰¹ä¾‹å€¼æ›¿æ¢ä¸ºä»£è¡¨è¿™ç§ç‰¹ä¾‹æƒ…å†µçš„ç±»æˆ–æ•°æ®ç»“æ„ã€‚

ç»™é‡æ„ç›®æ ‡æ·»åŠ æ£€æŸ¥ç‰¹ä¾‹çš„å±æ€§ï¼Œä»¤å…¶è¿”å› falseã€‚

åˆ›å»ºä¸€ä¸ªç‰¹ä¾‹å¯¹è±¡ï¼Œå…¶ä¸­åªæœ‰æ£€æŸ¥ç‰¹ä¾‹çš„å±æ€§ï¼Œè¿”å› trueã€‚

å¯¹â€œä¸ç‰¹ä¾‹å€¼åšæ¯”å¯¹â€çš„ä»£ç è¿ç”¨æç‚¼å‡½æ•°ï¼ˆ106ï¼‰ï¼Œç¡®ä¿æ‰€æœ‰å®¢æˆ·ç«¯éƒ½ä½¿ç”¨è¿™ä¸ªæ–°å‡½æ•°ï¼Œè€Œä¸å†ç›´æ¥åšç‰¹ä¾‹å€¼çš„æ¯”å¯¹ã€‚

å°†æ–°çš„ç‰¹ä¾‹å¯¹è±¡å¼•å…¥ä»£ç ä¸­ï¼Œå¯ä»¥ä»å‡½æ•°è°ƒç”¨ä¸­è¿”å›ï¼Œä¹Ÿå¯ä»¥åœ¨å˜æ¢å‡½æ•°ä¸­ç”Ÿæˆã€‚

ä¿®æ”¹ç‰¹ä¾‹æ¯”å¯¹å‡½æ•°çš„ä¸»ä½“ï¼Œåœ¨å…¶ä¸­ç›´æ¥ä½¿ç”¨æ£€æŸ¥ç‰¹ä¾‹çš„å±æ€§ã€‚

æµ‹è¯•ã€‚

ä½¿ç”¨å‡½æ•°ç»„åˆæˆç±»ï¼ˆ144ï¼‰æˆ–å‡½æ•°ç»„åˆæˆå˜æ¢ï¼ˆ149ï¼‰ï¼ŒæŠŠé€šç”¨çš„ç‰¹ä¾‹å¤„ç†é€»è¾‘éƒ½æ¬ç§»åˆ°æ–°å»ºçš„ç‰¹ä¾‹å¯¹è±¡ä¸­ã€‚

ç‰¹ä¾‹ç±»å¯¹äºç®€å•çš„è¯·æ±‚é€šå¸¸ä¼šè¿”å›å›ºå®šçš„å€¼ï¼Œå› æ­¤å¯ä»¥å°†å…¶å®ç°ä¸ºå­—é¢è®°å½•ï¼ˆliteral recordï¼‰ã€‚

å¯¹ç‰¹ä¾‹æ¯”å¯¹å‡½æ•°ä½¿ç”¨å†…è”å‡½æ•°ï¼ˆ115ï¼‰ï¼Œå°†å…¶å†…è”åˆ°ä»ç„¶éœ€è¦çš„åœ°æ–¹ã€‚

### èŒƒä¾‹

ä¸€å®¶æä¾›å…¬å…±äº‹ä¸šæœåŠ¡çš„å…¬å¸å°†è‡ªå·±çš„æœåŠ¡å®‰è£…åœ¨å„ä¸ªåœºæ‰€ï¼ˆsiteï¼‰ã€‚

**class Site...**

```
get customer() {return this._customer;}
```

ä»£è¡¨â€œé¡¾å®¢â€çš„ Customer ç±»æœ‰å¤šä¸ªå±æ€§ï¼Œæˆ‘åªè€ƒè™‘å…¶ä¸­ 3 ä¸ªã€‚

**class Customer...**

```
get name()           {...}
get billingPlan()    {...}
set billingPlan(arg) {...}
get paymentHistory() {...}
```

å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œä¸€ä¸ªåœºæ‰€ä¼šå¯¹åº”ä¸€ä¸ªé¡¾å®¢ï¼Œä½†æœ‰äº›åœºæ‰€æ²¡æœ‰ä¸ä¹‹å¯¹åº”çš„é¡¾å®¢ï¼Œå¯èƒ½æ˜¯å› ä¸ºä¹‹å‰çš„ä½æˆ·æ¬èµ°äº†ï¼Œè€Œæ–°æ¬æ¥çš„ä½æˆ·æˆ‘è¿˜ä¸çŸ¥é“æ˜¯è°ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œæ•°æ®è®°å½•ä¸­çš„ customer å­—æ®µä¼šè¢«å¡«å……ä¸ºå­—ç¬¦ä¸²"unknown"ã€‚å› ä¸ºè¿™ç§æƒ…å†µæ—¶æœ‰å‘ç”Ÿï¼Œæ‰€ä»¥ Site å¯¹è±¡çš„å®¢æˆ·ç«¯å¿…é¡»æœ‰åŠæ³•å¤„ç†â€œé¡¾å®¢æœªçŸ¥â€çš„æƒ…å†µã€‚ä¸‹é¢æ˜¯ä¸€äº›ç¤ºä¾‹ä»£ç ç‰‡æ®µã€‚

**å®¢æˆ·ç«¯ 1...**

```
const aCustomer = site.customer;
// ... lots of intervening code ...
let customerName;
if (aCustomer === "unknown") customerName = "occupant";
else customerName = aCustomer.name;
```

**å®¢æˆ·ç«¯ 2...**

```
const plan =
  aCustomer === "unknown" ? registry.billingPlans.basic : aCustomer.billingPlan;
```

**å®¢æˆ·ç«¯ 3...**

```
if (aCustomer !== "unknown") aCustomer.billingPlan = newPlan;
```

**å®¢æˆ·ç«¯ 4...**

```
const weeksDelinquent =
  aCustomer === "unknown"
    ? 0
    : aCustomer.paymentHistory.weeksDelinquentInLastYear;
```

æµè§ˆæ•´ä¸ªä»£ç åº“ï¼Œæˆ‘çœ‹åˆ°æœ‰å¾ˆå¤šä½¿ç”¨ Site å¯¹è±¡çš„å®¢æˆ·ç«¯åœ¨å¤„ç†â€œé¡¾å®¢æœªçŸ¥â€çš„æƒ…å†µï¼Œå¤§å¤šæ•°éƒ½ç”¨äº†åŒæ ·çš„åº”å¯¹æ–¹å¼ï¼šç”¨"occupant"ï¼ˆå±…æ°‘ï¼‰ä½œä¸ºé¡¾å®¢åï¼Œä½¿ç”¨åŸºæœ¬çš„è®¡ä»·å¥—é¤ï¼Œå¹¶è®¤ä¸ºè¿™å®¶é¡¾å®¢æ²¡æœ‰æ¬ è´¹ã€‚åˆ°å¤„éƒ½åœ¨æ£€æŸ¥è¿™ç§ç‰¹ä¾‹ï¼Œå†åŠ ä¸Šå¯¹ç‰¹ä¾‹çš„å¤„ç†æ–¹å¼é«˜åº¦ä¸€è‡´ï¼Œè¿™äº›ç°è±¡å‘Šè¯‰æˆ‘ï¼šæ˜¯æ—¶å€™ä½¿ç”¨ç‰¹ä¾‹å¯¹è±¡ï¼ˆSpecial Case Objectï¼‰æ¨¡å¼äº†ã€‚

æˆ‘é¦–å…ˆç»™ Customer æ·»åŠ ä¸€ä¸ªå‡½æ•°ï¼Œç”¨äºæŒ‡ç¤ºâ€œè¿™ä¸ªé¡¾å®¢æ˜¯å¦æœªçŸ¥â€ã€‚

**class Customer...**

```
get isUnknown() {return false;}
```

ç„¶åæˆ‘ç»™â€œæœªçŸ¥çš„é¡¾å®¢â€ä¸“é—¨åˆ›å»ºä¸€ä¸ªç±»ã€‚

```
class UnknownCustomer {
  get isUnknown() {
    return true;
  }
}
```

æ³¨æ„ï¼Œæˆ‘æ²¡æœ‰æŠŠ UnknownCustomer ç±»å£°æ˜ä¸º Customer çš„å­ç±»ã€‚åœ¨å…¶ä»–ç¼–ç¨‹è¯­è¨€ï¼ˆå°¤å…¶æ˜¯é™æ€ç±»å‹çš„ç¼–ç¨‹è¯­è¨€ï¼‰ä¸­ï¼Œæˆ‘ä¼šéœ€è¦ç»§æ‰¿å…³ç³»ã€‚ä½† JavaScript æ˜¯ä¸€ç§åŠ¨æ€ç±»å‹è¯­è¨€ï¼ŒæŒ‰ç…§å®ƒçš„å­ç±»åŒ–è§„åˆ™ï¼Œè¿™é‡Œä¸å£°æ˜ç»§æ‰¿å…³ç³»åè€Œæ›´å¥½ã€‚

ä¸‹é¢å°±æ˜¯éº»çƒ¦ä¹‹å¤„äº†ã€‚æˆ‘å¿…é¡»åœ¨æ‰€æœ‰æœŸæœ›å¾—åˆ°"unknown"å€¼çš„åœ°æ–¹è¿”å›è¿™ä¸ªæ–°çš„ç‰¹ä¾‹å¯¹è±¡ï¼Œå¹¶ä¿®æ”¹æ‰€æœ‰æ£€æŸ¥"unknown"å€¼çš„åœ°æ–¹ï¼Œä»¤å…¶ä½¿ç”¨æ–°çš„ isUnknown å‡½æ•°ã€‚ä¸€èˆ¬è€Œè¨€ï¼Œæˆ‘æ€»æ˜¯å¸Œæœ›ç»†å¿ƒå®‰æ’ä¿®æ”¹è¿‡ç¨‹ï¼Œä½¿æˆ‘å¯ä»¥æ¯æ¬¡åšä¸€ç‚¹å°ä¿®æ”¹ï¼Œç„¶åé©¬ä¸Šæµ‹è¯•ã€‚ä½†å¦‚æœæˆ‘ä¿®æ”¹äº† Customer ç±»ï¼Œä½¿å…¶è¿”å› UnknownCustomer å¯¹è±¡ï¼ˆè€Œé"unknown"å­—ç¬¦ä¸²ï¼‰ï¼Œé‚£ä¹ˆå°±å¿…é¡»åŒæ—¶ä¿®æ”¹æ‰€æœ‰å®¢æˆ·ç«¯ï¼Œè®©å®ƒä»¬ä¸è¦æ£€æŸ¥"unknown"å­—ç¬¦ä¸²ï¼Œè€Œæ˜¯è°ƒç”¨ isUnknown å‡½æ•°â€”â€”è¿™ä¸¤ä¸ªä¿®æ”¹å¿…é¡»ä¸€æ¬¡å®Œæˆã€‚æˆ‘æ„Ÿè§‰è¿™ä¸€å¤§æ­¥ä¿®æ”¹å°±åƒä¸€å¤§å—éš¾åƒçš„é£Ÿç‰©ä¸€æ ·éš¾ä»¥ä¸‹å’½ã€‚

è¿˜å¥½ï¼Œé‡åˆ°è¿™ç§å›°å¢ƒæ—¶ï¼Œæœ‰ä¸€ä¸ªå¸¸ç”¨çš„æŠ€å·§å¯ä»¥å¸®å¿™ã€‚å¦‚æœæœ‰ä¸€æ®µä»£ç éœ€è¦åœ¨å¾ˆå¤šåœ°æ–¹åšä¿®æ”¹ï¼ˆä¾‹å¦‚æˆ‘ä»¬è¿™é‡Œçš„â€œä¸ç‰¹ä¾‹åšæ¯”å¯¹â€çš„ä»£ç ï¼‰ï¼Œæˆ‘ä¼šå…ˆå¯¹å…¶ä½¿ç”¨æç‚¼å‡½æ•°ï¼ˆ106ï¼‰ã€‚

```
function isUnknown(arg) {
  if (!(arg instanceof Customer || arg === "unknown"))
    throw new Error(`investigate bad value: <${arg}>`);
  return arg === "unknown";
}
```

æˆ‘ä¼šæ”¾ä¸€ä¸ªé™·é˜±ï¼Œæ•æ‰æ„æ–™ä¹‹å¤–çš„å€¼ã€‚å¦‚æœåœ¨é‡æ„è¿‡ç¨‹ä¸­æˆ‘çŠ¯äº†é”™è¯¯ï¼Œå¼•å…¥äº†å¥‡æ€ªçš„è¡Œä¸ºï¼Œè¿™ä¸ªé™·é˜±ä¼šå¸®æˆ‘å‘ç°ã€‚

ç°åœ¨ï¼Œå‡¡æ˜¯æ£€æŸ¥æœªçŸ¥é¡¾å®¢çš„åœ°æ–¹ï¼Œéƒ½å¯ä»¥æ”¹ç”¨è¿™ä¸ªå‡½æ•°äº†ã€‚æˆ‘å¯ä»¥é€ä¸€ä¿®æ”¹è¿™äº›åœ°æ–¹ï¼Œæ¯æ¬¡ä¿®æ”¹ä¹‹åéƒ½å¯ä»¥æ‰§è¡Œæµ‹è¯•ã€‚

**å®¢æˆ·ç«¯ 1...**

```
let customerName;
if (isUnknown(aCustomer)) customerName = "occupant";
else customerName = aCustomer.name;
```

æ²¡ç”¨å¤šä¹…ï¼Œå°±å…¨éƒ¨ä¿®æ”¹å®Œäº†ã€‚

**å®¢æˆ·ç«¯ 2...**

```
const plan = isUnknown(aCustomer)
  ? registry.billingPlans.basic
  : aCustomer.billingPlan;
```

**å®¢æˆ·ç«¯ 3...**

```
if (!isUnknown(aCustomer)) aCustomer.billingPlan = newPlan;
```

**å®¢æˆ·ç«¯ 4...**

```
const weeksDelinquent = isUnknown(aCustomer)
  ? 0
  : aCustomer.paymentHistory.weeksDelinquentInLastYear;
```

å°†æ‰€æœ‰è°ƒç”¨å¤„éƒ½æ”¹ä¸ºä½¿ç”¨ isUnknown å‡½æ•°ä¹‹åï¼Œå°±å¯ä»¥ä¿®æ”¹ Site ç±»ï¼Œä»¤å…¶åœ¨é¡¾å®¢æœªçŸ¥æ—¶è¿”å› UnknownCustomer å¯¹è±¡ã€‚

**class Site...**

```
get customer() {
  return (this._customer === "unknown") ? new UnknownCustomer() : this._customer;
}
```

ç„¶åä¿®æ”¹ isUnknown å‡½æ•°çš„åˆ¤æ–­é€»è¾‘ã€‚åšå®Œè¿™æ­¥ä¿®æ”¹ä¹‹åæˆ‘å¯ä»¥åšä¸€æ¬¡å…¨æ–‡æœç´¢ï¼Œåº”è¯¥æ²¡æœ‰ä»»ä½•åœ°æ–¹ä½¿ç”¨"unknown"å­—ç¬¦ä¸²äº†ã€‚

**å®¢æˆ·ç«¯ 1...**

```
function isUnknown(arg) {
  if (!(arg instanceof Customer || arg instanceof UnknownCustomer))
    throw new Error(`investigate bad value: <${arg}>`);
  return arg.isUnknown;
}
```

æµ‹è¯•ï¼Œä»¥ç¡®ä¿ä¸€åˆ‡è¿è½¬å¦‚å¸¸ã€‚

ç°åœ¨ï¼Œæœ‰è¶£çš„éƒ¨åˆ†å¼€å§‹äº†ã€‚æˆ‘å¯ä»¥é€ä¸€æŸ¥çœ‹å®¢æˆ·ç«¯æ£€æŸ¥ç‰¹ä¾‹çš„ä»£ç ï¼Œçœ‹å®ƒä»¬å¤„ç†ç‰¹ä¾‹çš„é€»è¾‘ï¼Œå¹¶è€ƒè™‘æ˜¯å¦èƒ½ç”¨å‡½æ•°ç»„åˆæˆç±»ï¼ˆ144ï¼‰å°†å…¶æ›¿æ¢ä¸ºä¸€ä¸ªå…±åŒçš„ã€ç¬¦åˆé¢„æœŸçš„å€¼ã€‚æ­¤åˆ»ï¼Œæœ‰å¤šå¤„å®¢æˆ·ç«¯ä»£ç ç”¨å­—ç¬¦ä¸²"occupant"æ¥ä½œä¸ºæœªçŸ¥é¡¾å®¢çš„åå­—ï¼Œå°±åƒä¸‹é¢è¿™æ ·ã€‚

**å®¢æˆ·ç«¯ 1...**

```
let customerName;
if (isUnknown(aCustomer)) customerName = "occupant";
else customerName = aCustomer.name;
```

æˆ‘å¯ä»¥åœ¨ UnknownCustomer ç±»ä¸­æ·»åŠ ä¸€ä¸ªåˆé€‚çš„å‡½æ•°ã€‚

**class UnknownCustomer...**

```
get name() {return "occupant";}
```

ç„¶åæˆ‘å°±å¯ä»¥å»æ‰æ‰€æœ‰æ¡ä»¶ä»£ç ã€‚

**å®¢æˆ·ç«¯ 1...**

```
const customerName = aCustomer.name;
```

æµ‹è¯•é€šè¿‡ä¹‹åï¼Œæˆ‘å¯èƒ½ä¼šç”¨å†…è”å˜é‡ï¼ˆ123ï¼‰æŠŠ customerName å˜é‡ä¹Ÿæ¶ˆé™¤æ‰ã€‚

æ¥ä¸‹æ¥å¤„ç†ä»£è¡¨â€œè®¡ä»·å¥—é¤â€çš„ billingPlan å±æ€§ã€‚

**å®¢æˆ·ç«¯ 2...**

```
const plan = isUnknown(aCustomer)
  ? registry.billingPlans.basic
  : aCustomer.billingPlan;
```

**å®¢æˆ·ç«¯ 3...**

```
if (!isUnknown(aCustomer)) aCustomer.billingPlan = newPlan;
```

å¯¹äºè¯»å–è¯¥å±æ€§çš„è¡Œä¸ºï¼Œæˆ‘çš„å¤„ç†æ–¹æ³•è·Ÿå‰é¢å¤„ç† name å±æ€§ä¸€æ ·â€”â€”æ‰¾åˆ°é€šç”¨çš„åº”å¯¹æ–¹å¼ï¼Œå¹¶åœ¨ UnknownCustomer ä¸­ä½¿ç”¨ä¹‹ã€‚è‡³äºå¯¹è¯¥å±æ€§çš„å†™æ“ä½œï¼Œå½“å‰çš„ä»£ç æ²¡æœ‰å¯¹æœªçŸ¥é¡¾å®¢è°ƒç”¨è¿‡è®¾å€¼å‡½æ•°ï¼Œæ‰€ä»¥åœ¨ç‰¹ä¾‹å¯¹è±¡ä¸­ï¼Œæˆ‘ä¼šä¿ç•™è®¾å€¼å‡½æ•°ï¼Œä½†å…¶ä¸­ä»€ä¹ˆéƒ½ä¸åšã€‚

**class UnknownCustomer...**

```
get billingPlan()  {return registry.billingPlans.basic;}
set billingPlan(arg) { /* ignore */ }
```

**è¯»å–çš„ä¾‹å­...**

```
const plan = aCustomer.billingPlan;
```

**æ›´æ–°çš„ä¾‹å­...**

```
aCustomer.billingPlan = newPlan;
```

ç‰¹ä¾‹å¯¹è±¡æ˜¯å€¼å¯¹è±¡ï¼Œå› æ­¤åº”è¯¥å§‹ç»ˆæ˜¯ä¸å¯å˜çš„ï¼Œå³ä¾¿å®ƒä»¬æ›¿ä»£çš„åŸå¯¹è±¡æœ¬èº«æ˜¯å¯å˜çš„ã€‚

æœ€åä¸€ä¸ªä¾‹å­åˆ™æ›´éº»çƒ¦ä¸€äº›ï¼Œå› ä¸ºç‰¹ä¾‹å¯¹è±¡éœ€è¦è¿”å›å¦ä¸€ä¸ªå¯¹è±¡ï¼Œåè€…åˆæœ‰å…¶è‡ªå·±çš„å±æ€§ã€‚

**å®¢æˆ·ç«¯...**

```
const weeksDelinquent = isUnknown(aCustomer)
  ? 0
  : aCustomer.paymentHistory.weeksDelinquentInLastYear;
```

ä¸€èˆ¬çš„åŸåˆ™æ˜¯ï¼šå¦‚æœç‰¹ä¾‹å¯¹è±¡éœ€è¦è¿”å›å…³è”å¯¹è±¡ï¼Œè¢«è¿”å›çš„é€šå¸¸ä¹Ÿæ˜¯ç‰¹ä¾‹å¯¹è±¡ã€‚æ‰€ä»¥ï¼Œæˆ‘éœ€è¦åˆ›å»ºä¸€ä¸ªä»£è¡¨â€œç©ºæ”¯ä»˜è®°å½•â€çš„ç‰¹ä¾‹ç±» NullPaymentHistoryã€‚

**class UnknownCustomer...**

```
get paymentHistory() {return new NullPaymentHistory();}
```

**class NullPaymentHistory...**

```
get weeksDelinquentInLastYear() {return 0;}
```

**å®¢æˆ·ç«¯...**

```
const weeksDelinquent = aCustomer.paymentHistory.weeksDelinquentInLastYear;
```

æˆ‘ç»§ç»­æŸ¥çœ‹å®¢æˆ·ç«¯ä»£ç ï¼Œå¯»æ‰¾æ˜¯å¦æœ‰èƒ½ç”¨å¤šæ€è¡Œä¸ºå–ä»£çš„åœ°æ–¹ã€‚ä½†ä¹Ÿä¼šæœ‰ä¾‹å¤–æƒ…å†µâ€”â€”å®¢æˆ·ç«¯ä¸æƒ³ä½¿ç”¨ç‰¹ä¾‹å¯¹è±¡æä¾›çš„é€»è¾‘ï¼Œè€Œæ˜¯æƒ³åšä¸€äº›åˆ«çš„å¤„ç†ã€‚æˆ‘å¯èƒ½æœ‰ 23 å¤„å®¢æˆ·ç«¯ä»£ç ç”¨"occupant"ä½œä¸ºæœªçŸ¥é¡¾å®¢çš„åå­—ï¼Œä½†è¿˜æœ‰ä¸€å¤„ç”¨äº†åˆ«çš„å€¼ã€‚

**å®¢æˆ·ç«¯...**

```
const name = !isUnknown(aCustomer) ? aCustomer.name : "unknown occupant";
```

è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘åªèƒ½åœ¨å®¢æˆ·ç«¯ä¿ç•™ç‰¹ä¾‹æ£€æŸ¥çš„é€»è¾‘ã€‚æˆ‘ä¼šå¯¹å…¶åšäº›ä¿®æ”¹ï¼Œè®©å®ƒä½¿ç”¨ aCustomer å¯¹è±¡èº«ä¸Šçš„ isUnknown å‡½æ•°ï¼Œä¹Ÿå°±æ˜¯å¯¹å…¨å±€çš„ isUnknown å‡½æ•°ä½¿ç”¨å†…è”å‡½æ•°ï¼ˆ115ï¼‰ã€‚

**å®¢æˆ·ç«¯...**

```
const name = aCustomer.isUnknown ? "unknown occupant" : aCustomer.name;
```

å¤„ç†å®Œæ‰€æœ‰å®¢æˆ·ç«¯ä»£ç åï¼Œå…¨å±€çš„ isUnknown å‡½æ•°åº”è¯¥æ²¡äººå†è°ƒç”¨äº†ï¼Œå¯ä»¥ç”¨ç§»é™¤æ­»ä»£ç ï¼ˆ237ï¼‰å°†å…¶ç§»é™¤ã€‚

### èŒƒä¾‹ï¼šä½¿ç”¨å¯¹è±¡å­—é¢é‡

æˆ‘ä»¬åœ¨ä¸Šé¢å¤„ç†çš„å…¶å®æ˜¯ä¸€äº›å¾ˆç®€å•çš„å€¼ï¼Œå´è¦åˆ›å»ºä¸€ä¸ªè¿™æ ·çš„ç±»ï¼Œæœªå…æœ‰ç‚¹å„¿å¤§åŠ¨å¹²æˆˆã€‚ä½†åœ¨ä¸Šé¢è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘å¿…é¡»åˆ›å»ºè¿™æ ·ä¸€ä¸ªç±»ï¼Œå› ä¸º Customer ç±»æ˜¯å…è®¸ä½¿ç”¨è€…æ›´æ–°å…¶å†…å®¹çš„ã€‚ä½†å¦‚æœé¢å¯¹ä¸€ä¸ªåªè¯»çš„æ•°æ®ç»“æ„ï¼Œæˆ‘å°±å¯ä»¥æ”¹ç”¨å­—é¢é‡å¯¹è±¡ï¼ˆliteral objectï¼‰ã€‚

è¿˜æ˜¯å‰é¢è¿™ä¸ªä¾‹å­â€”â€”å‡ ä¹å®Œå…¨ä¸€æ ·ï¼Œé™¤äº†ä¸€ä»¶äº‹ï¼šè¿™æ¬¡æ²¡æœ‰å®¢æˆ·ç«¯å¯¹ Customer å¯¹è±¡åšæ›´æ–°æ“ä½œï¼š

**class Site...**

```
get customer() {return this._customer;}
```

**class Customer...**

```
get name()           {...}
get billingPlan()    {...}
set billingPlan(arg) {...}
get paymentHistory() {...}
```

**å®¢æˆ·ç«¯ 1...**

```
const aCustomer = site.customer;
// ... lots of intervening code ...
let customerName;
if (aCustomer === "unknown") customerName = "occupant";
else customerName = aCustomer.name;
```

**å®¢æˆ·ç«¯ 2...**

```
const plan =
  aCustomer === "unknown" ? registry.billingPlans.basic : aCustomer.billingPlan;
```

**å®¢æˆ·ç«¯ 3...**

```
const weeksDelinquent =
  aCustomer === "unknown"
    ? 0
    : aCustomer.paymentHistory.weeksDelinquentInLastYear;
```

å’Œå‰é¢çš„ä¾‹å­ä¸€æ ·ï¼Œæˆ‘é¦–å…ˆåœ¨ Customer ä¸­æ·»åŠ  isUnknown å±æ€§ï¼Œå¹¶åˆ›å»ºä¸€ä¸ªåŒ…å«åŒåå­—æ®µçš„ç‰¹ä¾‹å¯¹è±¡ã€‚è¿™æ¬¡çš„åŒºåˆ«åœ¨äºï¼Œç‰¹ä¾‹å¯¹è±¡æ˜¯ä¸€ä¸ªå­—é¢é‡ã€‚

**class Customer...**

```
get isUnknown() {return false;}
```

**é¡¶å±‚ä½œç”¨åŸŸ...**

```
function createUnknownCustomer() {
  return {
    isUnknown: true,
  };
}
```

ç„¶åæˆ‘å¯¹æ£€æŸ¥ç‰¹ä¾‹çš„æ¡ä»¶é€»è¾‘è¿ç”¨æç‚¼å‡½æ•°ï¼ˆ106ï¼‰ã€‚

```
function isUnknown(arg) {
  return arg === "unknown";
}
```

**å®¢æˆ·ç«¯ 1...**

```
let customerName;
if (isUnknown(aCustomer)) customerName = "occupant";
else customerName = aCustomer.name;
```

**å®¢æˆ·ç«¯ 2...**

```
const plan = isUnknown(aCustomer)
  ? registry.billingPlans.basic
  : aCustomer.billingPlan;
```

**å®¢æˆ·ç«¯ 3...**

```
const weeksDelinquent = isUnknown(aCustomer)
  ? 0
  : aCustomer.paymentHistory.weeksDelinquentInLastYear;
```

ä¿®æ”¹ Site ç±»å’Œåšæ¡ä»¶åˆ¤æ–­çš„ isUnknown å‡½æ•°ï¼Œå¼€å§‹ä½¿ç”¨ç‰¹ä¾‹å¯¹è±¡ã€‚

**class Site...**

```
get customer() {
  return (this._customer === "unknown") ? createUnknownCustomer() : this._customer;
}
```

**é¡¶å±‚ä½œç”¨åŸŸ...**

```
function isUnknown(arg) {
  return arg.isUnknown;
}
```

ç„¶åæŠŠâ€œä»¥æ ‡å‡†æ–¹å¼åº”å¯¹ç‰¹ä¾‹â€çš„åœ°æ–¹éƒ½æ›¿æ¢æˆä½¿ç”¨ç‰¹ä¾‹å­—é¢é‡çš„å€¼ã€‚é¦–å…ˆä»â€œåå­—â€å¼€å§‹ï¼š

```
function createUnknownCustomer() {
  return {
    isUnknown: true,
    name: "occupant",
  };
}
```

**å®¢æˆ·ç«¯ 1...**

```
const customerName = aCustomer.name;
```

æ¥ç€æ˜¯â€œè®¡ä»·å¥—é¤â€ï¼š

```
function createUnknownCustomer() {
  return {
    isUnknown: true,
    name: "occupant",
    billingPlan: registry.billingPlans.basic,
  };
}
```

**å®¢æˆ·ç«¯ 2...**

```
const plan = aCustomer.billingPlan;
```

åŒæ ·ï¼Œæˆ‘å¯ä»¥åœ¨å­—é¢é‡å¯¹è±¡ä¸­åˆ›å»ºä¸€ä¸ªåµŒå¥—çš„ç©ºæ”¯ä»˜è®°å½•å¯¹è±¡ï¼š

```
function createUnknownCustomer() {
  return {
    isUnknown: true,
    name: "occupant",
    billingPlan: registry.billingPlans.basic,
    paymentHistory: {
      weeksDelinquentInLastYear: 0,
    },
  };
}
```

**å®¢æˆ·ç«¯ 3...**

```
const weeksDelinquent = aCustomer.paymentHistory.weeksDelinquentInLastYear;
```

å¦‚æœä½¿ç”¨äº†è¿™æ ·çš„å­—é¢é‡ï¼Œåº”è¯¥ä½¿ç”¨è¯¸å¦‚ Object.freeze çš„æ–¹æ³•å°†å…¶å†»ç»“ï¼Œä½¿å…¶ä¸å¯å˜ã€‚é€šå¸¸ï¼Œæˆ‘è¿˜æ˜¯å–œæ¬¢ç”¨ç±»å¤šä¸€ç‚¹ã€‚

### èŒƒä¾‹ï¼šä½¿ç”¨å˜æ¢

å‰é¢ä¸¤ä¸ªä¾‹å­éƒ½æ¶‰åŠäº†ä¸€ä¸ªç±»ï¼Œå…¶å®æœ¬é‡æ„æ‰‹æ³•ä¹ŸåŒæ ·é€‚ç”¨äºè®°å½•ï¼Œåªè¦å¢åŠ ä¸€ä¸ªå˜æ¢æ­¥éª¤å³å¯ã€‚

å‡è®¾æˆ‘ä»¬çš„è¾“å…¥æ˜¯ä¸€ä¸ªç®€å•çš„è®°å½•ç»“æ„ï¼Œå¤§æ¦‚åƒè¿™æ ·ï¼š

```
{
 name: "Acme Boston",
 location: "Malden MA",
 // more site details
 customer: {
  name: "Acme Industries",
  billingPlan: "plan-451",
  paymentHistory: {
   weeksDelinquentInLastYear: 7
   //more
  },
  // more
 }
}
```

æœ‰æ—¶é¡¾å®¢çš„åå­—æœªçŸ¥ï¼Œæ­¤æ—¶æ ‡è®°çš„æ–¹å¼ä¸å‰é¢ä¸€æ ·ï¼šå°† customer å­—æ®µæ ‡è®°ä¸ºå­—ç¬¦ä¸²"unknown"ã€‚

```
{
name: "Warehouse Unit 15",
location: "Malden MA",
// more site details
customer: "unknown",
}
```

å®¢æˆ·ç«¯ä»£ç ä¹Ÿç±»ä¼¼ï¼Œä¼šæ£€æŸ¥â€œæœªçŸ¥é¡¾å®¢â€çš„æƒ…å†µï¼š

**å®¢æˆ·ç«¯ 1...**

```
const site = acquireSiteData();
const aCustomer = site.customer;
// ... lots of intervening code ...
let customerName;
if (aCustomer === "unknown") customerName = "occupant";
else customerName = aCustomer.name;
```

**å®¢æˆ·ç«¯ 2...**

```
const plan =
  aCustomer === "unknown" ? registry.billingPlans.basic : aCustomer.billingPlan;
```

**å®¢æˆ·ç«¯ 3...**

```
const weeksDelinquent =
  aCustomer === "unknown"
    ? 0
    : aCustomer.paymentHistory.weeksDelinquentInLastYear;
```

æˆ‘é¦–å…ˆè¦è®© Site æ•°æ®ç»“æ„ç»è¿‡ä¸€æ¬¡å˜æ¢ï¼Œç›®å‰å˜æ¢ä¸­åªåšäº†æ·±å¤åˆ¶ï¼Œæ²¡æœ‰å¯¹æ•°æ®åšä»»ä½•å¤„ç†ã€‚

**å®¢æˆ·ç«¯ 1...**

```
const rawSite = acquireSiteData();
const site = enrichSite(rawSite);
const aCustomer = site.customer;
// ... lots of intervening code ...
let customerName;
if (aCustomer === "unknown") customerName = "occupant";
else customerName = aCustomer.name;

function enrichSite(inputSite) {
  return _.cloneDeep(inputSite);
}
```

ç„¶åå¯¹â€œæ£€æŸ¥æœªçŸ¥é¡¾å®¢â€çš„ä»£ç è¿ç”¨æç‚¼å‡½æ•°ï¼ˆ106ï¼‰ã€‚

```
function isUnknown(aCustomer) {
  return aCustomer === "unknown";
}
```

**å®¢æˆ·ç«¯ 1...**

```
const rawSite = acquireSiteData();
const site = enrichSite(rawSite);
const aCustomer = site.customer;
// ... lots of intervening code ...
let customerName;
if (isUnknown(aCustomer)) customerName = "occupant";
else customerName = aCustomer.name;
```

**å®¢æˆ·ç«¯ 2...**

```
const plan = isUnknown(aCustomer)
  ? registry.billingPlans.basic
  : aCustomer.billingPlan;
```

**å®¢æˆ·ç«¯ 3...**

```
const weeksDelinquent = isUnknown(aCustomer)
  ? 0
  : aCustomer.paymentHistory.weeksDelinquentInLastYear;
```

ç„¶åå¼€å§‹å¯¹ Site æ•°æ®åšå¢å¼ºï¼Œé¦–å…ˆæ˜¯ç»™ customer å­—æ®µåŠ ä¸Š isUnknown å±æ€§ã€‚

```
function enrichSite(aSite) {
  const result = _.cloneDeep(aSite);
  const unknownCustomer = {
    isUnknown: true,
  };

  if (isUnknown(result.customer)) result.customer = unknownCustomer;
  else result.customer.isUnknown = false;
  return result;
}
```

éšåä¿®æ”¹æ£€æŸ¥ç‰¹ä¾‹çš„æ¡ä»¶é€»è¾‘ï¼Œå¼€å§‹ä½¿ç”¨æ–°çš„å±æ€§ã€‚åŸæ¥çš„æ£€æŸ¥é€»è¾‘ä¹Ÿä¿ç•™ä¸åŠ¨ï¼Œæ‰€ä»¥ç°åœ¨çš„æ£€æŸ¥é€»è¾‘åº”è¯¥æ—¢èƒ½åº”å¯¹åŸæ¥çš„ Site æ•°æ®ï¼Œä¹Ÿèƒ½åº”å¯¹å¢å¼ºåçš„ Site æ•°æ®ã€‚

```
function isUnknown(aCustomer) {
  if (aCustomer === "unknown") return true;
  else return aCustomer.isUnknown;
}
```

æµ‹è¯•ï¼Œç¡®ä¿ä¸€åˆ‡æ­£å¸¸ï¼Œç„¶åé’ˆå¯¹ç‰¹ä¾‹ä½¿ç”¨å‡½æ•°ç»„åˆæˆå˜æ¢ï¼ˆ149ï¼‰ã€‚é¦–å…ˆæŠŠâ€œæœªçŸ¥é¡¾å®¢çš„åå­—â€çš„å¤„ç†é€»è¾‘æ¬è¿›å¢å¼ºå‡½æ•°ã€‚

```
function enrichSite(aSite) {
  const result = _.cloneDeep(aSite);
  const unknownCustomer = {
    isUnknown: true,
    name: "occupant",
  };

  if (isUnknown(result.customer)) result.customer = unknownCustomer;
  else result.customer.isUnknown = false;
  return result;
}
```

**å®¢æˆ·ç«¯ 1...**

```
const rawSite = acquireSiteData();
const site = enrichSite(rawSite);
const aCustomer = site.customer;
// ... lots of intervening code ...
const customerName = aCustomer.name;
```

æµ‹è¯•ï¼Œç„¶åæ˜¯â€œæœªçŸ¥é¡¾å®¢çš„è®¡ä»·å¥—é¤â€çš„å¤„ç†é€»è¾‘ã€‚

```
function enrichSite(aSite) {
  const result = _.cloneDeep(aSite);
  const unknownCustomer = {
    isUnknown: true,
    name: "occupant",
    billingPlan: registry.billingPlans.basic,
  };

  if (isUnknown(result.customer)) result.customer = unknownCustomer;
  else result.customer.isUnknown = false;
  return result;
}
```

**å®¢æˆ·ç«¯ 2...**

```
const plan = aCustomer.billingPlan;
```

å†æ¬¡æµ‹è¯•ï¼Œç„¶åå¤„ç†æœ€åä¸€å¤„å®¢æˆ·ç«¯ä»£ç ã€‚

```
function enrichSite(aSite) {
  const result = _.cloneDeep(aSite);
  const unknownCustomer = {
    isUnknown: true,
    name: "occupant",
    billingPlan: registry.billingPlans.basic,
    paymentHistory: {
      weeksDelinquentInLastYear: 0,
    },
  };

  if (isUnknown(result.customer)) result.customer = unknownCustomer;
  else result.customer.isUnknown = false;
  return result;
}
```

**å®¢æˆ·ç«¯ 3...**

```
const weeksDelinquent = aCustomer.paymentHistory.weeksDelinquentInLastYear;
```

## 10.6 å¼•å…¥æ–­è¨€ï¼ˆIntroduce Assertionï¼‰

```
  if (this.discountRate)
  base = base - (this.discountRate * base);


  assert(this.discountRate>= 0);
if (this.discountRate)
  base = base - (this.discountRate * base);
```

### åŠ¨æœº

å¸¸å¸¸ä¼šæœ‰è¿™æ ·ä¸€æ®µä»£ç ï¼šåªæœ‰å½“æŸä¸ªæ¡ä»¶ä¸ºçœŸæ—¶ï¼Œè¯¥æ®µä»£ç æ‰èƒ½æ­£å¸¸è¿è¡Œã€‚ä¾‹å¦‚ï¼Œå¹³æ–¹æ ¹è®¡ç®—åªå¯¹æ­£å€¼æ‰èƒ½è¿›è¡Œï¼Œåˆä¾‹å¦‚ï¼ŒæŸä¸ªå¯¹è±¡å¯èƒ½å‡è®¾ä¸€ç»„å­—æ®µä¸­è‡³å°‘æœ‰ä¸€ä¸ªä¸ç­‰äº nullã€‚

è¿™æ ·çš„å‡è®¾é€šå¸¸å¹¶æ²¡æœ‰åœ¨ä»£ç ä¸­æ˜ç¡®è¡¨ç°å‡ºæ¥ï¼Œä½ å¿…é¡»é˜…è¯»æ•´ä¸ªç®—æ³•æ‰èƒ½çœ‹å‡ºã€‚æœ‰æ—¶ç¨‹åºå‘˜ä¼šä»¥æ³¨é‡Šå†™å‡ºè¿™æ ·çš„å‡è®¾ï¼Œè€Œæˆ‘è¦ä»‹ç»çš„æ˜¯ä¸€ç§æ›´å¥½çš„æŠ€æœ¯â€”â€”ä½¿ç”¨æ–­è¨€æ˜ç¡®æ ‡æ˜è¿™äº›å‡è®¾ã€‚

æ–­è¨€æ˜¯ä¸€ä¸ªæ¡ä»¶è¡¨è¾¾å¼ï¼Œåº”è¯¥æ€»æ˜¯ä¸ºçœŸã€‚å¦‚æœå®ƒå¤±è´¥ï¼Œè¡¨ç¤ºç¨‹åºå‘˜çŠ¯äº†é”™è¯¯ã€‚æ–­è¨€çš„å¤±è´¥ä¸åº”è¯¥è¢«ç³»ç»Ÿä»»ä½•åœ°æ–¹æ•æ‰ã€‚æ•´ä¸ªç¨‹åºçš„è¡Œä¸ºåœ¨æœ‰æ²¡æœ‰æ–­è¨€å‡ºç°çš„æ—¶å€™éƒ½åº”è¯¥å®Œå…¨ä¸€æ ·ã€‚å®é™…ä¸Šï¼Œæœ‰äº›ç¼–ç¨‹è¯­è¨€ä¸­çš„æ–­è¨€å¯ä»¥åœ¨ç¼–è¯‘æœŸç”¨ä¸€ä¸ªå¼€å…³å®Œå…¨ç¦ç”¨æ‰ã€‚

æˆ‘å¸¸çœ‹è§æœ‰äººé¼“åŠ±ç”¨æ–­è¨€æ¥å‘ç°ç¨‹åºä¸­çš„é”™è¯¯ã€‚è¿™å›ºç„¶æ˜¯ä¸€ä»¶å¥½äº‹ï¼Œä½†å´ä¸æ˜¯ä½¿ç”¨æ–­è¨€çš„å”¯ä¸€ç†ç”±ã€‚æ–­è¨€æ˜¯ä¸€ç§å¾ˆæœ‰ä»·å€¼çš„äº¤æµå½¢å¼â€”â€”å®ƒä»¬å‘Šè¯‰é˜…è¯»è€…ï¼Œç¨‹åºåœ¨æ‰§è¡Œåˆ°è¿™ä¸€ç‚¹æ—¶ï¼Œå¯¹å½“å‰çŠ¶æ€åšäº†ä½•ç§å‡è®¾ã€‚å¦å¤–æ–­è¨€å¯¹è°ƒè¯•ä¹Ÿå¾ˆæœ‰å¸®åŠ©ã€‚è€Œä¸”ï¼Œå› ä¸ºå®ƒä»¬åœ¨äº¤æµä¸Šå¾ˆæœ‰ä»·å€¼ï¼Œå³ä½¿è§£å†³äº†å½“ä¸‹æ­£åœ¨è¿½è¸ªçš„é”™è¯¯ï¼Œæˆ‘è¿˜æ˜¯å€¾å‘äºæŠŠæ–­è¨€ç•™ç€ã€‚è‡ªæµ‹è¯•çš„ä»£ç é™ä½äº†æ–­è¨€åœ¨è°ƒè¯•æ–¹é¢çš„ä»·å€¼ï¼Œå› ä¸ºé€æ­¥é€¼è¿‘çš„å•å…ƒæµ‹è¯•é€šå¸¸èƒ½æ›´å¥½åœ°å¸®åŠ©è°ƒè¯•ï¼Œä½†æˆ‘ä»ç„¶çœ‹é‡æ–­è¨€åœ¨äº¤æµæ–¹é¢çš„ä»·å€¼ã€‚

### åšæ³•

å¦‚æœä½ å‘ç°ä»£ç å‡è®¾æŸä¸ªæ¡ä»¶å§‹ç»ˆä¸ºçœŸï¼Œå°±åŠ å…¥ä¸€ä¸ªæ–­è¨€æ˜ç¡®è¯´æ˜è¿™ç§æƒ…å†µã€‚

å› ä¸ºæ–­è¨€åº”è¯¥ä¸ä¼šå¯¹ç³»ç»Ÿè¿è¡Œé€ æˆä»»ä½•å½±å“ï¼Œæ‰€ä»¥â€œåŠ å…¥æ–­è¨€â€æ°¸è¿œéƒ½åº”è¯¥æ˜¯è¡Œä¸ºä¿æŒçš„ã€‚

### èŒƒä¾‹

ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼šæŠ˜æ‰£ã€‚é¡¾å®¢ï¼ˆcustomerï¼‰ä¼šè·å¾—ä¸€ä¸ªæŠ˜æ‰£ç‡ï¼ˆdiscount rateï¼‰ï¼Œå¯ä»¥ç”¨äºæ‰€æœ‰å…¶è´­ä¹°çš„å•†å“ã€‚

**class Customer...**

```
applyDiscount(aNumber) {
  return (this.discountRate)
    ? aNumber - (this.discountRate * aNumber)
    : aNumber;
}
```

è¿™é‡Œæœ‰ä¸€ä¸ªå‡è®¾ï¼šæŠ˜æ‰£ç‡æ°¸è¿œæ˜¯æ­£æ•°ã€‚æˆ‘å¯ä»¥ç”¨æ–­è¨€æ˜ç¡®æ ‡ç¤ºå‡ºè¿™ä¸ªå‡è®¾ã€‚ä½†åœ¨ä¸€ä¸ªä¸‰å…ƒè¡¨è¾¾å¼ä¸­æ²¡åŠæ³•å¾ˆç®€å•åœ°æ’å…¥æ–­è¨€ï¼Œæ‰€ä»¥æˆ‘é¦–å…ˆè¦æŠŠè¿™ä¸ªè¡¨è¾¾å¼è½¬æ¢æˆ if-else çš„å½¢å¼ã€‚

**class Customer...**

```
applyDiscount(aNumber) {
  if (!this.discountRate) return aNumber;
  else return aNumber - (this.discountRate * aNumber);
}
```

ç°åœ¨æˆ‘å°±å¯ä»¥è½»æ¾åœ°åŠ å…¥æ–­è¨€äº†ã€‚

**class Customer...**

```
applyDiscount(aNumber) {
  if (!this.discountRate) return aNumber;
  else {
    assert(this.discountRate >= 0);
    return aNumber - (this.discountRate * aNumber);
  }
}
```

å¯¹è¿™ä¸ªä¾‹å­è€Œè¨€ï¼Œæˆ‘æ›´æ„¿æ„æŠŠæ–­è¨€æ”¾åœ¨è®¾å€¼å‡½æ•°ä¸Šã€‚å¦‚æœåœ¨ applyDiscount å‡½æ•°å¤„å‘ç”Ÿæ–­è¨€å¤±è´¥ï¼Œæˆ‘è¿˜å¾—å…ˆè´¹åŠ›ææ¸…æ¥šéæ³•çš„æŠ˜æ‰£ç‡å€¼èµ·åˆæ˜¯ä»å“ªå„¿æ”¾è¿›å»çš„ã€‚

**class Customer...**

```
set discountRate(aNumber) {
  assert(null === aNumber || aNumber >= 0);
  this._discountRate = aNumber;
}
```

çœŸæ­£å¼•èµ·é”™è¯¯çš„æºå¤´æœ‰å¯èƒ½å¾ˆéš¾å‘ç°â€”â€”ä¹Ÿè®¸æ˜¯è¾“å…¥æ•°æ®ä¸­è¯¯å†™äº†ä¸€ä¸ªå‡å·ï¼Œä¹Ÿè®¸æ˜¯æŸå¤„ä»£ç åšæ•°æ®è½¬æ¢æ—¶çŠ¯äº†é”™è¯¯ã€‚åƒè¿™æ ·çš„æ–­è¨€å¯¹äºå‘ç°é”™è¯¯æºå¤´ç‰¹åˆ«æœ‰å¸®åŠ©ã€‚

æ³¨æ„ï¼Œä¸è¦æ»¥ç”¨æ–­è¨€ã€‚æˆ‘ä¸ä¼šä½¿ç”¨æ–­è¨€æ¥æ£€æŸ¥æ‰€æœ‰â€œæˆ‘è®¤ä¸ºåº”è¯¥ä¸ºçœŸâ€çš„æ¡ä»¶ï¼Œåªç”¨æ¥æ£€æŸ¥â€œå¿…é¡»ä¸ºçœŸâ€çš„æ¡ä»¶ã€‚æ»¥ç”¨æ–­è¨€å¯èƒ½ä¼šé€ æˆä»£ç é‡å¤ï¼Œå°¤å…¶æ˜¯åœ¨å¤„ç†ä¸Šé¢è¿™æ ·çš„æ¡ä»¶é€»è¾‘æ—¶ã€‚æ‰€ä»¥æˆ‘å‘ç°ï¼Œå¾ˆæœ‰å¿…è¦å»æ‰æ¡ä»¶é€»è¾‘ä¸­çš„é‡å¤ï¼Œé€šå¸¸å¯ä»¥å€ŸåŠ©æç‚¼å‡½æ•°ï¼ˆ106ï¼‰æ‰‹æ³•ã€‚

æˆ‘åªç”¨æ–­è¨€é¢„é˜²ç¨‹åºå‘˜çš„é”™è¯¯ã€‚å¦‚æœè¦ä»æŸä¸ªå¤–éƒ¨æ•°æ®æºè¯»å–æ•°æ®ï¼Œé‚£ä¹ˆæ‰€æœ‰å¯¹è¾“å…¥å€¼çš„æ£€æŸ¥éƒ½åº”è¯¥æ˜¯ç¨‹åºçš„ä¸€ç­‰å…¬æ°‘ï¼Œè€Œä¸èƒ½ç”¨æ–­è¨€å®ç°â€”â€”é™¤éæˆ‘å¯¹è¿™ä¸ªå¤–éƒ¨æ•°æ®æºæœ‰ç»å¯¹çš„ä¿¡å¿ƒã€‚æ–­è¨€æ˜¯å¸®åŠ©æˆ‘ä»¬è·Ÿè¸ª bug çš„æœ€åä¸€æ‹›ï¼Œæ‰€ä»¥ï¼Œæˆ–è®¸å¬æ¥è®½åˆºï¼Œåªæœ‰å½“æˆ‘è®¤ä¸ºæ–­è¨€ç»å¯¹ä¸ä¼šå¤±è´¥çš„æ—¶å€™ï¼Œæˆ‘æ‰ä¼šä½¿ç”¨æ–­è¨€ã€‚

---


# 11.é‡æ„ API

æ¨¡å—å’Œå‡½æ•°æ˜¯è½¯ä»¶çš„éª¨è‚‰ï¼Œè€Œ API åˆ™æ˜¯å°†éª¨è‚‰è¿æ¥èµ·æ¥çš„å…³èŠ‚ã€‚æ˜“äºç†è§£å’Œä½¿ç”¨çš„ API éå¸¸é‡è¦ï¼Œä½†åŒæ—¶ä¹Ÿå¾ˆéš¾è·å¾—ã€‚éšç€å¯¹è½¯ä»¶ç†è§£çš„åŠ æ·±ï¼Œæˆ‘ä¼šå­¦åˆ°å¦‚ä½•æ”¹è¿› APIï¼Œè¿™æ—¶æˆ‘ä¾¿éœ€è¦å¯¹ API è¿›è¡Œé‡æ„ã€‚

å¥½çš„ API ä¼šæŠŠæ›´æ–°æ•°æ®çš„å‡½æ•°ä¸åªæ˜¯è¯»å–æ•°æ®çš„å‡½æ•°æ¸…æ™°åˆ†å¼€ã€‚å¦‚æœæˆ‘çœ‹åˆ°è¿™ä¸¤ç±»æ“ä½œè¢«æ··åœ¨ä¸€èµ·ï¼Œå°±ä¼šç”¨å°†æŸ¥è¯¢å‡½æ•°å’Œä¿®æ”¹å‡½æ•°åˆ†ç¦»ï¼ˆ306ï¼‰å°†å®ƒä»¬åˆ†å¼€ã€‚å¦‚æœä¸¤ä¸ªå‡½æ•°çš„åŠŸèƒ½éå¸¸ç›¸ä¼¼ã€åªæœ‰ä¸€äº›æ•°å€¼ä¸åŒï¼Œæˆ‘å¯ä»¥ç”¨å‡½æ•°å‚æ•°åŒ–ï¼ˆ310ï¼‰å°†å…¶ç»Ÿä¸€ã€‚ä½†æœ‰äº›å‚æ•°å…¶å®åªæ˜¯ä¸€ä¸ªæ ‡è®°ï¼Œæ ¹æ®è¿™ä¸ªæ ‡è®°çš„ä¸åŒï¼Œå‡½æ•°ä¼šæœ‰æˆªç„¶ä¸åŒçš„è¡Œä¸ºï¼Œæ­¤æ—¶æœ€å¥½ç”¨ç§»é™¤æ ‡è®°å‚æ•°ï¼ˆ314ï¼‰å°†ä¸åŒçš„è¡Œä¸ºå½»åº•åˆ†å¼€ã€‚

åœ¨å‡½æ•°é—´ä¼ é€’æ—¶ï¼Œæ•°æ®ç»“æ„å¸¸ä¼šæ¯«æ— å¿…è¦åœ°è¢«æ‹†å¼€ï¼Œæˆ‘æ›´æ„¿æ„ç”¨ä¿æŒå¯¹è±¡å®Œæ•´ï¼ˆ319ï¼‰å°†å…¶èšæ‹¢ã€‚å‡½æ•°éœ€è¦çš„ä¸€ä»½ä¿¡æ¯ï¼Œç©¶ç«Ÿä½•æ—¶åº”è¯¥ä½œä¸ºå‚æ•°ä¼ å…¥ã€ä½•æ—¶åº”è¯¥è°ƒç”¨ä¸€ä¸ªå‡½æ•°è·å¾—ï¼Œè¿™æ˜¯ä¸€ä¸ªéœ€è¦åå¤æ¨æ•²çš„å†³å®šï¼Œæ¨æ•²çš„è¿‡ç¨‹ä¸­å¸¸å¸¸è¦ç”¨åˆ°ä»¥æŸ¥è¯¢å–ä»£å‚æ•°ï¼ˆ324ï¼‰å’Œä»¥å‚æ•°å–ä»£æŸ¥è¯¢ï¼ˆ327ï¼‰ã€‚

ç±»æ˜¯ä¸€ç§å¸¸è§çš„æ¨¡å—å½¢å¼ã€‚æˆ‘å¸Œæœ›å°½å¯èƒ½ä¿æŒå¯¹è±¡ä¸å¯å˜ï¼Œæ‰€ä»¥åªè¦æœ‰å¯èƒ½ï¼Œæˆ‘å°±ä¼šä½¿ç”¨ç§»é™¤è®¾å€¼å‡½æ•°ï¼ˆ331ï¼‰ã€‚å½“è°ƒç”¨è€…è¦æ±‚ä¸€ä¸ªæ–°å¯¹è±¡æ—¶ï¼Œæˆ‘ç»å¸¸éœ€è¦æ¯”æ„é€ å‡½æ•°æ›´å¤šçš„çµæ´»æ€§ï¼Œå¯ä»¥å€ŸåŠ©ä»¥å·¥å‚å‡½æ•°å–ä»£æ„é€ å‡½æ•°ï¼ˆ334ï¼‰è·å¾—è¿™ç§çµæ´»æ€§ã€‚

æœ‰æ—¶ä½ ä¼šé‡åˆ°ä¸€ä¸ªç‰¹åˆ«å¤æ‚çš„å‡½æ•°ï¼Œå›´ç»•ç€å®ƒä¼ å…¥ä¼ å‡ºä¸€å¤§å †æ•°æ®ã€‚æœ€åä¸¤ä¸ªé‡æ„æ‰‹æ³•ä¸“é—¨ç”¨äºç ´è§£è¿™ä¸ªéš¾é¢˜ã€‚æˆ‘å¯ä»¥ç”¨ä»¥å‘½ä»¤å–ä»£å‡½æ•°ï¼ˆ337ï¼‰å°†è¿™ä¸ªå‡½æ•°å˜æˆå¯¹è±¡ï¼Œè¿™æ ·å¯¹å‡½æ•°ä½“ä½¿ç”¨æç‚¼å‡½æ•°ï¼ˆ106ï¼‰æ—¶ä¼šæ›´å®¹æ˜“ã€‚å¦‚æœç¨åæˆ‘å¯¹è¯¥å‡½æ•°åšäº†ç®€åŒ–ï¼Œä¸å†éœ€è¦å°†å…¶ä½œä¸ºå‘½ä»¤å¯¹è±¡äº†ï¼Œå¯ä»¥ç”¨ä»¥å‡½æ•°å–ä»£å‘½ä»¤ï¼ˆ344ï¼‰å†æŠŠå®ƒå˜å›å‡½æ•°ã€‚

## 11.1 å°†æŸ¥è¯¢å‡½æ•°å’Œä¿®æ”¹å‡½æ•°åˆ†ç¦»ï¼ˆSeparate Query from Modifierï¼‰

```
function getTotalOutstandingAndSendBill() {
const result = customer.invoices.reduce((total, each) => each.amount + total, 0);
sendBill();
return result;
}


function totalOutstanding() {
return customer.invoices.reduce((total, each) => each.amount + total, 0);
}
function sendBill() {
emailGateway.send(formatBill(customer));
}
```

### åŠ¨æœº

å¦‚æœæŸä¸ªå‡½æ•°åªæ˜¯æä¾›ä¸€ä¸ªå€¼ï¼Œæ²¡æœ‰ä»»ä½•çœ‹å¾—åˆ°çš„å‰¯ä½œç”¨ï¼Œé‚£ä¹ˆè¿™æ˜¯ä¸€ä¸ªå¾ˆæœ‰ä»·å€¼çš„ä¸œè¥¿ã€‚æˆ‘å¯ä»¥ä»»æ„è°ƒç”¨è¿™ä¸ªå‡½æ•°ï¼Œä¹Ÿå¯ä»¥æŠŠè°ƒç”¨åŠ¨ä½œæ¬åˆ°è°ƒç”¨å‡½æ•°çš„å…¶ä»–åœ°æ–¹ã€‚è¿™ç§å‡½æ•°çš„æµ‹è¯•ä¹Ÿæ›´å®¹æ˜“ã€‚ç®€è€Œè¨€ä¹‹ï¼Œéœ€è¦æ“å¿ƒçš„äº‹æƒ…å°‘å¤šäº†ã€‚

æ˜ç¡®è¡¨ç°å‡ºâ€œæœ‰å‰¯ä½œç”¨â€ä¸â€œæ— å‰¯ä½œç”¨â€ä¸¤ç§å‡½æ•°ä¹‹é—´çš„å·®å¼‚ï¼Œæ˜¯ä¸ªå¾ˆå¥½çš„æƒ³æ³•ã€‚ä¸‹é¢æ˜¯ä¸€æ¡å¥½è§„åˆ™ï¼šä»»ä½•æœ‰è¿”å›å€¼çš„å‡½æ•°ï¼Œéƒ½ä¸åº”è¯¥æœ‰çœ‹å¾—åˆ°çš„å‰¯ä½œç”¨â€”â€”å‘½ä»¤ä¸æŸ¥è¯¢åˆ†ç¦»ï¼ˆCommand-Query Separationï¼‰[mf-cqs]ã€‚æœ‰äº›ç¨‹åºå‘˜ç”šè‡³å°†æ­¤ä½œä¸ºä¸€æ¡å¿…é¡»éµå®ˆçš„è§„åˆ™ã€‚å°±åƒå¯¹å¾…ä»»ä½•ä¸œè¥¿ä¸€æ ·ï¼Œæˆ‘å¹¶ä¸ç»å¯¹éµå®ˆå®ƒï¼Œä¸è¿‡æˆ‘æ€»æ˜¯å°½é‡éµå®ˆï¼Œè€Œå®ƒä¹Ÿå›æŠ¥æˆ‘å¾ˆå¥½çš„æ•ˆæœã€‚

å¦‚æœé‡åˆ°ä¸€ä¸ªâ€œæ—¢æœ‰è¿”å›å€¼åˆæœ‰å‰¯ä½œç”¨â€çš„å‡½æ•°ï¼Œæˆ‘å°±ä¼šè¯•ç€å°†æŸ¥è¯¢åŠ¨ä½œä»ä¿®æ”¹åŠ¨ä½œä¸­åˆ†ç¦»å‡ºæ¥ã€‚

ä½ ä¹Ÿè®¸å·²ç»æ³¨æ„åˆ°äº†ï¼šæˆ‘ä½¿ç”¨â€œçœ‹å¾—åˆ°çš„å‰¯ä½œç”¨â€è¿™ç§è¯´æ³•ã€‚æœ‰ä¸€ç§å¸¸è§çš„ä¼˜åŒ–åŠæ³•æ˜¯ï¼šå°†æŸ¥è¯¢æ‰€å¾—ç»“æœç¼“å­˜äºæŸä¸ªå­—æ®µä¸­ï¼Œè¿™æ ·ä¸€æ¥åç»­çš„é‡å¤æŸ¥è¯¢å°±å¯ä»¥å¤§å¤§åŠ å¿«é€Ÿåº¦ã€‚è™½ç„¶è¿™ç§åšæ³•æ”¹å˜äº†å¯¹è±¡ä¸­ç¼“å­˜çš„çŠ¶æ€ï¼Œä½†è¿™ä¸€ä¿®æ”¹æ˜¯å¯Ÿè§‰ä¸åˆ°çš„ï¼Œå› ä¸ºä¸è®ºå¦‚ä½•æŸ¥è¯¢ï¼Œæ€»æ˜¯è·å¾—ç›¸åŒç»“æœã€‚

### åšæ³•

å¤åˆ¶æ•´ä¸ªå‡½æ•°ï¼Œå°†å…¶ä½œä¸ºä¸€ä¸ªæŸ¥è¯¢æ¥å‘½åã€‚

å¦‚æœæƒ³ä¸å‡ºå¥½åå­—ï¼Œå¯ä»¥çœ‹çœ‹å‡½æ•°è¿”å›çš„æ˜¯ä»€ä¹ˆã€‚æŸ¥è¯¢çš„ç»“æœä¼šè¢«å¡«å…¥ä¸€ä¸ªå˜é‡ï¼Œè¿™ä¸ªå˜é‡çš„åå­—åº”è¯¥èƒ½å¯¹å‡½æ•°å¦‚ä½•å‘½åæœ‰æ‰€å¯å‘ã€‚

ä»æ–°å»ºçš„æŸ¥è¯¢å‡½æ•°ä¸­å»æ‰æ‰€æœ‰é€ æˆå‰¯ä½œç”¨çš„è¯­å¥ã€‚

æ‰§è¡Œé™æ€æ£€æŸ¥ã€‚

æŸ¥æ‰¾æ‰€æœ‰è°ƒç”¨åŸå‡½æ•°çš„åœ°æ–¹ã€‚å¦‚æœè°ƒç”¨å¤„ç”¨åˆ°äº†è¯¥å‡½æ•°çš„è¿”å›å€¼ï¼Œå°±å°†å…¶æ”¹ä¸ºè°ƒç”¨æ–°å»ºçš„æŸ¥è¯¢å‡½æ•°ï¼Œå¹¶åœ¨ä¸‹é¢é©¬ä¸Šå†è°ƒç”¨ä¸€æ¬¡åŸå‡½æ•°ã€‚æ¯æ¬¡ä¿®æ”¹ä¹‹åéƒ½è¦æµ‹è¯•ã€‚

ä»åŸå‡½æ•°ä¸­å»æ‰è¿”å›å€¼ã€‚

æµ‹è¯•ã€‚

å®Œæˆé‡æ„ä¹‹åï¼ŒæŸ¥è¯¢å‡½æ•°ä¸åŸå‡½æ•°ä¹‹é—´å¸¸ä¼šæœ‰é‡å¤ä»£ç ï¼Œå¯ä»¥åšå¿…è¦çš„æ¸…ç†ã€‚

### èŒƒä¾‹

æœ‰è¿™æ ·ä¸€ä¸ªå‡½æ•°ï¼šå®ƒä¼šéå†ä¸€ä»½æ¶æ£ï¼ˆmiscreantï¼‰åå•ï¼Œæ£€æŸ¥ä¸€ç¾¤äººï¼ˆpeopleï¼‰é‡Œæ˜¯å¦æ··è¿›äº†æ¶æ£ã€‚å¦‚æœå‘ç°äº†æ¶æ£ï¼Œè¯¥å‡½æ•°ä¼šè¿”å›æ¶æ£çš„åå­—ï¼Œå¹¶æ‹‰å“è­¦æŠ¥ã€‚å¦‚æœäººç¾¤ä¸­æœ‰å¤šåæ¶æ£ï¼Œè¯¥å‡½æ•°ä¹Ÿåªæ±‡æŠ¥æ‰¾å‡ºçš„ç¬¬ä¸€åæ¶æ£ï¼ˆæˆ‘çŒœè¿™å°±å·²ç»å¤Ÿäº†ï¼‰ã€‚

```
function alertForMiscreant(people) {
  for (const p of people) {
    if (p === "Don") {
      setOffAlarms();
      return "Don";
    }
    if (p === "John") {
      setOffAlarms();
      return "John";
    }
  }
  return "";
}
```

é¦–å…ˆæˆ‘å¤åˆ¶æ•´ä¸ªå‡½æ•°ï¼Œç”¨å®ƒçš„æŸ¥è¯¢éƒ¨åˆ†åŠŸèƒ½ä¸ºå…¶å‘½åã€‚

```
function findMiscreant(people) {
  for (const p of people) {
    if (p === "Don") {
      setOffAlarms();
      return "Don";
    }
    if (p === "John") {
      setOffAlarms();
      return "John";
    }
  }
  return "";
}
```

ç„¶ååœ¨æ–°å»ºçš„æŸ¥è¯¢å‡½æ•°ä¸­å»æ‰å‰¯ä½œç”¨ã€‚

```
function findMiscreant(people) {
  for (const p of people) {
    if (p === "Don") {
      setOffAlarms();
      return "Don";
    }
    if (p === "John") {
      setOffAlarms();
      return "John";
    }
  }
  return "";
}
```

ç„¶åæ‰¾åˆ°æ‰€æœ‰åŸå‡½æ•°çš„è°ƒç”¨è€…ï¼Œå°†å…¶æ”¹ä¸ºè°ƒç”¨æ–°å»ºçš„æŸ¥è¯¢å‡½æ•°ï¼Œå¹¶åœ¨å…¶åè°ƒç”¨ä¸€æ¬¡ä¿®æ”¹å‡½æ•°ï¼ˆä¹Ÿå°±æ˜¯åŸå‡½æ•°ï¼‰ã€‚äºæ˜¯ä»£ç 

```
const found = alertForMiscreant(people);
```

å°±å˜æˆäº†

```
const found = findMiscreant(people);
alertForMiscreant(people);
```

ç°åœ¨å¯ä»¥ä»ä¿®æ”¹å‡½æ•°ä¸­å»æ‰æ‰€æœ‰è¿”å›å€¼äº†ã€‚

```
function alertForMiscreant(people) {
  for (const p of people) {
    if (p === "Don") {
      setOffAlarms();
      return;
    }
    if (p === "John") {
      setOffAlarms();
      return;
    }
  }
  return;
}
```

ç°åœ¨ï¼ŒåŸæ¥çš„ä¿®æ”¹å‡½æ•°å’Œæ–°å»ºçš„æŸ¥è¯¢å‡½æ•°ä¹‹é—´æœ‰å¤§é‡çš„é‡å¤ä»£ç ï¼Œæˆ‘å¯ä»¥ä½¿ç”¨æ›¿æ¢ç®—æ³•ï¼ˆ195ï¼‰ï¼Œè®©ä¿®æ”¹å‡½æ•°ä½¿ç”¨æŸ¥è¯¢å‡½æ•°ã€‚

```
function alertForMiscreant(people) {
  if (findMiscreant(people) !== "") setOffAlarms();
}
```

## 11.2 å‡½æ•°å‚æ•°åŒ–ï¼ˆParameterize Functionï¼‰

æ›¾ç”¨åï¼šä»¤å‡½æ•°æºå¸¦å‚æ•°ï¼ˆParameterize Methodï¼‰

```
function tenPercentRaise(aPerson) {
  aPerson.salary = aPerson.salary.multiply(1.1);
}
function fivePercentRaise(aPerson) {
  aPerson.salary = aPerson.salary.multiply(1.05);
}

function raise(aPerson, factor) {
  aPerson.salary = aPerson.salary.multiply(1 + factor);
}
```

### åŠ¨æœº

å¦‚æœæˆ‘å‘ç°ä¸¤ä¸ªå‡½æ•°é€»è¾‘éå¸¸ç›¸ä¼¼ï¼Œåªæœ‰ä¸€äº›å­—é¢é‡å€¼ä¸åŒï¼Œå¯ä»¥å°†å…¶åˆå¹¶æˆä¸€ä¸ªå‡½æ•°ï¼Œä»¥å‚æ•°çš„å½¢å¼ä¼ å…¥ä¸åŒçš„å€¼ï¼Œä»è€Œæ¶ˆé™¤é‡å¤ã€‚è¿™ä¸ªé‡æ„å¯ä»¥ä½¿å‡½æ•°æ›´æœ‰ç”¨ï¼Œå› ä¸ºé‡æ„åçš„å‡½æ•°è¿˜å¯ä»¥ç”¨äºå¤„ç†å…¶ä»–çš„å€¼ã€‚

### åšæ³•

ä»ä¸€ç»„ç›¸ä¼¼çš„å‡½æ•°ä¸­é€‰æ‹©ä¸€ä¸ªã€‚

è¿ç”¨æ”¹å˜å‡½æ•°å£°æ˜ï¼ˆ124ï¼‰ï¼ŒæŠŠéœ€è¦ä½œä¸ºå‚æ•°ä¼ å…¥çš„å­—é¢é‡æ·»åŠ åˆ°å‚æ•°åˆ—è¡¨ä¸­ã€‚

ä¿®æ”¹è¯¥å‡½æ•°æ‰€æœ‰çš„è°ƒç”¨å¤„ï¼Œä½¿å…¶åœ¨è°ƒç”¨æ—¶ä¼ å…¥è¯¥å­—é¢é‡å€¼ã€‚

æµ‹è¯•ã€‚

ä¿®æ”¹å‡½æ•°ä½“ï¼Œä»¤å…¶ä½¿ç”¨æ–°ä¼ å…¥çš„å‚æ•°ã€‚æ¯ä½¿ç”¨ä¸€ä¸ªæ–°å‚æ•°éƒ½è¦æµ‹è¯•ã€‚

å¯¹äºå…¶ä»–ä¸ä¹‹ç›¸ä¼¼çš„å‡½æ•°ï¼Œé€ä¸€å°†å…¶è°ƒç”¨å¤„æ”¹ä¸ºè°ƒç”¨å·²ç»å‚æ•°åŒ–çš„å‡½æ•°ã€‚æ¯æ¬¡ä¿®æ”¹åéƒ½è¦æµ‹è¯•ã€‚

å¦‚æœç¬¬ä¸€ä¸ªå‡½æ•°ç»è¿‡å‚æ•°åŒ–ä»¥åä¸èƒ½ç›´æ¥æ›¿ä»£å¦ä¸€ä¸ªä¸ä¹‹ç›¸ä¼¼çš„å‡½æ•°ï¼Œå°±å…ˆå¯¹å‚æ•°åŒ–ä¹‹åçš„å‡½æ•°åšå¿…è¦çš„è°ƒæ•´ï¼Œå†åšæ›¿æ¢ã€‚

### èŒƒä¾‹

ä¸‹é¢æ˜¯ä¸€ä¸ªæ˜¾è€Œæ˜“è§çš„ä¾‹å­ï¼š

```
function tenPercentRaise(aPerson) {
  aPerson.salary = aPerson.salary.multiply(1.1);
}
function fivePercentRaise(aPerson) {
  aPerson.salary = aPerson.salary.multiply(1.05);
}
```

å¾ˆæ˜æ˜¾æˆ‘å¯ä»¥ç”¨ä¸‹é¢è¿™ä¸ªå‡½æ•°æ¥æ›¿æ¢ä¸Šé¢ä¸¤ä¸ªï¼š

```
function raise(aPerson, factor) {
  aPerson.salary = aPerson.salary.multiply(1 + factor);
}
```

æƒ…å†µå¯èƒ½æ¯”è¿™ä¸ªæ›´å¤æ‚ä¸€äº›ã€‚ä¾‹å¦‚ä¸‹åˆ—ä»£ç ï¼š

```
function baseCharge(usage) {
 if (usage < 0) return usd(0);
 const amount =
    bottomBand(usage) * 0.03
    + middleBand(usage) * 0.05
    + topBand(usage) * 0.07;
 return usd(amount);
}

function bottomBand(usage) {
 return Math.min(usage, 100);
}

function middleBand(usage) {
 return usage > 100 ? Math.min(usage, 200) - 100 : 0;
}

function topBand(usage) {
 return usage > 200 ? usage - 200 : 0;
}
```

è¿™å‡ ä¸ªå‡½æ•°ä¸­çš„é€»è¾‘æ˜æ˜¾å¾ˆç›¸ä¼¼ï¼Œä½†æ˜¯ä¸æ˜¯ç›¸ä¼¼åˆ°è¶³ä»¥æ”¯æ’‘ä¸€ä¸ªå‚æ•°åŒ–çš„è®¡ç®—â€œè®¡è´¹æ¡£æ¬¡â€ï¼ˆbandï¼‰çš„å‡½æ•°ï¼Ÿè¿™æ¬¡å°±ä¸åƒå‰é¢ç¬¬ä¸€ä¸ªä¾‹å­é‚£æ ·ä¸€ç›®äº†ç„¶äº†ã€‚

åœ¨å°è¯•å¯¹å‡ ä¸ªç›¸å…³çš„å‡½æ•°åšå‚æ•°åŒ–æ“ä½œæ—¶ï¼Œæˆ‘ä¼šå…ˆä»ä¸­æŒ‘é€‰ä¸€ä¸ªï¼Œåœ¨ä¸Šé¢æ·»åŠ å‚æ•°ï¼ŒåŒæ—¶ç•™æ„å…¶ä»–å‡ ç§æƒ…å†µã€‚åœ¨ç±»ä¼¼è¿™æ ·å¤„ç†â€œèŒƒå›´â€çš„æƒ…å†µä¸‹ï¼Œé€šå¸¸ä»ä½äºä¸­é—´çš„èŒƒå›´å¼€å§‹ç€æ‰‹è¾ƒå¥½ã€‚æ‰€ä»¥æˆ‘é¦–å…ˆé€‰æ‹©äº† middleBand å‡½æ•°æ¥æ·»åŠ å‚æ•°ï¼Œç„¶åè°ƒæ•´å…¶ä»–çš„è°ƒç”¨è€…æ¥é€‚åº”å®ƒã€‚

middleBand ä½¿ç”¨äº†ä¸¤ä¸ªå­—é¢é‡å€¼ï¼Œå³ 100 å’Œ 200ï¼Œåˆ†åˆ«ä»£è¡¨â€œä¸­é—´æ¡£æ¬¡â€çš„ä¸‹ç•Œå’Œä¸Šç•Œã€‚æˆ‘é¦–å…ˆç”¨æ”¹å˜å‡½æ•°å£°æ˜ï¼ˆ124ï¼‰åŠ ä¸Šè¿™ä¸¤ä¸ªå‚æ•°ï¼ŒåŒæ—¶é¡ºæ‰‹ç»™å‡½æ•°æ”¹ä¸ªåï¼Œä½¿å…¶æ›´å¥½åœ°è¡¨è¿°å‚æ•°åŒ–ä¹‹åçš„å«ä¹‰ã€‚

```
function withinBand(usage, bottom, top) {
 return usage > 100 ? Math.min(usage, 200) - 100 : 0;
}

function baseCharge(usage) {
 if (usage < 0) return usd(0);
 const amount =
    bottomBand(usage) * 0.03
    + withinBand(usage, 100, 200) * 0.05
    + topBand(usage) * 0.07;
 return usd(amount);
}
```

åœ¨å‡½æ•°ä½“å†…éƒ¨ï¼ŒæŠŠä¸€ä¸ªå­—é¢é‡æ”¹ä¸ºä½¿ç”¨æ–°ä¼ å…¥çš„å‚æ•°ï¼š

```
function withinBand(usage, bottom, top) {
  return usage & gt;
  bottom ? Math.min(usage, 200) - bottom : 0;
}
```

ç„¶åæ˜¯å¦ä¸€ä¸ªï¼š

```
function withinBand(usage, bottom, top) {
  return usage & gt;
  bottom ? Math.min(usage, top) - bottom : 0;
}
```

å¯¹äºåŸæœ¬è°ƒç”¨ bottomBand å‡½æ•°çš„åœ°æ–¹ï¼Œæˆ‘å°†å…¶æ”¹ä¸ºè°ƒç”¨å‚æ•°åŒ–äº†çš„æ–°å‡½æ•°ã€‚

```
function baseCharge(usage) {
 if (usage < 0) return usd(0);
 const amount =
    withinBand(usage, 0, 100) * 0.03
    + withinBand(usage, 100, 200) * 0.05
    + topBand(usage) * 0.07;
 return usd(amount);
}

function bottomBand(usage) {
 return Math.min(usage, 100);
}
```

ä¸ºäº†æ›¿æ¢å¯¹ topBand çš„è°ƒç”¨ï¼Œæˆ‘å°±å¾—ç”¨ä»£è¡¨â€œæ— ç©·å¤§â€çš„ Infinity ä½œä¸ºè¿™ä¸ªèŒƒå›´çš„ä¸Šç•Œã€‚

```
function baseCharge(usage) {
 if (usage < 0) return usd(0);
 const amount =
    withinBand(usage, 0, 100) * 0.03
    + withinBand(usage, 100, 200) * 0.05
    + withinBand(usage, 200, Infinity) * 0.07;
 return usd(amount);
}

function topBand(usage) {
  return usage > 200 ? usage - 200 : 0;
}
```

ç…§ç°åœ¨çš„é€»è¾‘ï¼ŒbaseCharge ä¸€å¼€å§‹çš„å«è¯­å¥å·²ç»å¯ä»¥å»æ‰äº†ã€‚ä¸è¿‡ï¼Œå°½ç®¡è¿™æ¡è¯­å¥å·²ç»å¤±å»äº†é€»è¾‘ä¸Šçš„å¿…è¦æ€§ï¼Œæˆ‘è¿˜æ˜¯æ„¿æ„æŠŠå®ƒç•™åœ¨åŸåœ°ï¼Œå› ä¸ºå®ƒé˜æ˜äº†â€œä¼ å…¥çš„ usage å‚æ•°ä¸ºè´Ÿæ•°â€è¿™ç§æƒ…å†µæ˜¯å¦‚ä½•å¤„ç†çš„ã€‚

## 11.3 ç§»é™¤æ ‡è®°å‚æ•°ï¼ˆRemove Flag Argumentï¼‰

æ›¾ç”¨åï¼šä»¥æ˜ç¡®å‡½æ•°å–ä»£å‚æ•°ï¼ˆReplace Parameter with Explicit Methodsï¼‰

```
function setDimension(name, value) {
  if (name === "height") {
    this._height = value;
    return;
  }
  if (name === "width") {
    this._width = value;
    return;
  }
}

function setHeight(value) {
  this._height = value;
}
function setWidth(value) {
  this._width = value;
}
```

### åŠ¨æœº

â€œæ ‡è®°å‚æ•°â€æ˜¯è¿™æ ·çš„ä¸€ç§å‚æ•°ï¼šè°ƒç”¨è€…ç”¨å®ƒæ¥æŒ‡ç¤ºè¢«è°ƒå‡½æ•°åº”è¯¥æ‰§è¡Œå“ªä¸€éƒ¨åˆ†é€»è¾‘ã€‚ä¾‹å¦‚ï¼Œæˆ‘å¯èƒ½æœ‰ä¸‹é¢è¿™æ ·ä¸€ä¸ªå‡½æ•°ï¼š

```
function bookConcert(aCustomer, isPremium) {
  if (isPremium) {
    // logic for premium booking
  } else {
    // logic for regular booking
  }
}
```

è¦é¢„è®¢ä¸€åœºé«˜çº§éŸ³ä¹ä¼šï¼ˆpremium concertï¼‰ï¼Œå°±å¾—è¿™æ ·å‘èµ·è°ƒç”¨ï¼š

```
bookConcert(aCustomer, true);
```

æ ‡è®°å‚æ•°ä¹Ÿå¯èƒ½ä»¥æšä¸¾çš„å½¢å¼å‡ºç°ï¼š

```
bookConcert(aCustomer, CustomerType.PREMIUM);
```

æˆ–è€…æ˜¯ä»¥å­—ç¬¦ä¸²ï¼ˆæˆ–è€…ç¬¦å·ï¼Œå¦‚æœç¼–ç¨‹è¯­è¨€æ”¯æŒçš„è¯ï¼‰çš„å½¢å¼å‡ºç°ï¼š

```
bookConcert(aCustomer, "premium");
```

æˆ‘ä¸å–œæ¬¢æ ‡è®°å‚æ•°ï¼Œå› ä¸ºå®ƒä»¬è®©äººéš¾ä»¥ç†è§£åˆ°åº•æœ‰å“ªäº›å‡½æ•°å¯ä»¥è°ƒç”¨ã€åº”è¯¥æ€ä¹ˆè°ƒç”¨ã€‚æ‹¿åˆ°ä¸€ä»½ API ä»¥åï¼Œæˆ‘é¦–å…ˆçœ‹åˆ°çš„æ˜¯ä¸€ç³»åˆ—å¯ä¾›è°ƒç”¨çš„å‡½æ•°ï¼Œä½†æ ‡è®°å‚æ•°å´éšè—äº†å‡½æ•°è°ƒç”¨ä¸­å­˜åœ¨çš„å·®å¼‚æ€§ã€‚ä½¿ç”¨è¿™æ ·çš„å‡½æ•°ï¼Œæˆ‘è¿˜å¾—å¼„æ¸…æ ‡è®°å‚æ•°æœ‰å“ªäº›å¯ç”¨çš„å€¼ã€‚å¸ƒå°”å‹çš„æ ‡è®°å°¤å…¶ç³Ÿç³•ï¼Œå› ä¸ºå®ƒä»¬ä¸èƒ½æ¸…æ™°åœ°ä¼ è¾¾å…¶å«ä¹‰â€”â€”åœ¨è°ƒç”¨ä¸€ä¸ªå‡½æ•°æ—¶ï¼Œæˆ‘å¾ˆéš¾å¼„æ¸… true åˆ°åº•æ˜¯ä»€ä¹ˆæ„æ€ã€‚å¦‚æœæ˜ç¡®ç”¨ä¸€ä¸ªå‡½æ•°æ¥å®Œæˆä¸€é¡¹å•ç‹¬çš„ä»»åŠ¡ï¼Œå…¶å«ä¹‰ä¼šæ¸…æ™°å¾—å¤šã€‚

```
premiumBookConcert(aCustomer);
```

å¹¶éæ‰€æœ‰ç±»ä¼¼è¿™æ ·çš„å‚æ•°éƒ½æ˜¯æ ‡è®°å‚æ•°ã€‚å¦‚æœè°ƒç”¨è€…ä¼ å…¥çš„æ˜¯ç¨‹åºä¸­æµåŠ¨çš„æ•°æ®ï¼Œè¿™æ ·çš„å‚æ•°ä¸ç®—æ ‡è®°å‚æ•°ï¼›åªæœ‰è°ƒç”¨è€…ç›´æ¥ä¼ å…¥å­—é¢é‡å€¼ï¼Œè¿™æ‰æ˜¯æ ‡è®°å‚æ•°ã€‚å¦å¤–ï¼Œåœ¨å‡½æ•°å®ç°å†…éƒ¨ï¼Œå¦‚æœå‚æ•°å€¼åªæ˜¯ä½œä¸ºæ•°æ®ä¼ ç»™å…¶ä»–å‡½æ•°ï¼Œè¿™å°±ä¸æ˜¯æ ‡è®°å‚æ•°ï¼›åªæœ‰å‚æ•°å€¼å½±å“äº†å‡½æ•°å†…éƒ¨çš„æ§åˆ¶æµï¼Œè¿™æ‰æ˜¯æ ‡è®°å‚æ•°ã€‚

ç§»é™¤æ ‡è®°å‚æ•°ä¸ä»…ä½¿ä»£ç æ›´æ•´æ´ï¼Œå¹¶ä¸”èƒ½å¸®åŠ©å¼€å‘å·¥å…·æ›´å¥½åœ°å‘æŒ¥ä½œç”¨ã€‚å»æ‰æ ‡è®°å‚æ•°åï¼Œä»£ç åˆ†æå·¥å…·èƒ½æ›´å®¹æ˜“åœ°ä½“ç°å‡ºâ€œé«˜çº§â€å’Œâ€œæ™®é€šâ€ä¸¤ç§é¢„è®¢é€»è¾‘åœ¨ä½¿ç”¨æ—¶çš„åŒºåˆ«ã€‚

å¦‚æœä¸€ä¸ªå‡½æ•°æœ‰å¤šä¸ªæ ‡è®°å‚æ•°ï¼Œå¯èƒ½å°±ä¸å¾—ä¸å°†å…¶ä¿ç•™ï¼Œå¦åˆ™æˆ‘å°±å¾—é’ˆå¯¹å„ä¸ªå‚æ•°çš„å„ç§å–å€¼çš„æ‰€æœ‰ç»„åˆæƒ…å†µæä¾›æ˜ç¡®å‡½æ•°ã€‚ä¸è¿‡è¿™ä¹Ÿæ˜¯ä¸€ä¸ªä¿¡å·ï¼Œè¯´æ˜è¿™ä¸ªå‡½æ•°å¯èƒ½åšå¾—å¤ªå¤šï¼Œåº”è¯¥è€ƒè™‘æ˜¯å¦èƒ½ç”¨æ›´ç®€å•çš„å‡½æ•°æ¥ç»„åˆå‡ºå®Œæ•´çš„é€»è¾‘ã€‚

### åšæ³•

é’ˆå¯¹å‚æ•°çš„æ¯ä¸€ç§å¯èƒ½å€¼ï¼Œæ–°å»ºä¸€ä¸ªæ˜ç¡®å‡½æ•°ã€‚

å¦‚æœä¸»å‡½æ•°æœ‰æ¸…æ™°çš„æ¡ä»¶åˆ†å‘é€»è¾‘ï¼Œå¯ä»¥ç”¨åˆ†è§£æ¡ä»¶è¡¨è¾¾å¼ï¼ˆ260ï¼‰åˆ›å»ºæ˜ç¡®å‡½æ•°ï¼›å¦åˆ™ï¼Œå¯ä»¥åœ¨åŸå‡½æ•°ä¹‹ä¸Šåˆ›å»ºåŒ…è£…å‡½æ•°ã€‚

å¯¹äºâ€œç”¨å­—é¢é‡å€¼ä½œä¸ºå‚æ•°â€çš„å‡½æ•°è°ƒç”¨è€…ï¼Œå°†å…¶æ”¹ä¸ºè°ƒç”¨æ–°å»ºçš„æ˜ç¡®å‡½æ•°ã€‚

### èŒƒä¾‹

åœ¨æµè§ˆä»£ç æ—¶ï¼Œæˆ‘å‘ç°å¤šå¤„ä»£ç åœ¨è°ƒç”¨ä¸€ä¸ªå‡½æ•°è®¡ç®—ç‰©æµï¼ˆshipmentï¼‰çš„åˆ°è´§æ—¥æœŸï¼ˆdelivery dateï¼‰ã€‚ä¸€äº›è°ƒç”¨ä»£ç ç±»ä¼¼è¿™æ ·ï¼š

```
aShipment.deliveryDate = deliveryDate(anOrder, true);
```

å¦ä¸€äº›è°ƒç”¨ä»£ç åˆ™æ˜¯è¿™æ ·ï¼š

```
aShipment.deliveryDate = deliveryDate(anOrder, false);
```

é¢å¯¹è¿™æ ·çš„ä»£ç ï¼Œæˆ‘ç«‹å³å¼€å§‹å¥½å¥‡ï¼šå‚æ•°é‡Œè¿™ä¸ªå¸ƒå°”å€¼æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿæ˜¯ç”¨æ¥å¹²ä»€ä¹ˆçš„ï¼Ÿ

deliveryDate å‡½æ•°ä¸»ä½“å¦‚ä¸‹æ‰€ç¤ºï¼š

```
function deliveryDate(anOrder, isRush) {
  if (isRush) {
    let deliveryTime;
    if (["MA", "CT"].includes(anOrder.deliveryState)) deliveryTime = 1;
    else if (["NY", "NH"].includes(anOrder.deliveryState)) deliveryTime = 2;
    else deliveryTime = 3;
    return anOrder.placedOn.plusDays(1 + deliveryTime);
  } else {
    let deliveryTime;
    if (["MA", "CT", "NY"].includes(anOrder.deliveryState)) deliveryTime = 2;
    else if (["ME", "NH"].includes(anOrder.deliveryState)) deliveryTime = 3;
    else deliveryTime = 4;
    return anOrder.placedOn.plusDays(2 + deliveryTime);
  }
}
```

åŸæ¥è°ƒç”¨è€…ç”¨è¿™ä¸ªå¸ƒå°”å‹å­—é¢é‡æ¥åˆ¤æ–­åº”è¯¥è¿è¡Œå“ªä¸ªåˆ†æ”¯çš„ä»£ç â€”â€”å…¸å‹çš„æ ‡è®°å‚æ•°ã€‚ç„¶è€Œå‡½æ•°çš„é‡ç‚¹å°±åœ¨äºè¦éµå¾ªè°ƒç”¨è€…çš„æŒ‡ä»¤ï¼Œæ‰€ä»¥æœ€å¥½æ˜¯ç”¨æ˜ç¡®å‡½æ•°çš„å½¢å¼æ˜ç¡®è¯´å‡ºè°ƒç”¨è€…çš„æ„å›¾ã€‚

å¯¹äºè¿™ä¸ªä¾‹å­ï¼Œæˆ‘å¯ä»¥ä½¿ç”¨åˆ†è§£æ¡ä»¶è¡¨è¾¾å¼ï¼ˆ260ï¼‰ï¼Œå¾—åˆ°ä¸‹åˆ—ä»£ç ï¼š

```
function deliveryDate(anOrder, isRush) {
  if (isRush) return rushDeliveryDate(anOrder);
  else return regularDeliveryDate(anOrder);
}
function rushDeliveryDate(anOrder) {
  let deliveryTime;
  if (["MA", "CT"].includes(anOrder.deliveryState)) deliveryTime = 1;
  else if (["NY", "NH"].includes(anOrder.deliveryState)) deliveryTime = 2;
  else deliveryTime = 3;
  return anOrder.placedOn.plusDays(1 + deliveryTime);
}
function regularDeliveryDate(anOrder) {
  let deliveryTime;
  if (["MA", "CT", "NY"].includes(anOrder.deliveryState)) deliveryTime = 2;
  else if (["ME", "NH"].includes(anOrder.deliveryState)) deliveryTime = 3;
  else deliveryTime = 4;
  return anOrder.placedOn.plusDays(2 + deliveryTime);
}
```

è¿™ä¸¤ä¸ªå‡½æ•°èƒ½æ›´å¥½åœ°è¡¨è¾¾è°ƒç”¨è€…çš„æ„å›¾ï¼Œç°åœ¨æˆ‘å¯ä»¥ä¿®æ”¹è°ƒç”¨æ–¹ä»£ç äº†ã€‚è°ƒç”¨ä»£ç 

```
aShipment.deliveryDate = deliveryDate(anOrder, true);
```

å¯ä»¥æ”¹ä¸º

```
aShipment.deliveryDate = rushDeliveryDate(anOrder);
```

å¦ä¸€ä¸ªåˆ†æ”¯ä¹Ÿç±»ä¼¼ã€‚

å¤„ç†å®Œæ‰€æœ‰è°ƒç”¨å¤„ï¼Œæˆ‘å°±å¯ä»¥ç§»é™¤ deliveryDate å‡½æ•°ã€‚

è¿™ä¸ªå‚æ•°æ˜¯æ ‡è®°å‚æ•°ï¼Œä¸ä»…å› ä¸ºå®ƒæ˜¯å¸ƒå°”ç±»å‹ï¼Œè€Œä¸”è¿˜å› ä¸ºè°ƒç”¨æ–¹ä»¥å­—é¢é‡çš„å½¢å¼ç›´æ¥è®¾ç½®å‚æ•°å€¼ã€‚å¦‚æœæ‰€æœ‰è°ƒç”¨ deliveryDate çš„ä»£ç éƒ½åƒè¿™æ ·ï¼š

```
const isRush = determineIfRush(anOrder);
aShipment.deliveryDate = deliveryDate(anOrder, isRush);
```

é‚£æˆ‘å¯¹è¿™ä¸ªå‡½æ•°çš„ç­¾åæ²¡æœ‰ä»»ä½•æ„è§ï¼ˆä¸è¿‡æˆ‘è¿˜æ˜¯æƒ³ç”¨åˆ†è§£æ¡ä»¶è¡¨è¾¾å¼ï¼ˆ260ï¼‰æ¸…ç†å…¶å†…éƒ¨å®ç°ï¼‰ã€‚

å¯èƒ½æœ‰ä¸€äº›è°ƒç”¨è€…ç»™è¿™ä¸ªå‚æ•°ä¼ å…¥çš„æ˜¯å­—é¢é‡ï¼Œå°†å…¶ä½œä¸ºæ ‡è®°å‚æ•°ä½¿ç”¨ï¼›å¦ä¸€äº›è°ƒç”¨è€…åˆ™ä¼ å…¥æ­£å¸¸çš„æ•°æ®ã€‚è‹¥æœçœŸå¦‚æ­¤ï¼Œæˆ‘è¿˜æ˜¯ä¼šä½¿ç”¨ç§»é™¤æ ‡è®°å‚æ•°ï¼ˆ314ï¼‰ï¼Œä½†ä¸ä¿®æ”¹ä¼ å…¥æ­£å¸¸æ•°æ®çš„è°ƒç”¨è€…ï¼Œé‡æ„ç»“æŸæ—¶ä¹Ÿä¸åˆ é™¤ deliveryDate å‡½æ•°ã€‚è¿™æ ·æˆ‘å°±æä¾›äº†ä¸¤å¥—æ¥å£ï¼Œåˆ†åˆ«æ”¯æŒä¸åŒçš„ç”¨é€”ã€‚

ç›´æ¥æ‹†åˆ†æ¡ä»¶é€»è¾‘æ˜¯å®æ–½æœ¬é‡æ„çš„å¥½æ–¹æ³•ï¼Œä½†åªæœ‰å½“â€œæ ¹æ®å‚æ•°å€¼åšåˆ†å‘â€çš„é€»è¾‘å‘ç”Ÿåœ¨å‡½æ•°æœ€å¤–å±‚ï¼ˆæˆ–è€…å¯ä»¥æ¯”è¾ƒå®¹æ˜“åœ°å°†å…¶é‡æ„è‡³å‡½æ•°æœ€å¤–å±‚ï¼‰çš„æ—¶å€™ï¼Œè¿™ä¸€æ‹›æ‰å¥½ç”¨ã€‚å‡½æ•°å†…éƒ¨ä¹Ÿæœ‰å¯èƒ½ä»¥ä¸€ç§æ›´çº ç»“çš„æ–¹å¼ä½¿ç”¨æ ‡è®°å‚æ•°ï¼Œä¾‹å¦‚ä¸‹é¢è¿™ä¸ªç‰ˆæœ¬çš„ deliveryDate å‡½æ•°ï¼š

```
function deliveryDate(anOrder, isRush) {
 let result;
 let deliveryTime;
 if (anOrder.deliveryState === "MA" || anOrder.deliveryState === "CT")
  deliveryTime = isRush? 1 : 2;
 else if (anOrder.deliveryState === "NY" || anOrder.deliveryState === "NH") {
  deliveryTime = 2;
  if (anOrder.deliveryState === "NH" &amp;&amp; !isRush)
   deliveryTime = 3;
 }
 else if (isRush)
  deliveryTime = 3;
 else if (anOrder.deliveryState === "ME")
  deliveryTime = 3;
 else
  deliveryTime = 4;
 result = anOrder.placedOn.plusDays(2 + deliveryTime);
 if (isRush) result = result.minusDays(1);
 return result;
}
```

è¿™ç§æƒ…å†µä¸‹ï¼Œæƒ³æŠŠå›´ç»• isRush çš„åˆ†å‘é€»è¾‘å‰¥ç¦»åˆ°é¡¶å±‚ï¼Œéœ€è¦çš„å·¥ä½œé‡å¯èƒ½ä¼šå¾ˆå¤§ã€‚æ‰€ä»¥æˆ‘é€‰æ‹©é€€è€Œæ±‚å…¶æ¬¡ï¼Œåœ¨ deliveryDate ä¹‹ä¸Šæ·»åŠ ä¸¤ä¸ªå‡½æ•°ï¼š

```
function rushDeliveryDate(anOrder) {
  return deliveryDate(anOrder, true);
}
function regularDeliveryDate(anOrder) {
  return deliveryDate(anOrder, false);
}
```

æœ¬è´¨ä¸Šï¼Œè¿™ä¸¤ä¸ªåŒ…è£…å‡½æ•°åˆ†åˆ«ä»£è¡¨äº† deliveryDate å‡½æ•°ä¸€éƒ¨åˆ†çš„ä½¿ç”¨æ–¹å¼ã€‚ä¸è¿‡å®ƒä»¬å¹¶éä»åŸå‡½æ•°ä¸­æ‹†åˆ†è€Œæ¥ï¼Œè€Œæ˜¯ç”¨ä»£ç æ–‡æœ¬å¼ºè¡Œå®šä¹‰çš„ã€‚

éšåï¼Œæˆ‘åŒæ ·å¯ä»¥é€ä¸€æ›¿æ¢åŸå‡½æ•°çš„è°ƒç”¨è€…ï¼Œå°±è·Ÿå‰é¢åˆ†è§£æ¡ä»¶è¡¨è¾¾å¼ä¹‹åçš„å¤„ç†ä¸€æ ·ã€‚å¦‚æœæ²¡æœ‰ä»»ä½•ä¸€ä¸ªè°ƒç”¨è€…å‘ isRush å‚æ•°ä¼ å…¥æ­£å¸¸çš„æ•°æ®ï¼Œæˆ‘æœ€åä¼šé™åˆ¶åŸå‡½æ•°çš„å¯è§æ€§ï¼Œæˆ–æ˜¯å°†å…¶æ”¹åï¼ˆä¾‹å¦‚æ”¹ä¸º deliveryDateHelperOnlyï¼‰ï¼Œè®©äººä¸€è§å³çŸ¥ä¸åº”ç›´æ¥ä½¿ç”¨è¿™ä¸ªå‡½æ•°ã€‚

## 11.4 ä¿æŒå¯¹è±¡å®Œæ•´ï¼ˆPreserve Whole Objectï¼‰

```
const low = aRoom.daysTempRange.low;
const high = aRoom.daysTempRange.high;
if (aPlan.withinRange(low, high))


if (aPlan.withinRange(aRoom.daysTempRange))
```

### åŠ¨æœº

å¦‚æœæˆ‘çœ‹è§ä»£ç ä»ä¸€ä¸ªè®°å½•ç»“æ„ä¸­å¯¼å‡ºå‡ ä¸ªå€¼ï¼Œç„¶ååˆæŠŠè¿™å‡ ä¸ªå€¼ä¸€èµ·ä¼ é€’ç»™ä¸€ä¸ªå‡½æ•°ï¼Œæˆ‘ä¼šæ›´æ„¿æ„æŠŠæ•´ä¸ªè®°å½•ä¼ ç»™è¿™ä¸ªå‡½æ•°ï¼Œåœ¨å‡½æ•°ä½“å†…éƒ¨å¯¼å‡ºæ‰€éœ€çš„å€¼ã€‚

â€œä¼ é€’æ•´ä¸ªè®°å½•â€çš„æ–¹å¼èƒ½æ›´å¥½åœ°åº”å¯¹å˜åŒ–ï¼šå¦‚æœå°†æ¥è¢«è°ƒçš„å‡½æ•°éœ€è¦ä»è®°å½•ä¸­å¯¼å‡ºæ›´å¤šçš„æ•°æ®ï¼Œæˆ‘å°±ä¸ç”¨ä¸ºæ­¤ä¿®æ”¹å‚æ•°åˆ—è¡¨ã€‚å¹¶ä¸”ä¼ é€’æ•´ä¸ªè®°å½•ä¹Ÿèƒ½ç¼©çŸ­å‚æ•°åˆ—è¡¨ï¼Œè®©å‡½æ•°è°ƒç”¨æ›´å®¹æ˜“çœ‹æ‡‚ã€‚å¦‚æœæœ‰å¾ˆå¤šå‡½æ•°éƒ½åœ¨ä½¿ç”¨è®°å½•ä¸­çš„åŒä¸€ç»„æ•°æ®ï¼Œå¤„ç†è¿™éƒ¨åˆ†æ•°æ®çš„é€»è¾‘å¸¸ä¼šé‡å¤ï¼Œæ­¤æ—¶å¯ä»¥æŠŠè¿™äº›å¤„ç†é€»è¾‘æ¬ç§»åˆ°å®Œæ•´å¯¹è±¡ä¸­å»ã€‚

ä¹Ÿæœ‰æ—¶æˆ‘ä¸æƒ³é‡‡ç”¨æœ¬é‡æ„æ‰‹æ³•ï¼Œå› ä¸ºæˆ‘ä¸æƒ³è®©è¢«è°ƒå‡½æ•°ä¾èµ–å®Œæ•´å¯¹è±¡ï¼Œå°¤å…¶æ˜¯åœ¨ä¸¤è€…ä¸åœ¨åŒä¸€ä¸ªæ¨¡å—ä¸­çš„æ—¶å€™ã€‚

ä»ä¸€ä¸ªå¯¹è±¡ä¸­æŠ½å–å‡ºå‡ ä¸ªå€¼ï¼Œå•ç‹¬å¯¹è¿™å‡ ä¸ªå€¼åšæŸäº›é€»è¾‘æ“ä½œï¼Œè¿™æ˜¯ä¸€ç§ä»£ç åå‘³é“ï¼ˆä¾æ‹æƒ…ç»“ï¼‰ï¼Œé€šå¸¸æ ‡å¿—ç€è¿™æ®µé€»è¾‘åº”è¯¥è¢«æ¬ç§»åˆ°å¯¹è±¡ä¸­ã€‚ä¿æŒå¯¹è±¡å®Œæ•´ç»å¸¸å‘ç”Ÿåœ¨å¼•å…¥å‚æ•°å¯¹è±¡ï¼ˆ140ï¼‰ä¹‹åï¼Œæˆ‘ä¼šæœå¯»ä½¿ç”¨åŸæ¥çš„æ•°æ®æ³¥å›¢çš„ä»£ç ï¼Œä»£ä¹‹ä»¥ä½¿ç”¨æ–°çš„å¯¹è±¡ã€‚

å¦‚æœå‡ å¤„ä»£ç éƒ½åœ¨ä½¿ç”¨å¯¹è±¡çš„ä¸€éƒ¨åˆ†åŠŸèƒ½ï¼Œå¯èƒ½æ„å‘³ç€åº”è¯¥ç”¨æç‚¼ç±»ï¼ˆ182ï¼‰æŠŠè¿™ä¸€éƒ¨åˆ†åŠŸèƒ½å•ç‹¬æç‚¼å‡ºæ¥ã€‚

è¿˜æœ‰ä¸€ç§å¸¸è¢«å¿½è§†çš„æƒ…å†µï¼šè°ƒç”¨è€…å°†è‡ªå·±çš„è‹¥å¹²æ•°æ®ä½œä¸ºå‚æ•°ï¼Œä¼ é€’ç»™è¢«è°ƒç”¨å‡½æ•°ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘å¯ä»¥å°†è°ƒç”¨è€…çš„è‡ªæˆ‘å¼•ç”¨ï¼ˆåœ¨ JavaScript ä¸­å°±æ˜¯ thisï¼‰ä½œä¸ºå‚æ•°ï¼Œç›´æ¥ä¼ é€’ç»™ç›®æ ‡å‡½æ•°ã€‚

### åšæ³•

æ–°å»ºä¸€ä¸ªç©ºå‡½æ•°ï¼Œç»™å®ƒä»¥æœŸæœ›ä¸­çš„å‚æ•°åˆ—è¡¨ï¼ˆå³ä¼ å…¥å®Œæ•´å¯¹è±¡ä½œä¸ºå‚æ•°ï¼‰ã€‚

ç»™è¿™ä¸ªå‡½æ•°èµ·ä¸€ä¸ªå®¹æ˜“æœç´¢çš„åå­—ï¼Œè¿™æ ·åˆ°é‡æ„ç»“æŸæ—¶æ–¹ä¾¿æ›¿æ¢ã€‚

åœ¨æ–°å‡½æ•°ä½“å†…è°ƒç”¨æ—§å‡½æ•°ï¼Œå¹¶æŠŠæ–°çš„å‚æ•°ï¼ˆå³å®Œæ•´å¯¹è±¡ï¼‰æ˜ å°„åˆ°æ—§çš„å‚æ•°åˆ—è¡¨ï¼ˆå³æ¥æºäºå®Œæ•´å¯¹è±¡çš„å„é¡¹æ•°æ®ï¼‰ã€‚

æ‰§è¡Œé™æ€æ£€æŸ¥ã€‚

é€ä¸€ä¿®æ”¹æ—§å‡½æ•°çš„è°ƒç”¨è€…ï¼Œä»¤å…¶ä½¿ç”¨æ–°å‡½æ•°ï¼Œæ¯æ¬¡ä¿®æ”¹ä¹‹åæ‰§è¡Œæµ‹è¯•ã€‚

ä¿®æ”¹ä¹‹åï¼Œè°ƒç”¨å¤„ç”¨äºâ€œä»å®Œæ•´å¯¹è±¡ä¸­å¯¼å‡ºå‚æ•°å€¼â€çš„ä»£ç å¯èƒ½å°±æ²¡ç”¨äº†ï¼Œå¯ä»¥ç”¨ç§»é™¤æ­»ä»£ç ï¼ˆ237ï¼‰å»æ‰ã€‚

æ‰€æœ‰è°ƒç”¨å¤„éƒ½ä¿®æ”¹è¿‡æ¥ä¹‹åï¼Œä½¿ç”¨å†…è”å‡½æ•°ï¼ˆ115ï¼‰æŠŠæ—§å‡½æ•°å†…è”åˆ°æ–°å‡½æ•°ä½“å†…ã€‚

ç»™æ–°å‡½æ•°æ”¹åï¼Œä»é‡æ„å¼€å§‹æ—¶çš„å®¹æ˜“æœç´¢çš„ä¸´æ—¶åå­—ï¼Œæ”¹ä¸ºä½¿ç”¨æ—§å‡½æ•°çš„åå­—ï¼ŒåŒæ—¶ä¿®æ”¹æ‰€æœ‰è°ƒç”¨å¤„ã€‚

### èŒƒä¾‹

æˆ‘ä»¬æƒ³è±¡ä¸€ä¸ªå®¤æ¸©ç›‘æ§ç³»ç»Ÿï¼Œå®ƒè´Ÿè´£è®°å½•æˆ¿é—´ä¸€å¤©ä¸­çš„æœ€é«˜æ¸©åº¦å’Œæœ€ä½æ¸©åº¦ï¼Œç„¶åå°†å®é™…çš„æ¸©åº¦èŒƒå›´ä¸é¢„å…ˆè§„å®šçš„æ¸©åº¦æ§åˆ¶è®¡åˆ’ï¼ˆheating planï¼‰ç›¸æ¯”è¾ƒï¼Œå¦‚æœå½“å¤©æ¸©åº¦ä¸ç¬¦åˆè®¡åˆ’è¦æ±‚ï¼Œå°±å‘å‡ºè­¦å‘Šã€‚

**è°ƒç”¨æ–¹...**

```
const low = aRoom.daysTempRange.low;
const high = aRoom.daysTempRange.high;
if (!aPlan.withinRange(low, high))
  alerts.push("room temperature went outside range");
```

**class HeatingPlan...**

```
withinRange(bottom, top) {
 return (bottom >= this._temperatureRange.low) &amp;&amp; (top <= this._temperatureRange.high);
}
```

å…¶å®æˆ‘ä¸å¿…å°†â€œæ¸©åº¦èŒƒå›´â€çš„ä¿¡æ¯æ‹†å¼€æ¥å•ç‹¬ä¼ é€’ï¼Œåªéœ€å°†æ•´ä¸ªèŒƒå›´å¯¹è±¡ä¼ é€’ç»™ withinRange å‡½æ•°å³å¯ã€‚

é¦–å…ˆï¼Œæˆ‘åœ¨ HeatingPlan ç±»ä¸­æ–°æ·»ä¸€ä¸ªç©ºå‡½æ•°ï¼Œç»™å®ƒèµ‹äºˆæˆ‘è®¤ä¸ºåˆç†çš„å‚æ•°åˆ—è¡¨ã€‚

**class HeatingPlan...**

```
xxNEWwithinRange(aNumberRange) {
}
```

å› ä¸ºè¿™ä¸ªå‡½æ•°æœ€ç»ˆè¦å–ä»£ç°æœ‰çš„ withinRange å‡½æ•°ï¼Œæ‰€ä»¥å®ƒä¹Ÿç”¨äº†åŒæ ·çš„åå­—ï¼Œå†åŠ ä¸Šä¸€ä¸ªå®¹æ˜“æ›¿æ¢çš„å‰ç¼€ã€‚

ç„¶ååœ¨æ–°å‡½æ•°ä½“å†…è°ƒç”¨ç°æœ‰çš„ withinRange å‡½æ•°ã€‚å› æ­¤ï¼Œæ–°å‡½æ•°ä½“å°±å®Œæˆäº†ä»æ–°å‚æ•°åˆ—è¡¨åˆ°æ—§å‡½æ•°å‚æ•°åˆ—è¡¨çš„æ˜ å°„ã€‚

**class HeatingPlan...**

```
xxNEWwithinRange(aNumberRange) {
  return this.withinRange(aNumberRange.low, aNumberRange.high);
}
```

ç°åœ¨å¼€å§‹æ­£å¼çš„æ›¿æ¢å·¥ä½œäº†ï¼Œæˆ‘è¦æ‰¾åˆ°è°ƒç”¨ç°æœ‰å‡½æ•°çš„åœ°æ–¹ï¼Œå°†å…¶æ”¹ä¸ºè°ƒç”¨æ–°å‡½æ•°ã€‚

**è°ƒç”¨æ–¹...**

```
const low = aRoom.daysTempRange.low;
const high = aRoom.daysTempRange.high;
if (!aPlan.xxNEWwithinRange(aRoom.daysTempRange))
  alerts.push("room temperature went outside range");
```

åœ¨ä¿®æ”¹è°ƒç”¨å¤„æ—¶ï¼Œæˆ‘å¯èƒ½ä¼šå‘ç°ä¸€äº›ä»£ç åœ¨ä¿®æ”¹åå·²ç»ä¸å†éœ€è¦ï¼Œæ­¤æ—¶å¯ä»¥ä½¿ç”¨ç§»é™¤æ­»ä»£ç ï¼ˆ237ï¼‰ã€‚

**è°ƒç”¨æ–¹...**

```
const low = aRoom.daysTempRange.low;
const high = aRoom.daysTempRange.high;
if (!aPlan.xxNEWwithinRange(aRoom.daysTempRange))
  alerts.push("room temperature went outside range");
```

æ¯æ¬¡æ›¿æ¢ä¸€å¤„è°ƒç”¨ä»£ç ï¼Œæ¯æ¬¡ä¿®æ”¹åéƒ½è¦æµ‹è¯•ã€‚

è°ƒç”¨å¤„å…¨éƒ¨æ›¿æ¢å®Œæˆåï¼Œç”¨å†…è”å‡½æ•°ï¼ˆ115ï¼‰å°†æ—§å‡½æ•°å†…è”åˆ°æ–°å‡½æ•°ä½“å†…ã€‚

**class HeatingPlan...**

```
xxNEWwithinRange(aNumberRange) {
 return (aNumberRange.low >= this._temperatureRange.low) &amp;&amp;
  (aNumberRange.high <= this._temperatureRange.high);
}
```

ç»ˆäºå¯ä»¥å»æ‰æ–°å‡½æ•°é‚£éš¾çœ‹çš„å‰ç¼€äº†ï¼Œè®°å¾—åŒæ—¶ä¿®æ”¹æ‰€æœ‰è°ƒç”¨è€…ã€‚å°±ç®—æˆ‘æ‰€ä½¿ç”¨çš„å¼€å‘ç¯å¢ƒä¸æ”¯æŒå¯é çš„å‡½æ•°æ”¹åæ“ä½œï¼Œæœ‰è¿™ä¸ªæå…·ç‰¹è‰²çš„å‰ç¼€åœ¨ï¼Œæˆ‘ä¹Ÿå¯ä»¥å¾ˆæ–¹ä¾¿åœ°å…¨å±€æ›¿æ¢ã€‚

**class HeatingPlan...**

```
withinRange(aNumberRange) {
 return (aNumberRange.low >= this._temperatureRange.low) &amp;&amp;
  (aNumberRange.high <= this._temperatureRange.high);
}
```

**è°ƒç”¨æ–¹...**

```
if (!aPlan.withinRange(aRoom.daysTempRange))
  alerts.push("room temperature went outside range");
```

### èŒƒä¾‹ï¼šæ¢ä¸ªæ–¹å¼åˆ›å»ºæ–°å‡½æ•°

åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ç›´æ¥ç¼–å†™äº†æ–°å‡½æ•°ã€‚å¤§å¤šæ•°æ—¶å€™ï¼Œè¿™ä¸€æ­¥éå¸¸ç®€å•ï¼Œä¹Ÿæ˜¯åˆ›å»ºæ–°å‡½æ•°æœ€å®¹æ˜“çš„æ–¹å¼ã€‚ä¸è¿‡æœ‰æ—¶è¿˜ä¼šç”¨åˆ°å¦ä¸€ç§æ–¹å¼ï¼šå¯ä»¥å®Œå…¨é€šè¿‡é‡æ„æ‰‹æ³•çš„ç»„åˆæ¥å¾—åˆ°æ–°å‡½æ•°ã€‚

æˆ‘ä»ä¸€å¤„è°ƒç”¨ç°æœ‰å‡½æ•°çš„ä»£ç å¼€å§‹ã€‚

**è°ƒç”¨æ–¹...**

```
const low = aRoom.daysTempRange.low;
const high = aRoom.daysTempRange.high;
if (!aPlan.withinRange(low, high))
  alerts.push("room temperature went outside range");
```

æˆ‘è¦å…ˆå¯¹ä»£ç åšä¸€äº›æ•´ç†ï¼Œä»¥ä¾¿ç”¨æç‚¼å‡½æ•°ï¼ˆ106ï¼‰æ¥åˆ›å»ºæ–°å‡½æ•°ã€‚ç›®å‰çš„è°ƒç”¨è€…ä»£ç è¿˜ä¸å…·å¤‡å¯æç‚¼çš„å‡½æ•°é›å½¢ï¼Œä¸è¿‡æˆ‘å¯ä»¥å…ˆåšå‡ æ¬¡æç‚¼å˜é‡ï¼ˆ119ï¼‰ï¼Œä½¿å…¶è½®å»“æ˜¾ç°å‡ºæ¥ã€‚é¦–å…ˆï¼Œæˆ‘è¦æŠŠå¯¹æ—§å‡½æ•°çš„è°ƒç”¨ä»æ¡ä»¶åˆ¤æ–­ä¸­è§£æ”¾å‡ºæ¥ã€‚

**è°ƒç”¨æ–¹...**

```
const low = aRoom.daysTempRange.low;
const high = aRoom.daysTempRange.high;
const isWithinRange = aPlan.withinRange(low, high);
if (!isWithinRange) alerts.push("room temperature went outside range");
```

ç„¶åæŠŠè¾“å…¥å‚æ•°ä¹Ÿæç‚¼å‡ºæ¥ã€‚

**è°ƒç”¨æ–¹...**

```
const tempRange = aRoom.daysTempRange;
const low = tempRange.low;
const high = tempRange.high;
const isWithinRange = aPlan.withinRange(low, high);
if (!isWithinRange) alerts.push("room temperature went outside range");
```

å®Œæˆè¿™ä¸€æ­¥ä¹‹åï¼Œå°±å¯ä»¥ç”¨æç‚¼å‡½æ•°ï¼ˆ106ï¼‰æ¥åˆ›å»ºæ–°å‡½æ•°ã€‚

**è°ƒç”¨æ–¹...**

```
const tempRange = aRoom.daysTempRange;
const isWithinRange = xxNEWwithinRange(aPlan, tempRange);
if (!isWithinRange) alerts.push("room temperature went outside range");
```

**é¡¶å±‚ä½œç”¨åŸŸ...**

```
function xxNEWwithinRange(aPlan, tempRange) {
  const low = tempRange.low;
  const high = tempRange.high;
  const isWithinRange = aPlan.withinRange(low, high);
  return isWithinRange;
}
```

ç”±äºæ—§å‡½æ•°å±äºå¦ä¸€ä¸ªä¸Šä¸‹æ–‡ï¼ˆHeatingPlan ç±»ï¼‰ï¼Œæˆ‘éœ€è¦ç”¨æ¬ç§»å‡½æ•°ï¼ˆ198ï¼‰æŠŠæ–°å‡½æ•°ä¹Ÿæ¬è¿‡å»ã€‚

**è°ƒç”¨æ–¹...**

```
const tempRange = aRoom.daysTempRange;
const isWithinRange = aPlan.xxNEWwithinRange(tempRange);
if (!isWithinRange) alerts.push("room temperature went outside range");
```

**class HeatingPlan...**

```
xxNEWwithinRange(tempRange) {
  const low = tempRange.low;
  const high = tempRange.high;
  const isWithinRange = this.withinRange(low, high);
  return isWithinRange;
}
```

å‰©ä¸‹çš„è¿‡ç¨‹å°±è·Ÿå‰é¢ä¸€æ ·äº†ï¼šæ›¿æ¢å…¶ä»–è°ƒç”¨è€…ï¼Œç„¶åæŠŠæ—§å‡½æ•°å†…è”åˆ°æ–°å‡½æ•°ä¸­ã€‚é‡æ„åˆšå¼€å§‹çš„æ—¶å€™ï¼Œä¸ºäº†æ¸…æ™°åˆ†ç¦»å‡½æ•°è°ƒç”¨ï¼Œä»¥ä¾¿æç‚¼å‡ºæ–°å‡½æ•°ï¼Œæˆ‘æç‚¼äº†å‡ ä¸ªå˜é‡å‡ºæ¥ï¼Œç°åœ¨å¯ä»¥æŠŠè¿™äº›å˜é‡ä¹Ÿå†…è”å›å»ã€‚

è¿™ç§æ–¹å¼çš„å¥½å¤„åœ¨äºï¼šå®ƒå®Œå…¨æ˜¯ç”±å…¶ä»–é‡æ„æ‰‹æ³•ç»„åˆè€Œæˆçš„ã€‚å¦‚æœæˆ‘ä½¿ç”¨çš„å¼€å‘å·¥å…·æ”¯æŒå¯é çš„æç‚¼å’Œå†…è”æ“ä½œï¼Œç”¨è¿™ç§æ–¹å¼è¿›è¡Œæœ¬é‡æ„ä¼šç‰¹åˆ«æµç•…ã€‚

## 11.5 ä»¥æŸ¥è¯¢å–ä»£å‚æ•°ï¼ˆReplace Parameter with Queryï¼‰

æ›¾ç”¨åï¼šä»¥å‡½æ•°å–ä»£å‚æ•°ï¼ˆReplace Parameter with Methodï¼‰

åå‘é‡æ„ï¼šä»¥å‚æ•°å–ä»£æŸ¥è¯¢ï¼ˆ327ï¼‰

```
availableVacation(anEmployee, anEmployee.grade);

function availableVacation(anEmployee, grade) {
  // calculate vacation...


  availableVacation(anEmployee)

function availableVacation(anEmployee) {
  const grade = anEmployee.grade;
  // calculate vacation...
```

### åŠ¨æœº

å‡½æ•°çš„å‚æ•°åˆ—è¡¨åº”è¯¥æ€»ç»“è¯¥å‡½æ•°çš„å¯å˜æ€§ï¼Œæ ‡ç¤ºå‡ºå‡½æ•°å¯èƒ½ä½“ç°å‡ºè¡Œä¸ºå·®å¼‚çš„ä¸»è¦æ–¹å¼ã€‚å’Œä»»ä½•ä»£ç ä¸­çš„è¯­å¥ä¸€æ ·ï¼Œå‚æ•°åˆ—è¡¨åº”è¯¥å°½é‡é¿å…é‡å¤ï¼Œå¹¶ä¸”å‚æ•°åˆ—è¡¨è¶ŠçŸ­å°±è¶Šå®¹æ˜“ç†è§£ã€‚

å¦‚æœè°ƒç”¨å‡½æ•°æ—¶ä¼ å…¥äº†ä¸€ä¸ªå€¼ï¼Œè€Œè¿™ä¸ªå€¼ç”±å‡½æ•°è‡ªå·±æ¥è·å¾—ä¹Ÿæ˜¯åŒæ ·å®¹æ˜“ï¼Œè¿™å°±æ˜¯é‡å¤ã€‚è¿™ä¸ªæœ¬ä¸å¿…è¦çš„å‚æ•°ä¼šå¢åŠ è°ƒç”¨è€…çš„éš¾åº¦ï¼Œå› ä¸ºå®ƒä¸å¾—ä¸æ‰¾å‡ºæ­£ç¡®çš„å‚æ•°å€¼ï¼Œå…¶å®åŸæœ¬è°ƒç”¨è€…æ˜¯ä¸éœ€è¦è´¹è¿™ä¸ªåŠ›æ°”çš„ã€‚

â€œåŒæ ·å®¹æ˜“â€å››ä¸ªå­—ï¼Œåˆ’å‡ºäº†ä¸€æ¡åˆ¤æ–­çš„ç•Œé™ã€‚å»é™¤å‚æ•°ä¹Ÿå°±æ„å‘³ç€â€œè·å¾—æ­£ç¡®çš„å‚æ•°å€¼â€çš„è´£ä»»è¢«è½¬ç§»ï¼šæœ‰å‚æ•°ä¼ å…¥æ—¶ï¼Œè°ƒç”¨è€…éœ€è¦è´Ÿè´£è·å¾—æ­£ç¡®çš„å‚æ•°å€¼ï¼›å‚æ•°å»é™¤åï¼Œè´£ä»»å°±è¢«è½¬ç§»ç»™äº†å‡½æ•°æœ¬èº«ã€‚ä¸€èˆ¬è€Œè¨€ï¼Œæˆ‘ä¹ æƒ¯äºç®€åŒ–è°ƒç”¨æ–¹ï¼Œå› æ­¤æˆ‘æ„¿æ„æŠŠè´£ä»»ç§»äº¤ç»™å‡½æ•°æœ¬èº«ï¼Œä½†å¦‚æœå‡½æ•°éš¾ä»¥æ‰¿æ‹…è¿™ä»½è´£ä»»ï¼Œå°±å¦å½“åˆ«è®ºäº†ã€‚

ä¸ä½¿ç”¨ä»¥æŸ¥è¯¢å–ä»£å‚æ•°æœ€å¸¸è§çš„åŸå› æ˜¯ï¼Œç§»é™¤å‚æ•°å¯èƒ½ä¼šç»™å‡½æ•°ä½“å¢åŠ ä¸å¿…è¦çš„ä¾èµ–å…³ç³»â€”â€”è¿«ä½¿å‡½æ•°è®¿é—®æŸä¸ªç¨‹åºå…ƒç´ ï¼Œè€Œæˆ‘åŸæœ¬ä¸æƒ³è®©å‡½æ•°äº†è§£è¿™ä¸ªå…ƒç´ çš„å­˜åœ¨ã€‚è¿™ç§â€œä¸å¿…è¦çš„ä¾èµ–å…³ç³»â€é™¤äº†æ–°å¢çš„ä»¥å¤–ï¼Œä¹Ÿå¯èƒ½æ˜¯æˆ‘æƒ³è¦ç¨åå»é™¤çš„ï¼Œä¾‹å¦‚ä¸ºäº†å»é™¤ä¸€ä¸ªå‚æ•°ï¼Œæˆ‘å¯èƒ½ä¼šåœ¨å‡½æ•°ä½“å†…è°ƒç”¨ä¸€ä¸ªæœ‰é—®é¢˜çš„å‡½æ•°ï¼Œæˆ–æ˜¯ä»ä¸€ä¸ªå¯¹è±¡ä¸­è·å–æŸäº›åŸæœ¬æƒ³è¦å‰¥ç¦»å‡ºå»çš„æ•°æ®ã€‚åœ¨è¿™äº›æƒ…å†µä¸‹ï¼Œéƒ½åº”è¯¥æ…é‡è€ƒè™‘ä½¿ç”¨ä»¥æŸ¥è¯¢å–ä»£å‚æ•°ã€‚

å¦‚æœæƒ³è¦å»é™¤çš„å‚æ•°å€¼åªéœ€è¦å‘å¦ä¸€ä¸ªå‚æ•°æŸ¥è¯¢å°±èƒ½å¾—åˆ°ï¼Œè¿™æ˜¯ä½¿ç”¨ä»¥æŸ¥è¯¢å–ä»£å‚æ•°æœ€å®‰å…¨çš„åœºæ™¯ã€‚å¦‚æœå¯ä»¥ä»ä¸€ä¸ªå‚æ•°æ¨å¯¼å‡ºå¦ä¸€ä¸ªå‚æ•°ï¼Œé‚£ä¹ˆå‡ ä¹æ²¡æœ‰ä»»ä½•ç†ç”±è¦åŒæ—¶ä¼ é€’è¿™ä¸¤ä¸ªå‚æ•°ã€‚

å¦å¤–æœ‰ä¸€ä»¶äº‹éœ€è¦ç•™æ„ï¼šå¦‚æœåœ¨å¤„ç†çš„å‡½æ•°å…·æœ‰å¼•ç”¨é€æ˜æ€§ï¼ˆreferential transparencyï¼Œå³ï¼Œä¸è®ºä»»ä½•æ—¶å€™ï¼Œåªè¦ä¼ å…¥ç›¸åŒçš„å‚æ•°å€¼ï¼Œè¯¥å‡½æ•°çš„è¡Œä¸ºæ°¸è¿œä¸€è‡´ï¼‰ï¼Œè¿™æ ·çš„å‡½æ•°æ—¢å®¹æ˜“ç†è§£åˆå®¹æ˜“æµ‹è¯•ï¼Œæˆ‘ä¸æƒ³ä½¿å…¶å¤±å»è¿™ç§ä¼˜ç§€å“è´¨ã€‚æˆ‘ä¸ä¼šå»æ‰å®ƒçš„å‚æ•°ï¼Œè®©å®ƒå»è®¿é—®ä¸€ä¸ªå¯å˜çš„å…¨å±€å˜é‡ã€‚

### åšæ³•

å¦‚æœæœ‰å¿…è¦ï¼Œä½¿ç”¨æç‚¼å‡½æ•°ï¼ˆ106ï¼‰å°†å‚æ•°çš„è®¡ç®—è¿‡ç¨‹æç‚¼åˆ°ä¸€ä¸ªç‹¬ç«‹çš„å‡½æ•°ä¸­ã€‚

å°†å‡½æ•°ä½“å†…å¼•ç”¨è¯¥å‚æ•°çš„åœ°æ–¹æ”¹ä¸ºè°ƒç”¨æ–°å»ºçš„å‡½æ•°ã€‚æ¯æ¬¡ä¿®æ”¹åæ‰§è¡Œæµ‹è¯•ã€‚

å…¨éƒ¨æ›¿æ¢å®Œæˆåï¼Œä½¿ç”¨æ”¹å˜å‡½æ•°å£°æ˜ï¼ˆ124ï¼‰å°†è¯¥å‚æ•°å»æ‰ã€‚

### èŒƒä¾‹

æŸäº›é‡æ„ä¼šä½¿å‚æ•°ä¸å†è¢«éœ€è¦ï¼Œè¿™æ˜¯æˆ‘æœ€å¸¸ç”¨åˆ°ä»¥æŸ¥è¯¢å–ä»£å‚æ•°çš„åœºåˆã€‚è€ƒè™‘ä¸‹åˆ—ä»£ç ã€‚

**class Order...**

```
get finalPrice() {
 const basePrice = this.quantity * this.itemPrice;
 let discountLevel;
 if (this.quantity > 100) discountLevel = 2;
 else discountLevel = 1;
 return this.discountedPrice(basePrice, discountLevel);
}

discountedPrice(basePrice, discountLevel) {
 switch (discountLevel) {
  case 1: return basePrice * 0.95;
  case 2: return basePrice * 0.9;
 }
}
```

åœ¨ç®€åŒ–å‡½æ•°é€»è¾‘æ—¶ï¼Œæˆ‘æ€»æ˜¯çƒ­è¡·äºä½¿ç”¨ä»¥æŸ¥è¯¢å–ä»£ä¸´æ—¶å˜é‡ï¼ˆ178ï¼‰ï¼Œäºæ˜¯å°±å¾—åˆ°äº†å¦‚ä¸‹ä»£ç ã€‚

**class Order...**

```
get finalPrice() {
 const basePrice = this.quantity * this.itemPrice;
 return this.discountedPrice(basePrice, this.discountLevel);
}

get discountLevel() {
 return (this.quantity > 100) ? 2 : 1;
}
```

åˆ°è¿™ä¸€æ­¥ï¼Œå·²ç»ä¸éœ€è¦å†æŠŠ discountLevel çš„è®¡ç®—ç»“æœä¼ ç»™ discountedPrice äº†ï¼Œåè€…å¯ä»¥è‡ªå·±è°ƒç”¨ discountLevel å‡½æ•°ï¼Œä¸ä¼šå¢åŠ ä»»ä½•éš¾åº¦ã€‚

å› æ­¤ï¼Œæˆ‘æŠŠ discountedPrice å‡½æ•°ä¸­ç”¨åˆ°è¿™ä¸ªå‚æ•°çš„åœ°æ–¹å…¨éƒ½æ”¹ä¸ºç›´æ¥è°ƒç”¨ discountLevel å‡½æ•°ã€‚

**class Order...**

```
discountedPrice(basePrice, discountLevel) {
 switch (this.discountLevel) {
  case 1: return basePrice * 0.95;
  case 2: return basePrice * 0.9;
 }
}
```

ç„¶åç”¨æ”¹å˜å‡½æ•°å£°æ˜ï¼ˆ124ï¼‰æ‰‹æ³•ç§»é™¤è¯¥å‚æ•°ã€‚

**class Order...**

```
get finalPrice() {
 const basePrice = this.quantity * this.itemPrice;
 return this.discountedPrice(basePrice, this.discountLevel);
}

discountedPrice(basePrice, discountLevel) {
 switch (this.discountLevel) {
  case 1: return basePrice * 0.95;
  case 2: return basePrice * 0.9;
 }
}
```

## 11.6 ä»¥å‚æ•°å–ä»£æŸ¥è¯¢ï¼ˆReplace Query with Parameterï¼‰

åå‘é‡æ„ï¼šä»¥æŸ¥è¯¢å–ä»£å‚æ•°ï¼ˆ324ï¼‰

```
  targetTemperature(aPlan)

function targetTemperature(aPlan) {
  currentTemperature = thermostat.currentTemperature;
  // rest of function...


  targetTemperature(aPlan, thermostat.currentTemperature)

function targetTemperature(aPlan, currentTemperature) {
  // rest of function...
```

### åŠ¨æœº

åœ¨æµè§ˆå‡½æ•°å®ç°æ—¶ï¼Œæˆ‘æœ‰æ—¶ä¼šå‘ç°ä¸€äº›ä»¤äººä¸å¿«çš„å¼•ç”¨å…³ç³»ï¼Œä¾‹å¦‚ï¼Œå¼•ç”¨ä¸€ä¸ªå…¨å±€å˜é‡ï¼Œæˆ–è€…å¼•ç”¨å¦ä¸€ä¸ªæˆ‘æƒ³è¦ç§»é™¤çš„å…ƒç´ ã€‚ä¸ºäº†è§£å†³è¿™äº›ä»¤äººä¸å¿«çš„å¼•ç”¨ï¼Œæˆ‘éœ€è¦å°†å…¶æ›¿æ¢ä¸ºå‡½æ•°å‚æ•°ï¼Œä»è€Œå°†å¤„ç†å¼•ç”¨å…³ç³»çš„è´£ä»»è½¬äº¤ç»™å‡½æ•°çš„è°ƒç”¨è€…ã€‚

éœ€è¦ä½¿ç”¨æœ¬é‡æ„çš„æƒ…å†µå¤§å¤šæºäºæˆ‘æƒ³è¦æ”¹å˜ä»£ç çš„ä¾èµ–å…³ç³»â€”â€”ä¸ºäº†è®©ç›®æ ‡å‡½æ•°ä¸å†ä¾èµ–äºæŸä¸ªå…ƒç´ ï¼Œæˆ‘æŠŠè¿™ä¸ªå…ƒç´ çš„å€¼ä»¥å‚æ•°å½¢å¼ä¼ é€’ç»™è¯¥å‡½æ•°ã€‚è¿™é‡Œéœ€è¦æ³¨æ„æƒè¡¡ï¼šå¦‚æœæŠŠæ‰€æœ‰ä¾èµ–å…³ç³»éƒ½å˜æˆå‚æ•°ï¼Œä¼šå¯¼è‡´å‚æ•°åˆ—è¡¨å†—é•¿é‡å¤ï¼›å¦‚æœä½œç”¨åŸŸä¹‹é—´çš„å…±äº«å¤ªå¤šï¼Œåˆä¼šå¯¼è‡´å‡½æ•°é—´ä¾èµ–è¿‡åº¦ã€‚æˆ‘ä¸€å‘ä¸å–„äºå¾®å¦™çš„æƒè¡¡ï¼Œæ‰€ä»¥â€œèƒ½å¤Ÿå¯é åœ°æ”¹å˜å†³å®šâ€å°±æ˜¾å¾—å°¤ä¸ºé‡è¦ï¼Œè¿™æ ·éšç€æˆ‘çš„ç†è§£åŠ æ·±ï¼Œç¨‹åºä¹Ÿèƒ½ä»ä¸­å—ç›Šã€‚

å¦‚æœä¸€ä¸ªå‡½æ•°ç”¨åŒæ ·çš„å‚æ•°è°ƒç”¨æ€»æ˜¯ç»™å‡ºåŒæ ·çš„ç»“æœï¼Œæˆ‘ä»¬å°±è¯´è¿™ä¸ªå‡½æ•°å…·æœ‰â€œå¼•ç”¨é€æ˜æ€§â€ï¼ˆreferential transparencyï¼‰ï¼Œè¿™æ ·çš„å‡½æ•°ç†è§£èµ·æ¥æ›´å®¹æ˜“ã€‚å¦‚æœä¸€ä¸ªå‡½æ•°ä½¿ç”¨äº†å¦ä¸€ä¸ªå…ƒç´ ï¼Œè€Œåè€…ä¸å…·å¼•ç”¨é€æ˜æ€§ï¼Œé‚£ä¹ˆåŒ…å«è¯¥å…ƒç´ çš„å‡½æ•°ä¹Ÿå°±å¤±å»äº†å¼•ç”¨é€æ˜æ€§ã€‚åªè¦æŠŠâ€œä¸å…·å¼•ç”¨é€æ˜æ€§çš„å…ƒç´ â€å˜æˆå‚æ•°ä¼ å…¥ï¼Œå‡½æ•°å°±èƒ½é‡è·å¼•ç”¨é€æ˜æ€§ã€‚è™½ç„¶è¿™æ ·å°±æŠŠè´£ä»»è½¬ç§»ç»™äº†å‡½æ•°çš„è°ƒç”¨è€…ï¼Œä½†æ˜¯å…·æœ‰å¼•ç”¨é€æ˜æ€§çš„æ¨¡å—èƒ½å¸¦æ¥å¾ˆå¤šç›Šå¤„ã€‚æœ‰ä¸€ä¸ªå¸¸è§çš„æ¨¡å¼ï¼šåœ¨è´Ÿè´£é€»è¾‘å¤„ç†çš„æ¨¡å—ä¸­åªæœ‰çº¯å‡½æ•°ï¼Œå…¶å¤–å†åŒ…è£¹å¤„ç† I/O å’Œå…¶ä»–å¯å˜å…ƒç´ çš„é€»è¾‘ä»£ç ã€‚å€ŸåŠ©ä»¥å‚æ•°å–ä»£æŸ¥è¯¢ï¼Œæˆ‘å¯ä»¥æçº¯ç¨‹åºçš„æŸäº›ç»„æˆéƒ¨åˆ†ï¼Œä½¿å…¶æ›´å®¹æ˜“æµ‹è¯•ã€æ›´å®¹æ˜“ç†è§£ã€‚

ä¸è¿‡ä»¥å‚æ•°å–ä»£æŸ¥è¯¢å¹¶éåªæœ‰å¥½å¤„ã€‚æŠŠæŸ¥è¯¢å˜æˆå‚æ•°ä»¥åï¼Œå°±è¿«ä½¿è°ƒç”¨è€…å¿…é¡»å¼„æ¸…å¦‚ä½•æä¾›æ­£ç¡®çš„å‚æ•°å€¼ï¼Œè¿™ä¼šå¢åŠ å‡½æ•°è°ƒç”¨è€…çš„å¤æ‚åº¦ï¼Œè€Œæˆ‘åœ¨è®¾è®¡æ¥å£æ—¶é€šå¸¸æ›´æ„¿æ„è®©æ¥å£çš„æ¶ˆè´¹è€…æ›´å®¹æ˜“ä½¿ç”¨ã€‚å½’æ ¹åˆ°åº•ï¼Œè¿™æ˜¯å…³äºç¨‹åºä¸­è´£ä»»åˆ†é…çš„é—®é¢˜ï¼Œè€Œè¿™æ–¹é¢çš„å†³ç­–æ—¢ä¸å®¹æ˜“ï¼Œä¹Ÿä¸ä¼šä¸€åŠ³æ°¸é€¸â€”â€”è¿™å°±æ˜¯æˆ‘éœ€è¦éå¸¸ç†Ÿæ‚‰æœ¬é‡æ„ï¼ˆåŠå…¶åå‘é‡æ„ï¼‰çš„åŸå› ã€‚

### åšæ³•

å¯¹æ‰§è¡ŒæŸ¥è¯¢æ“ä½œçš„ä»£ç ä½¿ç”¨æç‚¼å˜é‡ï¼ˆ119ï¼‰ï¼Œå°†å…¶ä»å‡½æ•°ä½“ä¸­åˆ†ç¦»å‡ºæ¥ã€‚

ç°åœ¨å‡½æ•°ä½“ä»£ç å·²ç»ä¸å†æ‰§è¡ŒæŸ¥è¯¢æ“ä½œï¼ˆè€Œæ˜¯ä½¿ç”¨å‰ä¸€æ­¥æç‚¼å‡ºçš„å˜é‡ï¼‰ï¼Œå¯¹è¿™éƒ¨åˆ†ä»£ç ä½¿ç”¨æç‚¼å‡½æ•°ï¼ˆ106ï¼‰ã€‚

ç»™æç‚¼å‡ºçš„æ–°å‡½æ•°èµ·ä¸€ä¸ªå®¹æ˜“æœç´¢çš„åå­—ï¼Œä»¥ä¾¿ç¨åæ”¹åã€‚

ä½¿ç”¨å†…è”å˜é‡ï¼ˆ123ï¼‰ï¼Œæ¶ˆé™¤åˆšæ‰æç‚¼å‡ºæ¥çš„å˜é‡ã€‚

å¯¹åŸæ¥çš„å‡½æ•°ä½¿ç”¨å†…è”å‡½æ•°ï¼ˆ115ï¼‰ã€‚

å¯¹æ–°å‡½æ•°æ”¹åï¼Œæ”¹å›åŸæ¥å‡½æ•°çš„åå­—ã€‚

### èŒƒä¾‹

æˆ‘ä»¬æƒ³è±¡ä¸€ä¸ªç®€å•å´åˆçƒ¦äººçš„æ¸©åº¦æ§åˆ¶ç³»ç»Ÿã€‚ç”¨æˆ·å¯ä»¥ä»ä¸€ä¸ªæ¸©æ§ç»ˆç«¯ï¼ˆthermostatï¼‰æŒ‡å®šæ¸©åº¦ï¼Œä½†æŒ‡å®šçš„ç›®æ ‡æ¸©åº¦å¿…é¡»åœ¨æ¸©åº¦æ§åˆ¶è®¡åˆ’ï¼ˆheating planï¼‰å…è®¸çš„èŒƒå›´å†…ã€‚

**class HeatingPlan...**

```
get targetTemperature() {
  if (thermostat.selectedTemperature > this._max) return this._max;
  else if (thermostat.selectedTemperature < this._min) return this._min;
  else return thermostat.selectedTemperature;
}
```

**è°ƒç”¨æ–¹...**

```
if (thePlan.targetTemperature > thermostat.currentTemperature) setToHeat();
else if (thePlan.targetTemperature<thermostat.currentTemperature)setToCool();
else setOff();
```

ç³»ç»Ÿçš„æ¸©æ§è®¡åˆ’è§„åˆ™æŠ‘åˆ¶äº†æˆ‘çš„è¦æ±‚ï¼Œä½œä¸ºè¿™æ ·ä¸€ä¸ªç³»ç»Ÿçš„ç”¨æˆ·ï¼Œæˆ‘å¯èƒ½ä¼šæ„Ÿåˆ°å¾ˆçƒ¦æ¼ã€‚ä¸è¿‡ä½œä¸ºç¨‹åºå‘˜ï¼Œæˆ‘æ›´æ‹…å¿ƒçš„æ˜¯ targetTemperature å‡½æ•°ä¾èµ–äºå…¨å±€çš„ thermostat å¯¹è±¡ã€‚æˆ‘å¯ä»¥æŠŠéœ€è¦è¿™ä¸ªå¯¹è±¡æä¾›çš„ä¿¡æ¯ä½œä¸ºå‚æ•°ä¼ å…¥ï¼Œä»è€Œæ‰“ç ´å¯¹è¯¥å¯¹è±¡çš„ä¾èµ–ã€‚

é¦–å…ˆï¼Œæˆ‘è¦ç”¨æç‚¼å˜é‡ï¼ˆ119ï¼‰æŠŠâ€œå¸Œæœ›ä½œä¸ºå‚æ•°ä¼ å…¥çš„ä¿¡æ¯â€æç‚¼å‡ºæ¥ã€‚

**class HeatingPlan...**

```
get targetTemperature() {
 const selectedTemperature = thermostat.selectedTemperature;
 if      (selectedTemperature > this._max) return this._max;
 else if (selectedTemperature < this._min) return this._min;
 else return selectedTemperature;
}
```

è¿™æ ·å¯ä»¥æ¯”è¾ƒå®¹æ˜“åœ°ç”¨æç‚¼å‡½æ•°ï¼ˆ106ï¼‰æŠŠæ•´ä¸ªå‡½æ•°ä½“æç‚¼å‡ºæ¥ï¼Œåªå‰©â€œè®¡ç®—å‚æ•°å€¼â€çš„é€»è¾‘è¿˜åœ¨åŸåœ°ã€‚

**class HeatingPlan...**

```
get targetTemperature() {
 const selectedTemperature = thermostat.selectedTemperature;
 return this.xxNEWtargetTemperature(selectedTemperature);
}

xxNEWtargetTemperature(selectedTemperature) {
 if      (selectedTemperature > this._max) return this._max;
 else if (selectedTemperature < this._min) return this._min;
 else return selectedTemperature;
}
```

ç„¶åæŠŠåˆšæ‰æç‚¼å‡ºæ¥çš„å˜é‡å†…è”å›å»ï¼Œäºæ˜¯æ—§å‡½æ•°å°±åªå‰©ä¸€ä¸ªç®€å•çš„è°ƒç”¨ã€‚

**class HeatingPlan...**

```
get targetTemperature() {
  return this.xxNEWtargetTemperature(thermostat.selectedTemperature);
}
```

ç°åœ¨å¯ä»¥å¯¹å…¶ä½¿ç”¨å†…è”å‡½æ•°ï¼ˆ115ï¼‰ã€‚

**è°ƒç”¨æ–¹...**

```
if (thePlan.xxNEWtargetTemperature(thermostat.selectedTemperature) >
   thermostat.currentTemperature)
 setToHeat();
else if (thePlan.xxNEWtargetTemperature(thermostat.selectedTemperature) <
     thermostat.currentTemperature)
 setToCool();
else
 setOff();
```

å†æŠŠæ–°å‡½æ•°æ”¹åï¼Œç”¨å›æ—§å‡½æ•°çš„åå­—ã€‚å¾—ç›Šäºä¹‹å‰ç»™å®ƒèµ·äº†ä¸€ä¸ªå®¹æ˜“æœç´¢çš„åå­—ï¼Œç°åœ¨åªè¦æŠŠå‰ç¼€å»æ‰å°±è¡Œã€‚

**è°ƒç”¨æ–¹...**

```
if (thePlan.targetTemperature(thermostat.selectedTemperature) >
   thermostat.currentTemperature)
 setToHeat();
else if (thePlan.targetTemperature(thermostat.selectedTemperature) <
     thermostat.currentTemperature)
 setToCool();
else
 setOff();
```

**class HeatingPlan...**

```
targetTemperature(selectedTemperature) {
 if (selectedTemperature > this._max) return this._max;
 else if (selectedTemperature < this._min) return this._min;
 else return selectedTemperature;
}
```

è°ƒç”¨æ–¹çš„ä»£ç çœ‹èµ·æ¥æ¯”é‡æ„ä¹‹å‰æ›´ç¬¨é‡äº†ï¼Œè¿™æ˜¯ä½¿ç”¨æœ¬é‡æ„æ‰‹æ³•çš„å¸¸è§æƒ…å†µã€‚å°†ä¸€ä¸ªä¾èµ–å…³ç³»ä»ä¸€ä¸ªæ¨¡å—ä¸­ç§»å‡ºï¼Œå°±æ„å‘³ç€å°†å¤„ç†è¿™ä¸ªä¾èµ–å…³ç³»çš„è´£ä»»æ¨å›ç»™è°ƒç”¨è€…ã€‚è¿™æ˜¯ä¸ºäº†é™ä½è€¦åˆåº¦è€Œä»˜å‡ºçš„ä»£ä»·ã€‚

ä½†æ˜¯ï¼Œå»é™¤å¯¹ thermostat å¯¹è±¡çš„è€¦åˆï¼Œå¹¶ä¸æ˜¯æœ¬é‡æ„å¸¦æ¥çš„å”¯ä¸€æ”¶ç›Šã€‚HeatingPlan ç±»æœ¬èº«æ˜¯ä¸å¯å˜çš„â€”â€”å­—æ®µçš„å€¼éƒ½åœ¨æ„é€ å‡½æ•°ä¸­è®¾ç½®ï¼Œä»»ä½•å‡½æ•°éƒ½ä¸ä¼šä¿®æ”¹å®ƒä»¬ã€‚ï¼ˆä¸ç”¨è´¹å¿ƒå»æŸ¥çœ‹æ•´ä¸ªç±»çš„ä»£ç ï¼Œç›¸ä¿¡æˆ‘å°±å¥½ã€‚ï¼‰åœ¨ä¸å¯å˜çš„ HeatingPlan åŸºç¡€ä¸Šï¼ŒæŠŠå¯¹ thermostat çš„ä¾èµ–ç§»å‡ºå‡½æ•°ä½“ä¹‹åï¼Œæˆ‘åˆä½¿ targetTemperature å‡½æ•°å…·å¤‡äº†å¼•ç”¨é€æ˜æ€§ã€‚ä»æ­¤ä»¥åï¼Œåªè¦åœ¨åŒä¸€ä¸ª HeatingPlan å¯¹è±¡ä¸Šç”¨åŒæ ·çš„å‚æ•°è°ƒç”¨ targetTemperature å‡½æ•°ï¼Œæˆ‘ä¼šå§‹ç»ˆå¾—åˆ°åŒæ ·çš„ç»“æœã€‚å¦‚æœ HeatingPlan çš„æ‰€æœ‰å‡½æ•°éƒ½å…·æœ‰å¼•ç”¨é€æ˜æ€§ï¼Œè¿™ä¸ªç±»ä¼šæ›´å®¹æ˜“æµ‹è¯•ï¼Œå…¶è¡Œä¸ºä¹Ÿæ›´å®¹æ˜“ç†è§£ã€‚

JavaScript çš„ç±»æ¨¡å‹æœ‰ä¸€ä¸ªé—®é¢˜ï¼šæ— æ³•å¼ºåˆ¶è¦æ±‚ç±»çš„ä¸å¯å˜æ€§â€”â€”å§‹ç»ˆæœ‰åŠæ³•ä¿®æ”¹å¯¹è±¡çš„å†…éƒ¨æ•°æ®ã€‚å°½ç®¡å¦‚æ­¤ï¼Œåœ¨ç¼–å†™ä¸€ä¸ªç±»çš„æ—¶å€™æ˜ç¡®è¯´æ˜å¹¶é¼“åŠ±ä¸å¯å˜æ€§ï¼Œé€šå¸¸ä¹Ÿå°±è¶³å¤Ÿäº†ã€‚å°½é‡è®©ç±»ä¿æŒä¸å¯å˜é€šå¸¸æ˜¯ä¸€ä¸ªå¥½çš„ç­–ç•¥ï¼Œä»¥å‚æ•°å–ä»£æŸ¥è¯¢åˆ™æ˜¯è¾¾æˆè¿™ä¸€ç­–ç•¥çš„åˆ©å™¨ã€‚

## 11.7 ç§»é™¤è®¾å€¼å‡½æ•°ï¼ˆRemove Setting Methodï¼‰

```
class Person {
get name() {...}
set name(aString) {...}


class Person {
get name() {...}
```

### åŠ¨æœº

å¦‚æœä¸ºæŸä¸ªå­—æ®µæä¾›äº†è®¾å€¼å‡½æ•°ï¼Œè¿™å°±æš—ç¤ºè¿™ä¸ªå­—æ®µå¯ä»¥è¢«æ”¹å˜ã€‚å¦‚æœä¸å¸Œæœ›åœ¨å¯¹è±¡åˆ›å»ºä¹‹åæ­¤å­—æ®µè¿˜æœ‰æœºä¼šè¢«æ”¹å˜ï¼Œé‚£å°±ä¸è¦ä¸ºå®ƒæä¾›è®¾å€¼å‡½æ•°ï¼ˆåŒæ—¶å°†è¯¥å­—æ®µå£°æ˜ä¸ºä¸å¯å˜ï¼‰ã€‚è¿™æ ·ä¸€æ¥ï¼Œè¯¥å­—æ®µå°±åªèƒ½åœ¨æ„é€ å‡½æ•°ä¸­èµ‹å€¼ï¼Œæˆ‘â€œä¸æƒ³è®©å®ƒè¢«ä¿®æ”¹â€çš„æ„å›¾ä¼šæ›´åŠ æ¸…æ™°ï¼Œå¹¶ä¸”å¯ä»¥æ’é™¤å…¶å€¼è¢«ä¿®æ”¹çš„å¯èƒ½æ€§â€”â€”è¿™ç§å¯èƒ½æ€§å¾€å¾€æ˜¯éå¸¸å¤§çš„ã€‚

æœ‰ä¸¤ç§å¸¸è§çš„æƒ…å†µéœ€è¦è®¨è®ºã€‚ä¸€ç§æƒ…å†µæ˜¯ï¼Œæœ‰äº›äººå–œæ¬¢å§‹ç»ˆé€šè¿‡è®¿é—®å‡½æ•°æ¥è¯»å†™å­—æ®µå€¼ï¼ŒåŒ…æ‹¬åœ¨æ„é€ å‡½æ•°å†…ä¹Ÿæ˜¯å¦‚æ­¤ã€‚è¿™ä¼šå¯¼è‡´æ„é€ å‡½æ•°æˆä¸ºè®¾å€¼å‡½æ•°çš„å”¯ä¸€ä½¿ç”¨è€…ã€‚è‹¥æœçœŸå¦‚æ­¤ï¼Œæˆ‘æ›´æ„¿æ„å»é™¤è®¾å€¼å‡½æ•°ï¼Œæ¸…æ™°åœ°è¡¨è¾¾â€œæ„é€ ä¹‹åä¸åº”è¯¥å†æ›´æ–°å­—æ®µå€¼â€çš„æ„å›¾ã€‚

å¦ä¸€ç§æƒ…å†µæ˜¯ï¼Œå¯¹è±¡æ˜¯ç”±å®¢æˆ·ç«¯é€šè¿‡åˆ›å»ºè„šæœ¬æ„é€ å‡ºæ¥ï¼Œè€Œä¸æ˜¯åªæœ‰ä¸€æ¬¡ç®€å•çš„æ„é€ å‡½æ•°è°ƒç”¨ã€‚æ‰€è°“â€œåˆ›å»ºè„šæœ¬â€ï¼Œé¦–å…ˆæ˜¯è°ƒç”¨æ„é€ å‡½æ•°ï¼Œç„¶åå°±æ˜¯ä¸€ç³»åˆ—è®¾å€¼å‡½æ•°çš„è°ƒç”¨ï¼Œå…±åŒå®Œæˆæ–°å¯¹è±¡çš„æ„é€ ã€‚åˆ›å»ºè„šæœ¬æ‰§è¡Œå®Œä»¥åï¼Œè¿™ä¸ªæ–°ç”Ÿå¯¹è±¡çš„éƒ¨åˆ†ï¼ˆä¹ƒè‡³å…¨éƒ¨ï¼‰å­—æ®µå°±ä¸åº”è¯¥å†è¢«ä¿®æ”¹ã€‚è®¾å€¼å‡½æ•°åªåº”è¯¥åœ¨èµ·åˆçš„å¯¹è±¡åˆ›å»ºè¿‡ç¨‹ä¸­è°ƒç”¨ã€‚å¯¹äºè¿™ç§æƒ…å†µï¼Œæˆ‘ä¹Ÿä¼šæƒ³åŠæ³•å»é™¤è®¾å€¼å‡½æ•°ï¼Œæ›´æ¸…æ™°åœ°è¡¨è¾¾æˆ‘çš„æ„å›¾ã€‚

### åšæ³•

å¦‚æœæ„é€ å‡½æ•°å°šæ— æ³•å¾—åˆ°æƒ³è¦è®¾å…¥å­—æ®µçš„å€¼ï¼Œå°±ä½¿ç”¨æ”¹å˜å‡½æ•°å£°æ˜ï¼ˆ124ï¼‰å°†è¿™ä¸ªå€¼ä»¥å‚æ•°çš„å½¢å¼ä¼ å…¥æ„é€ å‡½æ•°ã€‚åœ¨æ„é€ å‡½æ•°ä¸­è°ƒç”¨è®¾å€¼å‡½æ•°ï¼Œå¯¹å­—æ®µè®¾å€¼ã€‚

å¦‚æœæƒ³ç§»é™¤å¤šä¸ªè®¾å€¼å‡½æ•°ï¼Œå¯ä»¥ä¸€æ¬¡æ€§æŠŠå®ƒä»¬çš„å€¼éƒ½ä¼ å…¥æ„é€ å‡½æ•°ï¼Œè¿™èƒ½ç®€åŒ–åç»­æ­¥éª¤ã€‚

ç§»é™¤æ‰€æœ‰åœ¨æ„é€ å‡½æ•°ä¹‹å¤–å¯¹è®¾å€¼å‡½æ•°çš„è°ƒç”¨ï¼Œæ”¹ä¸ºä½¿ç”¨æ–°çš„æ„é€ å‡½æ•°ã€‚æ¯æ¬¡ä¿®æ”¹ä¹‹åéƒ½è¦æµ‹è¯•ã€‚

å¦‚æœä¸èƒ½æŠŠâ€œè°ƒç”¨è®¾å€¼å‡½æ•°â€æ›¿æ¢ä¸ºâ€œåˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡â€ï¼ˆä¾‹å¦‚ä½ éœ€è¦æ›´æ–°ä¸€ä¸ªå¤šå¤„å…±äº«å¼•ç”¨çš„å¯¹è±¡ï¼‰ï¼Œè¯·æ”¾å¼ƒæœ¬é‡æ„ã€‚

ä½¿ç”¨å†…è”å‡½æ•°ï¼ˆ115ï¼‰æ¶ˆå»è®¾å€¼å‡½æ•°ã€‚å¦‚æœå¯èƒ½çš„è¯ï¼ŒæŠŠå­—æ®µå£°æ˜ä¸ºä¸å¯å˜ã€‚

æµ‹è¯•ã€‚

### èŒƒä¾‹

æˆ‘æœ‰ä¸€ä¸ªå¾ˆç®€å•çš„ Person ç±»ã€‚

**class Person...**

```
get name() {return this._name;}
set name(arg) {this._name = arg;}
get id() {return this._id;}
set id(arg) {this._id = arg;}
```

ç›®å‰æˆ‘ä¼šè¿™æ ·åˆ›å»ºæ–°å¯¹è±¡ï¼š

```
const martin = new Person();
martin.name = "martin";
martin.id = "1234";
```

å¯¹è±¡åˆ›å»ºä¹‹åï¼Œname å­—æ®µå¯èƒ½ä¼šæ”¹å˜ï¼Œä½† id å­—æ®µä¸ä¼šã€‚ä¸ºäº†æ›´æ¸…æ™°åœ°è¡¨è¾¾è¿™ä¸ªè®¾è®¡æ„å›¾ï¼Œæˆ‘å¸Œæœ›ç§»é™¤å¯¹åº” id å­—æ®µçš„è®¾å€¼å‡½æ•°ã€‚

ä½† id å­—æ®µè¿˜å¾—è®¾ç½®åˆå§‹å€¼ï¼Œæ‰€ä»¥æˆ‘é¦–å…ˆç”¨æ”¹å˜å‡½æ•°å£°æ˜ï¼ˆ124ï¼‰åœ¨æ„é€ å‡½æ•°ä¸­æ·»åŠ å¯¹åº”çš„å‚æ•°ã€‚

**class Person...**

```
constructor(id) {
  this.id = id;
}
```

ç„¶åè°ƒæ•´åˆ›å»ºè„šæœ¬ï¼Œæ”¹ä¸ºä»æ„é€ å‡½æ•°è®¾å€¼ id å­—æ®µå€¼ã€‚

```
const martin = new Person("1234");
martin.name = "martin";
martin.id = "1234";
```

æ‰€æœ‰åˆ›å»º Person å¯¹è±¡çš„åœ°æ–¹éƒ½è¦å¦‚æ­¤ä¿®æ”¹ï¼Œæ¯æ¬¡ä¿®æ”¹ä¹‹åè¦æ‰§è¡Œæµ‹è¯•ã€‚

å…¨éƒ¨ä¿®æ”¹å®Œæˆåï¼Œå°±å¯ä»¥ç”¨å†…è”å‡½æ•°ï¼ˆ115ï¼‰æ¶ˆå»è®¾å€¼å‡½æ•°ã€‚

**class Person...**

```
constructor(id) {
  this._id = id;
}
get name() {return this._name;}
set name(arg) {this._name = arg;}
get id() {return this._id;}
set id(arg) {this._id = arg;}
```

## 11.8 ä»¥å·¥å‚å‡½æ•°å–ä»£æ„é€ å‡½æ•°ï¼ˆReplace Constructor with Factory Functionï¼‰

æ›¾ç”¨åï¼šä»¥å·¥å‚å‡½æ•°å–ä»£æ„é€ å‡½æ•°ï¼ˆReplace Constructor with Factory Methodï¼‰

```
leadEngineer = new Employee(document.leadEngineer, "E");

leadEngineer = createEngineer(document.leadEngineer);
```

### åŠ¨æœº

å¾ˆå¤šé¢å‘å¯¹è±¡è¯­è¨€éƒ½æœ‰ç‰¹åˆ«çš„æ„é€ å‡½æ•°ï¼Œä¸“é—¨ç”¨äºå¯¹è±¡çš„åˆå§‹åŒ–ã€‚éœ€è¦æ–°å»ºä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œå®¢æˆ·ç«¯é€šå¸¸ä¼šè°ƒç”¨æ„é€ å‡½æ•°ã€‚ä½†ä¸ä¸€èˆ¬çš„å‡½æ•°ç›¸æ¯”ï¼Œæ„é€ å‡½æ•°åˆå¸¸æœ‰ä¸€äº›ä¸‘é™‹çš„å±€é™æ€§ã€‚ä¾‹å¦‚ï¼ŒJava çš„æ„é€ å‡½æ•°åªèƒ½è¿”å›å½“å‰æ‰€è°ƒç”¨ç±»çš„å®ä¾‹ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘æ— æ³•æ ¹æ®ç¯å¢ƒæˆ–å‚æ•°ä¿¡æ¯è¿”å›å­ç±»å®ä¾‹æˆ–ä»£ç†å¯¹è±¡ï¼›æ„é€ å‡½æ•°çš„åå­—æ˜¯å›ºå®šçš„ï¼Œå› æ­¤æ— æ³•ä½¿ç”¨æ¯”é»˜è®¤åå­—æ›´æ¸…æ™°çš„å‡½æ•°åï¼›æ„é€ å‡½æ•°éœ€è¦é€šè¿‡ç‰¹æ®Šçš„æ“ä½œç¬¦æ¥è°ƒç”¨ï¼ˆåœ¨å¾ˆå¤šè¯­è¨€ä¸­æ˜¯ new å…³é”®å­—ï¼‰ï¼Œæ‰€ä»¥åœ¨è¦æ±‚æ™®é€šå‡½æ•°çš„åœºåˆå°±éš¾ä»¥ä½¿ç”¨ã€‚

å·¥å‚å‡½æ•°å°±ä¸å—è¿™äº›é™åˆ¶ã€‚å·¥å‚å‡½æ•°çš„å®ç°å†…éƒ¨å¯ä»¥è°ƒç”¨æ„é€ å‡½æ•°ï¼Œä½†ä¹Ÿå¯ä»¥æ¢æˆåˆ«çš„æ–¹å¼å®ç°ã€‚

### åšæ³•

æ–°å»ºä¸€ä¸ªå·¥å‚å‡½æ•°ï¼Œè®©å®ƒè°ƒç”¨ç°æœ‰çš„æ„é€ å‡½æ•°ã€‚

å°†è°ƒç”¨æ„é€ å‡½æ•°çš„ä»£ç æ”¹ä¸ºè°ƒç”¨å·¥å‚å‡½æ•°ã€‚

æ¯ä¿®æ”¹ä¸€å¤„ï¼Œå°±æ‰§è¡Œæµ‹è¯•ã€‚

å°½é‡ç¼©å°æ„é€ å‡½æ•°çš„å¯è§èŒƒå›´ã€‚

### èŒƒä¾‹

åˆæ˜¯é‚£ä¸ªå•è°ƒä¹å‘³çš„ä¾‹å­ï¼šå‘˜å·¥è–ªèµ„ç³»ç»Ÿã€‚æˆ‘è¿˜æ˜¯ä»¥ Employee ç±»è¡¨ç¤ºâ€œå‘˜å·¥â€ã€‚

**class Employee...**

```
constructor (name, typeCode) {
  this._name = name;
  this._typeCode = typeCode;
}
get name() {return this._name;}
get type() {
  return Employee.legalTypeCodes[this._typeCode];
}
static get legalTypeCodes() {
  return {"E": "Engineer", "M": "Manager", "S": "Salesman"};
}
```

ä½¿ç”¨å®ƒçš„ä»£ç æœ‰è¿™æ ·çš„ï¼š

**è°ƒç”¨æ–¹...**

```
candidate = new Employee(document.name, document.empType);
```

ä¹Ÿæœ‰è¿™æ ·çš„ï¼š

**è°ƒç”¨æ–¹...**

```
const leadEngineer = new Employee(document.leadEngineer, "E");
```

é‡æ„çš„ç¬¬ä¸€æ­¥æ˜¯åˆ›å»ºå·¥å‚å‡½æ•°ï¼Œå…¶ä¸­æŠŠå¯¹è±¡åˆ›å»ºçš„è´£ä»»ç›´æ¥å§”æ´¾ç»™æ„é€ å‡½æ•°ã€‚

**é¡¶å±‚ä½œç”¨åŸŸ...**

```
function createEmployee(name, typeCode) {
  return new Employee(name, typeCode);
}
```

ç„¶åæ‰¾åˆ°æ„é€ å‡½æ•°çš„è°ƒç”¨è€…ï¼Œå¹¶é€ä¸€ä¿®æ”¹å®ƒä»¬ï¼Œä»¤å…¶ä½¿ç”¨å·¥å‚å‡½æ•°ã€‚

ç¬¬ä¸€å¤„çš„ä¿®æ”¹å¾ˆç®€å•ã€‚

**è°ƒç”¨æ–¹...**

```
candidate = createEmployee(document.name, document.empType);
```

ç¬¬äºŒå¤„åˆ™å¯ä»¥è¿™æ ·ä½¿ç”¨å·¥å‚å‡½æ•°ã€‚

**è°ƒç”¨æ–¹...**

```
const leadEngineer = createEmployee(document.leadEngineer, "E");
```

ä½†æˆ‘ä¸å–œæ¬¢è¿™é‡Œçš„ç±»å‹ç â€”â€”ä»¥å­—ç¬¦ä¸²å­—é¢é‡çš„å½¢å¼ä¼ å…¥ç±»å‹ç ï¼Œä¸€èˆ¬æ¥è¯´éƒ½æ˜¯åå‘³é“ã€‚æ‰€ä»¥æˆ‘æ›´æ„¿æ„å†æ–°å»ºä¸€ä¸ªå·¥å‚å‡½æ•°ï¼ŒæŠŠâ€œå‘˜å·¥ç±»åˆ«â€çš„ä¿¡æ¯åµŒåœ¨å‡½æ•°åé‡Œä½“ç°ã€‚

**è°ƒç”¨æ–¹...**

```
const leadEngineer = createEngineer(document.leadEngineer);
```

**é¡¶å±‚ä½œç”¨åŸŸ...**

```
function createEngineer(name) {
  return new Employee(name, "E");
}
```

## 11.9 ä»¥å‘½ä»¤å–ä»£å‡½æ•°ï¼ˆReplace Function with Commandï¼‰

æ›¾ç”¨åï¼šä»¥å‡½æ•°å¯¹è±¡å–ä»£å‡½æ•°ï¼ˆReplace Method with Method Objectï¼‰

åå‘é‡æ„ï¼šä»¥å‡½æ•°å–ä»£å‘½ä»¤ï¼ˆ344ï¼‰

```
function score(candidate, medicalExam, scoringGuide) {
  let result = 0;
  let healthLevel = 0;
  // long body code
}

class Scorer {
  constructor(candidate, medicalExam, scoringGuide) {
    this._candidate = candidate;
    this._medicalExam = medicalExam;
    this._scoringGuide = scoringGuide;
  }

  execute() {
    this._result = 0;
    this._healthLevel = 0;
    // long body code
  }
}
```

### åŠ¨æœº

å‡½æ•°ï¼Œä¸ç®¡æ˜¯ç‹¬ç«‹å‡½æ•°ï¼Œè¿˜æ˜¯ä»¥æ–¹æ³•ï¼ˆmethodï¼‰å½¢å¼é™„ç€åœ¨å¯¹è±¡ä¸Šçš„å‡½æ•°ï¼Œæ˜¯ç¨‹åºè®¾è®¡çš„åŸºæœ¬æ„é€ å—ã€‚ä¸è¿‡ï¼Œå°†å‡½æ•°å°è£…æˆè‡ªå·±çš„å¯¹è±¡ï¼Œæœ‰æ—¶ä¹Ÿæ˜¯ä¸€ç§æœ‰ç”¨çš„åŠæ³•ã€‚è¿™æ ·çš„å¯¹è±¡æˆ‘ç§°ä¹‹ä¸ºâ€œå‘½ä»¤å¯¹è±¡â€ï¼ˆcommand objectï¼‰ï¼Œæˆ–è€…ç®€ç§°â€œå‘½ä»¤â€ï¼ˆcommandï¼‰ã€‚è¿™ç§å¯¹è±¡å¤§å¤šåªæœåŠ¡äºå•ä¸€å‡½æ•°ï¼Œè·å¾—å¯¹è¯¥å‡½æ•°çš„è¯·æ±‚ï¼Œæ‰§è¡Œè¯¥å‡½æ•°ï¼Œå°±æ˜¯è¿™ç§å¯¹è±¡å­˜åœ¨çš„æ„ä¹‰ã€‚

ä¸æ™®é€šçš„å‡½æ•°ç›¸æ¯”ï¼Œå‘½ä»¤å¯¹è±¡æä¾›äº†æ›´å¤§çš„æ§åˆ¶çµæ´»æ€§å’Œæ›´å¼ºçš„è¡¨è¾¾èƒ½åŠ›ã€‚é™¤äº†å‡½æ•°è°ƒç”¨æœ¬èº«ï¼Œå‘½ä»¤å¯¹è±¡è¿˜å¯ä»¥æ”¯æŒé™„åŠ çš„æ“ä½œï¼Œä¾‹å¦‚æ’¤é”€æ“ä½œã€‚æˆ‘å¯ä»¥é€šè¿‡å‘½ä»¤å¯¹è±¡æä¾›çš„æ–¹æ³•æ¥è®¾å€¼å‘½ä»¤çš„å‚æ•°å€¼ï¼Œä»è€Œæ”¯æŒæ›´ä¸°å¯Œçš„ç”Ÿå‘½å‘¨æœŸç®¡ç†èƒ½åŠ›ã€‚æˆ‘å¯ä»¥å€ŸåŠ©ç»§æ‰¿å’Œé’©å­å¯¹å‡½æ•°è¡Œä¸ºåŠ ä»¥å®šåˆ¶ã€‚å¦‚æœæˆ‘æ‰€ä½¿ç”¨çš„ç¼–ç¨‹è¯­è¨€æ”¯æŒå¯¹è±¡ä½†ä¸æ”¯æŒå‡½æ•°ä½œä¸ºä¸€ç­‰å…¬æ°‘ï¼Œé€šè¿‡å‘½ä»¤å¯¹è±¡å°±å¯ä»¥ç»™å‡½æ•°æä¾›å¤§éƒ¨åˆ†ç›¸å½“äºä¸€ç­‰å…¬æ°‘çš„èƒ½åŠ›ã€‚åŒæ ·ï¼Œå³ä¾¿ç¼–ç¨‹è¯­è¨€æœ¬èº«å¹¶ä¸æ”¯æŒåµŒå¥—å‡½æ•°ï¼Œæˆ‘ä¹Ÿå¯ä»¥å€ŸåŠ©å‘½ä»¤å¯¹è±¡çš„æ–¹æ³•å’Œå­—æ®µæŠŠå¤æ‚çš„å‡½æ•°æ‹†è§£å¼€ï¼Œè€Œä¸”åœ¨æµ‹è¯•å’Œè°ƒè¯•è¿‡ç¨‹ä¸­å¯ä»¥ç›´æ¥è°ƒç”¨è¿™äº›æ–¹æ³•ã€‚

æ‰€æœ‰è¿™äº›éƒ½æ˜¯ä½¿ç”¨å‘½ä»¤å¯¹è±¡çš„å¥½ç†ç”±ï¼Œæ‰€ä»¥æˆ‘è¦åšå¥½å‡†å¤‡ï¼Œä¸€æ—¦æœ‰éœ€è¦ï¼Œå°±èƒ½æŠŠå‡½æ•°é‡æ„æˆå‘½ä»¤ã€‚ä¸è¿‡æˆ‘ä»¬ä¸èƒ½å¿˜è®°ï¼Œå‘½ä»¤å¯¹è±¡çš„çµæ´»æ€§ä¹Ÿæ˜¯ä»¥å¤æ‚æ€§ä½œä¸ºä»£ä»·çš„ã€‚æ‰€ä»¥ï¼Œå¦‚æœè¦åœ¨ä½œä¸ºä¸€ç­‰å…¬æ°‘çš„å‡½æ•°å’Œå‘½ä»¤å¯¹è±¡ä¹‹é—´åšä¸ªé€‰æ‹©ï¼Œ95%çš„æ—¶å€™æˆ‘éƒ½ä¼šé€‰å‡½æ•°ã€‚åªæœ‰å½“æˆ‘ç‰¹åˆ«éœ€è¦å‘½ä»¤å¯¹è±¡æä¾›çš„æŸç§èƒ½åŠ›è€Œæ™®é€šçš„å‡½æ•°æ— æ³•æä¾›è¿™ç§èƒ½åŠ›æ—¶ï¼Œæˆ‘æ‰ä¼šè€ƒè™‘ä½¿ç”¨å‘½ä»¤å¯¹è±¡ã€‚

è·Ÿè½¯ä»¶å¼€å‘ä¸­çš„å¾ˆå¤šè¯æ±‡ä¸€æ ·ï¼Œâ€œå‘½ä»¤â€è¿™ä¸ªè¯æ‰¿è½½äº†å¤ªå¤šå«ä¹‰ã€‚åœ¨è¿™é‡Œï¼Œâ€œå‘½ä»¤â€æ˜¯æŒ‡ä¸€ä¸ªå¯¹è±¡ï¼Œå…¶ä¸­å°è£…äº†ä¸€ä¸ªå‡½æ•°è°ƒç”¨è¯·æ±‚ã€‚è¿™æ˜¯éµå¾ªã€Šè®¾è®¡æ¨¡å¼ã€‹[gof]ä¸€ä¹¦ä¸­çš„å‘½ä»¤æ¨¡å¼ï¼ˆcommand patternï¼‰ã€‚åœ¨è¿™ä¸ªæ„ä¹‰ä¸Šï¼Œä½¿ç”¨â€œå‘½ä»¤â€ä¸€è¯æ—¶ï¼Œæˆ‘ä¼šå…ˆç”¨å®Œæ•´çš„â€œå‘½ä»¤å¯¹è±¡â€ä¸€è¯è®¾å®šä¸Šä¸‹æ–‡ï¼Œç„¶åè§†æƒ…å†µä½¿ç”¨ç®€ç•¥çš„â€œå‘½ä»¤â€ä¸€è¯ã€‚åœ¨å‘½ä»¤ä¸æŸ¥è¯¢åˆ†ç¦»åŸåˆ™ï¼ˆcommand-query separation principleï¼‰ä¸­ä¹Ÿç”¨åˆ°äº†â€œå‘½ä»¤â€ä¸€è¯ï¼Œæ­¤æ—¶â€œå‘½ä»¤â€æ˜¯ä¸€ä¸ªå¯¹è±¡æ‰€æ‹¥æœ‰çš„å‡½æ•°ï¼Œè°ƒç”¨è¯¥å‡½æ•°å¯ä»¥æ”¹å˜å¯¹è±¡å¯è§‚å¯Ÿçš„çŠ¶æ€ã€‚æˆ‘å°½é‡é¿å…ä½¿ç”¨è¿™ä¸ªæ„ä¹‰ä¸Šçš„â€œå‘½ä»¤â€ä¸€è¯ï¼Œè€Œæ›´æ„¿æ„ç§°å…¶ä¸ºâ€œä¿®æ”¹å‡½æ•°â€ï¼ˆmodifierï¼‰æˆ–è€…â€œæ”¹å˜å‡½æ•°â€ï¼ˆmutatorï¼‰ã€‚

### åšæ³•

ä¸ºæƒ³è¦åŒ…è£…çš„å‡½æ•°åˆ›å»ºä¸€ä¸ªç©ºçš„ç±»ï¼Œæ ¹æ®è¯¥å‡½æ•°çš„åå­—ä¸ºå…¶å‘½åã€‚

ä½¿ç”¨æ¬ç§»å‡½æ•°ï¼ˆ198ï¼‰æŠŠå‡½æ•°ç§»åˆ°ç©ºçš„ç±»é‡Œã€‚

ä¿æŒåŸæ¥çš„å‡½æ•°ä½œä¸ºè½¬å‘å‡½æ•°ï¼Œè‡³å°‘ä¿ç•™åˆ°é‡æ„ç»“æŸä¹‹å‰æ‰åˆ é™¤ã€‚

éµå¾ªç¼–ç¨‹è¯­è¨€çš„å‘½åè§„èŒƒæ¥ç»™å‘½ä»¤å¯¹è±¡èµ·åã€‚å¦‚æœæ²¡æœ‰åˆé€‚çš„å‘½åè§„èŒƒï¼Œå°±ç»™å‘½ä»¤å¯¹è±¡ä¸­è´Ÿè´£å®é™…æ‰§è¡Œå‘½ä»¤çš„å‡½æ•°èµ·ä¸€ä¸ªé€šç”¨çš„åå­—ï¼Œä¾‹å¦‚â€œexecuteâ€æˆ–è€…â€œcallâ€ã€‚

å¯ä»¥è€ƒè™‘ç»™æ¯ä¸ªå‚æ•°åˆ›å»ºä¸€ä¸ªå­—æ®µï¼Œå¹¶åœ¨æ„é€ å‡½æ•°ä¸­æ·»åŠ å¯¹åº”çš„å‚æ•°ã€‚

### èŒƒä¾‹

JavaScript è¯­è¨€æœ‰å¾ˆå¤šç¼ºç‚¹ï¼Œä½†æŠŠå‡½æ•°ä½œä¸ºä¸€ç­‰å…¬æ°‘å¯¹å¾…ï¼Œæ˜¯å®ƒæœ€æ­£ç¡®çš„è®¾è®¡å†³ç­–ä¹‹ä¸€ã€‚åœ¨ä¸å…·å¤‡è¿™ç§èƒ½åŠ›çš„ç¼–ç¨‹è¯­è¨€ä¸­ï¼Œæˆ‘ç»å¸¸è¦è´¹åŠ›ä¸ºå¾ˆå¸¸è§çš„ä»»åŠ¡åˆ›å»ºå‘½ä»¤å¯¹è±¡ï¼ŒJavaScript åˆ™çœå»äº†è¿™äº›éº»çƒ¦ã€‚ä¸è¿‡ï¼Œå³ä¾¿åœ¨ JavaScript ä¸­ï¼Œæœ‰æ—¶ä¹Ÿéœ€è¦ç”¨åˆ°å‘½ä»¤å¯¹è±¡ã€‚

ä¸€ä¸ªå…¸å‹çš„åº”ç”¨åœºæ™¯å°±æ˜¯æ‹†è§£å¤æ‚çš„å‡½æ•°ï¼Œä»¥ä¾¿æˆ‘ç†è§£å’Œä¿®æ”¹ã€‚è¦æƒ³çœŸæ­£å±•ç¤ºè¿™ä¸ªé‡æ„æ‰‹æ³•çš„ä»·å€¼ï¼Œæˆ‘éœ€è¦ä¸€ä¸ªé•¿è€Œå¤æ‚çš„å‡½æ•°ï¼Œä½†è¿™å†™èµ·æ¥å¤ªè´¹äº‹ï¼Œä½ è¯»èµ·æ¥ä¹Ÿéº»çƒ¦ã€‚æ‰€ä»¥æˆ‘åœ¨è¿™é‡Œå±•ç¤ºçš„å‡½æ•°å…¶å®å¾ˆçŸ­ï¼Œå¹¶ä¸çœŸçš„éœ€è¦æœ¬é‡æ„æ‰‹æ³•ï¼Œè¿˜æœ›è¯»è€…æƒä¸”åŒ…æ¶µã€‚ä¸‹é¢çš„å‡½æ•°ç”¨äºç»™ä¸€ä»½ä¿é™©ç”³è¯·è¯„åˆ†ã€‚

```
function score(candidate, medicalExam, scoringGuide) {
  let result = 0;
  let healthLevel = 0;
  let highMedicalRiskFlag = false;

  if (medicalExam.isSmoker) {
    healthLevel += 10;
    highMedicalRiskFlag = true;
  }
  let certificationGrade = "regular";
  if (scoringGuide.stateWithLowCertification(candidate.originState)) {
    certificationGrade = "low";
    result -= 5;
  } // lots more code like this
  result -= Math.max(healthLevel - 5, 0);
  return result;
}
```

æˆ‘é¦–å…ˆåˆ›å»ºä¸€ä¸ªç©ºçš„ç±»ï¼Œç”¨æ¬ç§»å‡½æ•°ï¼ˆ198ï¼‰æŠŠä¸Šè¿°å‡½æ•°æ¬åˆ°è¿™ä¸ªç±»é‡Œå»ã€‚

```
function score(candidate, medicalExam, scoringGuide) {
  return new Scorer().execute(candidate, medicalExam, scoringGuide);
}

class Scorer {
  execute(candidate, medicalExam, scoringGuide) {
    let result = 0;
    let healthLevel = 0;
    let highMedicalRiskFlag = false;

    if (medicalExam.isSmoker) {
      healthLevel += 10;
      highMedicalRiskFlag = true;
    }
    let certificationGrade = "regular";
    if (scoringGuide.stateWithLowCertification(candidate.originState)) {
      certificationGrade = "low";
      result -= 5;
    } // lots more code like this
    result -= Math.max(healthLevel - 5, 0);
    return result;
  }
}
```

å¤§å¤šæ•°æ—¶å€™ï¼Œæˆ‘æ›´æ„¿æ„åœ¨å‘½ä»¤å¯¹è±¡çš„æ„é€ å‡½æ•°ä¸­ä¼ å…¥å‚æ•°ï¼Œè€Œä¸è®© execute å‡½æ•°æ¥æ”¶å‚æ•°ã€‚åœ¨è¿™æ ·ä¸€ä¸ªç®€å•çš„æ‹†è§£åœºæ™¯ä¸­ï¼Œè¿™ä¸€ç‚¹å¸¦æ¥çš„å½±å“ä¸å¤§ï¼›ä½†å¦‚æœæˆ‘è¦å¤„ç†çš„å‘½ä»¤éœ€è¦æ›´å¤æ‚çš„å‚æ•°è®¾ç½®å‘¨æœŸæˆ–è€…å¤§é‡å®šåˆ¶ï¼Œä¸Šè¿°åšæ³•å°±ä¼šå¸¦æ¥å¾ˆå¤šä¾¿åˆ©ï¼šå¤šä¸ªå‘½ä»¤ç±»å¯ä»¥åˆ†åˆ«ä»å„è‡ªçš„æ„é€ å‡½æ•°ä¸­è·å¾—å„è‡ªä¸åŒçš„å‚æ•°ï¼Œç„¶ååˆå¯ä»¥æ’æˆé˜Ÿåˆ—æŒ¨ä¸ªæ‰§è¡Œï¼Œå› ä¸ºå®ƒä»¬çš„ execute å‡½æ•°ç­¾åéƒ½ä¸€æ ·ã€‚

æˆ‘å¯ä»¥æ¯æ¬¡æ¬ç§»ä¸€ä¸ªå‚æ•°åˆ°æ„é€ å‡½æ•°ã€‚

```
function score(candidate, medicalExam, scoringGuide) {
  return new Scorer(candidate).execute(candidate, medicalExam, scoringGuide);
}
```

**class Scorer...**

```
constructor(candidate){
 this._candidate = candidate;
}

execute (candidate, medicalExam, scoringGuide) {
 let result = 0;
 let healthLevel = 0;
 let highMedicalRiskFlag = false;

 if (medicalExam.isSmoker) {
  healthLevel += 10;
  highMedicalRiskFlag = true;
 }
 let certificationGrade = "regular";
 if (scoringGuide.stateWithLowCertification(this._candidate.originState)) {
  certificationGrade = "low";
  result -= 5;
 }
 // lots more code like this
 result -= Math.max(healthLevel - 5, 0);
 return result;
}
```

ç»§ç»­å¤„ç†å…¶ä»–å‚æ•°ï¼š

```
function score(candidate, medicalExam, scoringGuide) {
  return new Scorer(candidate, medicalExam, scoringGuide).execute();
}
```

**class Scorer...**

```
constructor(candidate, medicalExam, scoringGuide){
 this._candidate = candidate;
 this._medicalExam = medicalExam;
 this._scoringGuide = scoringGuide;
}
execute () {
 let result = 0;
 let healthLevel = 0;
 let highMedicalRiskFlag = false;

 if (this._medicalExam.isSmoker) {
  healthLevel += 10;
  highMedicalRiskFlag = true;
 }
 let certificationGrade = "regular";
 if (this._scoringGuide.stateWithLowCertification(this._candidate.originState)) {
  certificationGrade = "low";
  result -= 5;
 }
 // lots more code like this
 result -= Math.max(healthLevel - 5, 0);
 return result;
}
```

ä»¥å‘½ä»¤å–ä»£å‡½æ•°çš„é‡æ„åˆ°æ­¤å°±ç»“æŸäº†ï¼Œä¸è¿‡ä¹‹æ‰€ä»¥è¦åšè¿™ä¸ªé‡æ„ï¼Œæ˜¯ä¸ºäº†æ‹†è§£å¤æ‚çš„å‡½æ•°ï¼Œæ‰€ä»¥æˆ‘è¿˜æ˜¯å¤§è‡´å±•ç¤ºä¸€ä¸‹å¦‚ä½•æ‹†è§£ã€‚ä¸‹ä¸€æ­¥æ˜¯æŠŠæ‰€æœ‰å±€éƒ¨å˜é‡éƒ½å˜æˆå­—æ®µï¼Œæˆ‘è¿˜æ˜¯æ¯æ¬¡ä¿®æ”¹ä¸€å¤„ã€‚

**class Scorer...**

```
constructor(candidate, medicalExam, scoringGuide){
 this._candidate = candidate;
 this._medicalExam = medicalExam;
 this._scoringGuide = scoringGuide;
}

execute () {
 this._result = 0;
 let healthLevel = 0;
 let highMedicalRiskFlag = false;

 if (this._medicalExam.isSmoker) {
  healthLevel += 10;
  highMedicalRiskFlag = true;
 }
 let certificationGrade = "regular";
 if (this._scoringGuide.stateWithLowCertification(this._candidate.originState)) {
  certificationGrade = "low";
  this._result -= 5;
 }
 // lots more code like this
 this._result -= Math.max(healthLevel - 5, 0);
 return this._result;
}
```

é‡å¤ä¸Šè¿°è¿‡ç¨‹ï¼Œç›´åˆ°æ‰€æœ‰å±€éƒ¨å˜é‡éƒ½å˜æˆå­—æ®µã€‚ï¼ˆâ€œæŠŠå±€éƒ¨å˜é‡å˜æˆå­—æ®µâ€è¿™ä¸ªé‡æ„æ‰‹æ³•æ˜¯å¦‚æ­¤ç®€å•ï¼Œä»¥è‡³äºæˆ‘éƒ½æ²¡æœ‰åœ¨é‡æ„åå½•ä¸­ç»™å®ƒä¸€å¸­ä¹‹åœ°ã€‚å¯¹æ­¤æˆ‘ç•¥æ„Ÿæ„§ç–šã€‚ï¼‰

**class Scorer...**

```
constructor(candidate, medicalExam, scoringGuide){
 this._candidate = candidate;
 this._medicalExam = medicalExam;
 this._scoringGuide = scoringGuide;
}

execute () {
 this._result = 0;
 this._healthLevel = 0;
 this._highMedicalRiskFlag = false;

 if (this._medicalExam.isSmoker) {
  this._healthLevel += 10;
  this._highMedicalRiskFlag = true;
 }
 this._certificationGrade = "regular";
 if (this._scoringGuide.stateWithLowCertification(this._candidate.originState)) {
  this._certificationGrade = "low";
  this._result -= 5;
 }
 // lots more code like this
 this._result -= Math.max(this._healthLevel - 5, 0);
 return this._result;
}
```

ç°åœ¨å‡½æ•°çš„æ‰€æœ‰çŠ¶æ€éƒ½å·²ç»ç§»åˆ°äº†å‘½ä»¤å¯¹è±¡ä¸­ï¼Œæˆ‘å¯ä»¥æ”¾å¿ƒä½¿ç”¨æç‚¼å‡½æ•°ï¼ˆ106ï¼‰ç­‰é‡æ„æ‰‹æ³•ï¼Œè€Œä¸ç”¨çº ç»“äºå±€éƒ¨å˜é‡çš„ä½œç”¨åŸŸä¹‹ç±»é—®é¢˜ã€‚

**class Scorer...**

```
execute () {
 this._result = 0;
 this._healthLevel = 0;
 this._highMedicalRiskFlag = false;

 this.scoreSmoking();
 this._certificationGrade = "regular";
 if (this._scoringGuide.stateWithLowCertification(this._candidate.originState)) {
  this._certificationGrade = "low";
  this._result -= 5;
 }
 // lots more code like this
 this._result -= Math.max(this._healthLevel - 5, 0);
 return this._result;
 }
scoreSmoking() {
 if (this._medicalExam.isSmoker) {
  this._healthLevel += 10;
  this._highMedicalRiskFlag = true;
 }
}
```

è¿™æ ·æˆ‘å°±å¯ä»¥åƒå¤„ç†åµŒå¥—å‡½æ•°ä¸€æ ·å¤„ç†å‘½ä»¤å¯¹è±¡ã€‚å®é™…ä¸Šï¼Œåœ¨ JavaScript ä¸­è¿ç”¨æ­¤é‡æ„æ‰‹æ³•æ—¶ï¼Œçš„ç¡®å¯ä»¥è€ƒè™‘ç”¨åµŒå¥—å‡½æ•°æ¥ä»£æ›¿å‘½ä»¤å¯¹è±¡ã€‚ä¸è¿‡æˆ‘è¿˜æ˜¯ä¼šä½¿ç”¨å‘½ä»¤å¯¹è±¡ï¼Œä¸ä»…å› ä¸ºæˆ‘å¯¹å‘½ä»¤å¯¹è±¡æ›´ç†Ÿæ‚‰ï¼Œè€Œä¸”è¿˜å› ä¸ºæˆ‘å¯ä»¥é’ˆå¯¹å‘½ä»¤å¯¹è±¡ä¸­ä»»ä½•ä¸€ä¸ªå‡½æ•°è¿›è¡Œæµ‹è¯•å’Œè°ƒè¯•ã€‚

## 11.10 ä»¥å‡½æ•°å–ä»£å‘½ä»¤ï¼ˆReplace Command with Functionï¼‰

åå‘é‡æ„ï¼šä»¥å‘½ä»¤å–ä»£å‡½æ•°ï¼ˆ337ï¼‰

```
class ChargeCalculator {
  constructor(customer, usage) {
    this._customer = customer;
    this._usage = usage;
  }
  execute() {
    return this._customer.rate * this._usage;
  }
}

function charge(customer, usage) {
  return customer.rate * usage;
}
```

### åŠ¨æœº

å‘½ä»¤å¯¹è±¡ä¸ºå¤„ç†å¤æ‚è®¡ç®—æä¾›äº†å¼ºå¤§çš„æœºåˆ¶ã€‚å€ŸåŠ©å‘½ä»¤å¯¹è±¡ï¼Œå¯ä»¥è½»æ¾åœ°å°†åŸæœ¬å¤æ‚çš„å‡½æ•°æ‹†è§£ä¸ºå¤šä¸ªæ–¹æ³•ï¼Œå½¼æ­¤ä¹‹é—´é€šè¿‡å­—æ®µå…±äº«çŠ¶æ€ï¼›æ‹†è§£åçš„æ–¹æ³•å¯ä»¥åˆ†åˆ«è°ƒç”¨ï¼›å¼€å§‹è°ƒç”¨ä¹‹å‰çš„æ•°æ®çŠ¶æ€ä¹Ÿå¯ä»¥é€æ­¥æ„å»ºã€‚ä½†è¿™ç§å¼ºå¤§æ˜¯æœ‰ä»£ä»·çš„ã€‚å¤§å¤šæ•°æ—¶å€™ï¼Œæˆ‘åªæ˜¯æƒ³è°ƒç”¨ä¸€ä¸ªå‡½æ•°ï¼Œè®©å®ƒå®Œæˆè‡ªå·±çš„å·¥ä½œå°±å¥½ã€‚å¦‚æœè¿™ä¸ªå‡½æ•°ä¸æ˜¯å¤ªå¤æ‚ï¼Œé‚£ä¹ˆå‘½ä»¤å¯¹è±¡å¯èƒ½æ˜¾å¾—è´¹è€Œä¸æƒ ï¼Œæˆ‘å°±åº”è¯¥è€ƒè™‘å°†å…¶å˜å›æ™®é€šçš„å‡½æ•°ã€‚

### åšæ³•

è¿ç”¨æç‚¼å‡½æ•°ï¼ˆ106ï¼‰ï¼ŒæŠŠâ€œåˆ›å»ºå¹¶æ‰§è¡Œå‘½ä»¤å¯¹è±¡â€çš„ä»£ç å•ç‹¬æç‚¼åˆ°ä¸€ä¸ªå‡½æ•°ä¸­ã€‚

è¿™ä¸€æ­¥ä¼šæ–°å»ºä¸€ä¸ªå‡½æ•°ï¼Œæœ€ç»ˆè¿™ä¸ªå‡½æ•°ä¼šå–ä»£ç°åœ¨çš„å‘½ä»¤å¯¹è±¡ã€‚

å¯¹å‘½ä»¤å¯¹è±¡åœ¨æ‰§è¡Œé˜¶æ®µç”¨åˆ°çš„å‡½æ•°ï¼Œé€ä¸€ä½¿ç”¨å†…è”å‡½æ•°ï¼ˆ115ï¼‰ã€‚

å¦‚æœè¢«è°ƒç”¨çš„å‡½æ•°æœ‰è¿”å›å€¼ï¼Œè¯·å…ˆå¯¹è°ƒç”¨å¤„ä½¿ç”¨æç‚¼å˜é‡ï¼ˆ119ï¼‰ï¼Œç„¶åå†ä½¿ç”¨å†…è”å‡½æ•°ï¼ˆ115ï¼‰ã€‚

ä½¿ç”¨æ”¹å˜å‡½æ•°å£°æ˜ï¼ˆ124ï¼‰ï¼ŒæŠŠæ„é€ å‡½æ•°çš„å‚æ•°è½¬ç§»åˆ°æ‰§è¡Œå‡½æ•°ã€‚

å¯¹äºæ‰€æœ‰çš„å­—æ®µï¼Œåœ¨æ‰§è¡Œå‡½æ•°ä¸­æ‰¾åˆ°å¼•ç”¨å®ƒä»¬çš„åœ°æ–¹ï¼Œå¹¶æ”¹ä¸ºä½¿ç”¨å‚æ•°ã€‚æ¯æ¬¡ä¿®æ”¹åéƒ½è¦æµ‹è¯•ã€‚

æŠŠâ€œè°ƒç”¨æ„é€ å‡½æ•°â€å’Œâ€œè°ƒç”¨æ‰§è¡Œå‡½æ•°â€ä¸¤æ­¥éƒ½å†…è”åˆ°è°ƒç”¨æ–¹ï¼ˆä¹Ÿå°±æ˜¯æœ€ç»ˆè¦æ›¿æ¢å‘½ä»¤å¯¹è±¡çš„é‚£ä¸ªå‡½æ•°ï¼‰ã€‚

æµ‹è¯•ã€‚

ç”¨ç§»é™¤æ­»ä»£ç ï¼ˆ237ï¼‰æŠŠå‘½ä»¤ç±»æ¶ˆå»ã€‚

### èŒƒä¾‹

å‡è®¾æˆ‘æœ‰ä¸€ä¸ªå¾ˆå°çš„å‘½ä»¤å¯¹è±¡ã€‚

```
class ChargeCalculator {
  constructor(customer, usage, provider) {
    this._customer = customer;
    this._usage = usage;
    this._provider = provider;
  }
  get baseCharge() {
    return this._customer.baseRate * this._usage;
  }
  get charge() {
    return this.baseCharge + this._provider.connectionCharge;
  }
}
```

ä½¿ç”¨æ–¹çš„ä»£ç å¦‚ä¸‹ã€‚

**è°ƒç”¨æ–¹...**

```
monthCharge = new ChargeCalculator(customer, usage, provider).charge;
```

å‘½ä»¤ç±»è¶³å¤Ÿå°ã€è¶³å¤Ÿç®€å•ï¼Œå˜æˆå‡½æ•°æ›´åˆé€‚ã€‚

é¦–å…ˆï¼Œæˆ‘ç”¨æç‚¼å‡½æ•°ï¼ˆ106ï¼‰æŠŠå‘½ä»¤å¯¹è±¡çš„åˆ›å»ºä¸è°ƒç”¨è¿‡ç¨‹åŒ…è£…åˆ°ä¸€ä¸ªå‡½æ•°ä¸­ã€‚

**è°ƒç”¨æ–¹...**

```
monthCharge = charge(customer, usage, provider);
```

**é¡¶å±‚ä½œç”¨åŸŸ...**

```
function charge(customer, usage, provider) {
  return new ChargeCalculator(customer, usage, provider).charge;
}
```

æ¥ä¸‹æ¥è¦è€ƒè™‘å¦‚ä½•å¤„ç†æ”¯æŒå‡½æ•°ï¼ˆä¹Ÿå°±æ˜¯è¿™é‡Œçš„ baseCharge å‡½æ•°ï¼‰ã€‚å¯¹äºæœ‰è¿”å›å€¼çš„å‡½æ•°ï¼Œæˆ‘ä¸€èˆ¬ä¼šå…ˆç”¨æç‚¼å˜é‡ï¼ˆ119ï¼‰æŠŠè¿”å›å€¼æç‚¼å‡ºæ¥ã€‚

**class ChargeCalculator...**

```
get baseCharge() {
  return this._customer.baseRate * this._usage;
}
get charge() {
  const baseCharge = this.baseCharge;
  return baseCharge + this._provider.connectionCharge;
}
```

ç„¶åå¯¹æ”¯æŒå‡½æ•°ä½¿ç”¨å†…è”å‡½æ•°ï¼ˆ115ï¼‰ã€‚

**class ChargeCalculator...**

```
get charge() {
  const baseCharge = this._customer.baseRate * this._usage;
  return baseCharge + this._provider.connectionCharge;
}
```

ç°åœ¨æ‰€æœ‰é€»è¾‘å¤„ç†éƒ½é›†ä¸­åˆ°ä¸€ä¸ªå‡½æ•°äº†ï¼Œä¸‹ä¸€æ­¥æ˜¯æŠŠæ„é€ å‡½æ•°ä¼ å…¥çš„æ•°æ®ç§»åˆ°ä¸»å‡½æ•°ã€‚é¦–å…ˆç”¨æ”¹å˜å‡½æ•°å£°æ˜ï¼ˆ124ï¼‰æŠŠæ„é€ å‡½æ•°çš„å‚æ•°é€ä¸€æ·»åŠ åˆ° charge å‡½æ•°ä¸Šã€‚

**class ChargeCalculator...**

```
constructor (customer, usage, provider){
 this._customer = customer;
 this._usage = usage;
 this._provider = provider;
}

charge(customer, usage, provider) {
 const baseCharge = this._customer.baseRate * this._usage;
 return baseCharge + this._provider.connectionCharge;
}
```

**é¡¶å±‚ä½œç”¨åŸŸ...**

```
function charge(customer, usage, provider) {
  return new ChargeCalculator(customer, usage, provider).charge(
    customer,
    usage,
    provider
  );
}
```

ç„¶åä¿®æ”¹ charge å‡½æ•°çš„å®ç°ï¼Œæ”¹ä¸ºä½¿ç”¨ä¼ å…¥çš„å‚æ•°ã€‚è¿™ä¸ªä¿®æ”¹å¯ä»¥å°æ­¥è¿›è¡Œï¼Œæ¯æ¬¡ä½¿ç”¨ä¸€ä¸ªå‚æ•°ã€‚

**class ChargeCalculator...**

```
constructor (customer, usage, provider){
 this._customer = customer;
 this._usage = usage;
 this._provider = provider;
}

charge(customer, usage, provider) {
 const baseCharge = customer.baseRate * this._usage;
 return baseCharge + this._provider.connectionCharge;
}
```

æ„é€ å‡½æ•°ä¸­å¯¹Â `this._customer`Â å­—æ®µçš„èµ‹å€¼ä¸åˆ é™¤ä¹Ÿæ²¡å…³ç³»ï¼Œå› ä¸ºåæ­£æ²¡äººä½¿ç”¨è¿™ä¸ªå­—æ®µã€‚ä½†æˆ‘æ›´æ„¿æ„å»æ‰è¿™æ¡èµ‹å€¼è¯­å¥ï¼Œå› ä¸ºå»æ‰å®ƒä»¥åï¼Œå¦‚æœåœ¨å‡½æ•°å®ç°ä¸­æ¼æ‰äº†ä¸€å¤„å¯¹å­—æ®µçš„ä½¿ç”¨æ²¡æœ‰ä¿®æ”¹ï¼Œæµ‹è¯•å°±ä¼šå¤±è´¥ã€‚ï¼ˆå¦‚æœæˆ‘çœŸçš„çŠ¯äº†è¿™ä¸ªé”™è¯¯è€Œæµ‹è¯•æ²¡æœ‰å¤±è´¥ï¼Œæˆ‘å°±åº”è¯¥è€ƒè™‘å¢åŠ æµ‹è¯•äº†ã€‚ï¼‰

å…¶ä»–å‚æ•°ä¹Ÿå¦‚æ³•ç‚®åˆ¶ï¼Œç›´åˆ° charge å‡½æ•°ä¸å†ä½¿ç”¨ä»»ä½•å­—æ®µï¼š

**class ChargeCalculator...**

```
charge(customer, usage, provider) {
  const baseCharge = customer.baseRate * usage;
  return baseCharge + provider.connectionCharge;
}
```

ç°åœ¨æˆ‘å°±å¯ä»¥æŠŠæ‰€æœ‰é€»è¾‘éƒ½å†…è”åˆ°é¡¶å±‚çš„ charge å‡½æ•°ä¸­ã€‚è¿™æ˜¯å†…è”å‡½æ•°ï¼ˆ115ï¼‰çš„ä¸€ç§ç‰¹æ®Šæƒ…å†µï¼Œæˆ‘éœ€è¦æŠŠæ„é€ å‡½æ•°å’Œæ‰§è¡Œå‡½æ•°ä¸€å¹¶å†…è”ã€‚

**é¡¶å±‚ä½œç”¨åŸŸ...**

```
function charge(customer, usage, provider) {
  const baseCharge = customer.baseRate * usage;
  return baseCharge + provider.connectionCharge;
}
```

ç°åœ¨å‘½ä»¤ç±»å·²ç»æ˜¯æ­»ä»£ç äº†ï¼Œå¯ä»¥ç”¨ç§»é™¤æ­»ä»£ç ï¼ˆ237ï¼‰ç»™å®ƒä¸€ä¸ªä½“é¢çš„è‘¬ç¤¼ã€‚